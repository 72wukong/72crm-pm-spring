(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4c4d8874","chunk-1ac799d4"],{"00cd":function(t,e,a){"use strict";a("47bd")},"0100":function(t,e,a){},"041c":function(t,e,a){},"04c5":function(t,e,a){},"05f8":function(t,e,a){},"08ab":function(t,e,a){},"0cd3":function(t,e,a){},"0d64":function(t,e,a){"use strict";a("270c")},1019:function(t,e,a){"use strict";a("8067")},1276:function(t,e,a){"use strict";var i=a("2ba4"),s=a("c65b"),n=a("e330"),r=a("d784"),o=a("825a"),l=a("7234"),c=a("44e7"),d=a("1d80"),u=a("4840"),h=a("8aa5"),p=a("50c4"),m=a("577e"),f=a("dc4a"),b=a("4dae"),v=a("14c3"),g=a("9263"),k=a("9f7f"),y=a("d039"),C=k.UNSUPPORTED_Y,w=4294967295,T=Math.min,_=[].push,x=n(/./.exec),I=n(_),D=n("".slice),j=!y((function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var a="ab".split(t);return 2!==a.length||"a"!==a[0]||"b"!==a[1]}));r("split",(function(t,e,a){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,a){var n=m(d(this)),r=void 0===a?w:a>>>0;if(0===r)return[];if(void 0===t)return[n];if(!c(t))return s(e,n,t,r);var o,l,u,h=[],p=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),f=0,v=new RegExp(t.source,p+"g");while(o=s(g,v,n)){if(l=v.lastIndex,l>f&&(I(h,D(n,f,o.index)),o.length>1&&o.index<n.length&&i(_,h,b(o,1)),u=o[0].length,f=l,h.length>=r))break;v.lastIndex===o.index&&v.lastIndex++}return f===n.length?!u&&x(v,"")||I(h,""):I(h,D(n,f)),h.length>r?b(h,0,r):h}:"0".split(void 0,0).length?function(t,a){return void 0===t&&0===a?[]:s(e,this,t,a)}:e,[function(e,a){var i=d(this),r=l(e)?void 0:f(e,t);return r?s(r,e,i,a):s(n,m(i),e,a)},function(t,i){var s=o(this),r=m(t),l=a(n,s,r,i,n!==e);if(l.done)return l.value;var c=u(s,RegExp),d=s.unicode,f=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(C?"g":"y"),b=new c(C?"^(?:"+s.source+")":s,f),g=void 0===i?w:i>>>0;if(0===g)return[];if(0===r.length)return null===v(b,r)?[r]:[];var k=0,y=0,_=[];while(y<r.length){b.lastIndex=C?0:y;var x,j=v(b,C?D(r,y):r);if(null===j||(x=T(p(b.lastIndex+(C?y:0)),r.length))===k)y=h(r,y,d);else{if(I(_,D(r,k,y)),_.length===g)return _;for(var L=1;L<=j.length-1;L++)if(I(_,j[L]),_.length===g)return _;y=k=x}}return I(_,D(r,k)),_}]}),!j,C)},"150b":function(t,e,a){"use strict";a("a19b")},1557:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"status-tag"},[a("span",{staticClass:"status-name",style:t.getStyle},[t._v(t._s(t.name))])])},s=[],n=(a("a9e3"),{name:"StatusTag",props:{type:[String,Number],statusName:String},data:function(){return{group:["",{color:"#0052CC","background-color":"#DEEBFF"},{color:"#EC8205","background-color":"#FFEACF"},{color:"#006644","background-color":"#E3FCEF"}]}},computed:{convertType:function(){return Number(this.type)},name:function(){return this.statusName?this.statusName:["","未开始","进行中","已完成"][this.convertType]},getStyle:function(){return this.group[this.convertType]}},methods:{}}),r=n,o=(a("77bc"),a("2877")),l=Object(o["a"])(r,i,s,!1,null,"2a8a7a12",null);e["a"]=l.exports},1658:function(t,e,a){"use strict";a.d(e,"W",(function(){return s})),a.d(e,"qb",(function(){return n})),a.d(e,"N",(function(){return r})),a.d(e,"U",(function(){return o})),a.d(e,"P",(function(){return l})),a.d(e,"O",(function(){return c})),a.d(e,"H",(function(){return d})),a.d(e,"I",(function(){return u})),a.d(e,"G",(function(){return h})),a.d(e,"T",(function(){return p})),a.d(e,"R",(function(){return m})),a.d(e,"V",(function(){return f})),a.d(e,"Q",(function(){return b})),a.d(e,"S",(function(){return v})),a.d(e,"F",(function(){return g})),a.d(e,"K",(function(){return k})),a.d(e,"h",(function(){return y})),a.d(e,"e",(function(){return C})),a.d(e,"g",(function(){return w})),a.d(e,"D",(function(){return T})),a.d(e,"b",(function(){return _})),a.d(e,"y",(function(){return x})),a.d(e,"B",(function(){return I})),a.d(e,"z",(function(){return D})),a.d(e,"A",(function(){return j})),a.d(e,"x",(function(){return L})),a.d(e,"v",(function(){return S})),a.d(e,"d",(function(){return O})),a.d(e,"E",(function(){return $})),a.d(e,"u",(function(){return A})),a.d(e,"a",(function(){return F})),a.d(e,"f",(function(){return U})),a.d(e,"w",(function(){return N})),a.d(e,"M",(function(){return V})),a.d(e,"J",(function(){return P})),a.d(e,"gb",(function(){return E})),a.d(e,"nb",(function(){return B})),a.d(e,"fb",(function(){return R})),a.d(e,"pb",(function(){return M})),a.d(e,"hb",(function(){return q})),a.d(e,"jb",(function(){return W})),a.d(e,"ob",(function(){return H})),a.d(e,"ib",(function(){return Y})),a.d(e,"lb",(function(){return z})),a.d(e,"kb",(function(){return G})),a.d(e,"mb",(function(){return Q})),a.d(e,"Y",(function(){return J})),a.d(e,"bb",(function(){return K})),a.d(e,"L",(function(){return X})),a.d(e,"ab",(function(){return Z})),a.d(e,"Z",(function(){return tt})),a.d(e,"X",(function(){return et})),a.d(e,"cb",(function(){return at})),a.d(e,"eb",(function(){return it})),a.d(e,"db",(function(){return st})),a.d(e,"r",(function(){return nt})),a.d(e,"i",(function(){return rt})),a.d(e,"l",(function(){return ot})),a.d(e,"k",(function(){return lt})),a.d(e,"j",(function(){return ct})),a.d(e,"s",(function(){return dt})),a.d(e,"t",(function(){return ut})),a.d(e,"q",(function(){return ht})),a.d(e,"o",(function(){return pt})),a.d(e,"n",(function(){return mt})),a.d(e,"p",(function(){return ft})),a.d(e,"m",(function(){return bt})),a.d(e,"C",(function(){return vt})),a.d(e,"c",(function(){return gt})),a.d(e,"rb",(function(){return kt}));a("99af"),a("d3b7"),a("159b"),a("b64b");var i=a("b775");function s(t){return Object(i["a"])({url:"projectTask/saveProjectTask",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function n(t){return Object(i["a"])({url:"projectTask/updateProjectTask",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function r(t){return Object(i["a"])({url:"projectTask/deleteTask/".concat(t.taskId),method:"post"})}function o(t){return Object(i["a"])({url:"projectTask/queryProjectPlanTaskList",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function l(t){return Object(i["a"])({url:"projectFieldSort/list",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function c(t){return Object(i["a"])({url:"projectFieldSort/addOrUpdate",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function d(t){return Object(i["a"])({url:"projectTask/setProjectTaskName",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function u(t){return Object(i["a"])({url:"projectTask/updateProjectTaskTime",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function h(t){return Object(i["a"])({url:"projectTask/setProjectTaskDescription",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function p(t){return Object(i["a"])({url:"projectTask/queryProjectIterationTaskList",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function m(t){return Object(i["a"])({url:"projectTask/queryProjectTaskList",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function f(t){return Object(i["a"])({url:"projectTask/queryUserTaskList",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function b(t){return Object(i["a"])({url:"projectTask/getProjectTaskDetails/".concat(t.taskId),method:"post"})}function v(t){return Object(i["a"])({url:"projectTask/queryProjectTaskChildList",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function g(t){return Object(i["a"])({url:"projectTask/setProjectTaskMainUser",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function k(t){return Object(i["a"])({url:"projectTask/startBelongIteration",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function y(t){return Object(i["a"])({url:"projectTask/stopBelongIteration",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function C(t){return Object(i["a"])({url:"projectTask/belongIterationDel/".concat(t.taskId),method:"post"})}function w(t){return Object(i["a"])({url:"projectTask/belongIterationDetails/".concat(t.taskId),method:"post"})}function T(t){return Object(i["a"])({url:"projectBelongIteration/relevancyBelongIteration",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function _(t){return Object(i["a"])({url:"projectTaskTime/addProjectTaskTime",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function x(t){return Object(i["a"])({url:"projectBoardTask/queryBoardList",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function I(t){return Object(i["a"])({url:"projectTask/queryProjectTaskChildBoardList",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function D(t){return Object(i["a"])({url:"projectBoard/queryBoardList",method:"post",data:t})}function j(t){return Object(i["a"])({url:"projectBoard/resetBoard",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function L(t){return Object(i["a"])({url:"projectBoard/notAddStatus",method:"post",data:t})}function S(t){return Object(i["a"])({url:"projectTaskComment/queryCommentList",method:"post",data:t})}function O(t){return Object(i["a"])({url:"projectTaskComment/deleteComment",method:"post",data:t})}function $(t){return Object(i["a"])({url:"projectTaskComment/setComment",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function A(t){return Object(i["a"])({url:"projectTaskLog/queryTaskLog/".concat(t.taskId,"/").concat(t.type),method:"post"})}function F(t){return Object(i["a"])({url:"projectLabel/add",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function U(t){return Object(i["a"])({url:"projectLabel/delete",method:"post",data:t})}function N(t){return Object(i["a"])({url:"projectLabel/queryList",method:"post",data:t})}function V(t){return Object(i["a"])({url:"projectLabel/update",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function P(t){return Object(i["a"])({url:"projectLabel/updateTaskLabel",method:"post",data:t})}function E(t){return Object(i["a"])({url:"workTask/deleteWorkTask/".concat(t),method:"post"})}function B(t){return Object(i["a"])({url:"workTask/setWorkTaskStatus",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function R(t){return Object(i["a"])({url:"workTask/setWorkChildTaskStatus",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function M(t){return Object(i["a"])({url:"workTask/setWorkTaskTitle",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function q(t){return Object(i["a"])({url:"workTask/setWorkTaskDescription",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function W(t){return Object(i["a"])({url:"workTask/setWorkTaskMainUser",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function H(t){return Object(i["a"])({url:"workTask/setWorkTaskTime",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function Y(t){return Object(i["a"])({url:"workTask/setWorkTaskLabel",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function z(t){return Object(i["a"])({url:"workTask/setWorkTaskOwnerUser",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function G(t){return Object(i["a"])({url:"workTask/deleteWorkTaskOwnerUser",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function Q(t){return Object(i["a"])({url:"workTask/setWorkTaskPriority",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function J(t){return Object(i["a"])({url:"projectTask/setPriority",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function K(t){return Object(i["a"])({url:"projectTask/setProjectWrongType",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function X(t){return Object(i["a"])({url:"projectTask/upLoadFileRelationLog",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function Z(t){return Object(i["a"])({url:"projectTask/setProjectChildTask",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function tt(t){return Object(i["a"])({url:"projectTask/setProgress",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function et(t){return Object(i["a"])({url:"projectTask/setEstimatedManHours",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function at(t){return Object(i["a"])({url:"workTask/addWorkChildTask",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function it(t){return Object(i["a"])({url:"workTask/updateWorkChildTask",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function st(t){return Object(i["a"])({url:"workTask/deleteWorkChildTask/".concat(t),method:"post"})}function nt(t){return Object(i["a"])({url:"projectBoardTask/setTaskStatus",method:"post",data:t})}function rt(t){return Object(i["a"])({url:"projectTask/getProjectByTime",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function ot(t){return Object(i["a"])({url:"projectTask/getTaskByTime",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function lt(t){return Object(i["a"])({url:"projectTask/getTaskBurnout",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function ct(t){return Object(i["a"])({url:"projectTask/getProjectTaskEvent",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function dt(t){return Object(i["a"])({url:"projectTask/relevancyRelatedDemand",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function ut(t){return Object(i["a"])({url:"projectTask/setProjectChildTaskStatus",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function ht(t){return Object(i["a"])({url:"projectTask/downloadExcel",method:"post",data:t,responseType:"blob"})}function pt(t){var e=new FormData;return Object.keys(t).forEach((function(a){e.append(a,t[a])})),Object(i["a"])({url:"projectTask/excelImport",method:"post",data:e,headers:{"Content-Type":"multipart/form-data"},timeout:6e4})}function mt(t){return Object(i["a"])({url:"projectTask/downloadErrorExcel",method:"post",data:t,responseType:"blob"})}function ft(t){return Object(i["a"])({url:"projectTask/projectTaskExportColumn",method:"post",data:t})}function bt(t){return Object(i["a"])({url:"projectTask/projectTaskExport",method:"post",data:t,responseType:"blob",headers:{"Content-Type":"application/json;charset=UTF-8"}})}function vt(t){return Object(i["a"])({url:"projectTaskUser/relatedProjectTaskUser",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function gt(t){return Object(i["a"])({url:"projectTask/sort/backlog",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function kt(t){return Object(i["a"])({url:"projectTask/queryUserTaskCount",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}},"1bd2":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"append-to-body":!0,"close-on-click-modal":!1,title:"看板设置",visible:t.visible,width:"960px","custom-class":"no-padding-dialog"},on:{close:t.close}},[a("div",{staticClass:"main"},[a("div",{staticClass:"describe"},[t._v("将不同状态下的事项放在特定看板列中")]),t._v(" "),a("div",{staticClass:"card"},[a("task-board",{ref:"board",attrs:{list:t.list,"status-list":t.statusList,"show-type":"board"}})],1),t._v(" "),a("div",{staticClass:"btn-wrap",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:t.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[t._v("保存")]),t._v(" "),a("el-button",{nativeOn:{click:function(e){return t.close(e)}}},[t._v("取消")])],1)])])},s=[],n=(a("d81d"),a("d3b7"),a("159b"),a("14d9"),a("1658")),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"content-box"},[a("draggable",{directives:[{name:"scrollx",rawName:"v-scrollx",value:{ignoreClass:["ignoreClass"]},expression:"{ ignoreClass :['ignoreClass']}"}],staticClass:"board-column-content-parent",attrs:{id:"task-board-body","xs-empty-text":"请将状态拖入此列 否则该列将不在看板显示",list:t.list,options:{group:"board",dragClass:"sortable-parent-drag",filter:".ignore-elements"},handle:".board-column-wrapper"}},[t._l(t.list,(function(e,i){return a("div",{key:e.projectBoardId,staticClass:"board-column"},[a("flexbox",{staticClass:"board-column-wrapper ignoreClass",attrs:{orient:"vertical",align:"stretch"}},[a("div",{staticClass:"board-column-header"},[e.renameShow?a("div",{staticClass:"input-btn"},[a("el-input",{ref:"text",refInFor:!0,attrs:{maxlength:10,size:"small",placeholder:"列表名"},on:{blur:function(a){t.renameBoardSubmit(e,i)}},model:{value:t.editBoardName,callback:function(e){t.editBoardName=e},expression:"editBoardName"}})],1):e.renameShow?t._e():a("div",{staticClass:"header-title"},[a("span",{staticClass:"text"},[t._v("⋮⋮ "+t._s(e.boardName)+"  "+t._s(e.statusList.length)+" ")]),t._v(" "),a("span",{staticClass:"option-btn"},[a("el-popover",{attrs:{placement:"bottom-end",width:"150",trigger:"click"},model:{value:e.taskHandleShow,callback:function(a){t.$set(e,"taskHandleShow",a)},expression:"item.taskHandleShow"}},[a("div",{staticClass:"omit-popover-box"},[a("p",{on:{click:function(a){a.stopPropagation(),t.renameBoardClick(e,i)}}},[t._v("重命名")]),t._v(" "),a("p",{on:{click:function(a){t.delectBoardClick(e,i)}}},[t._v("删除列")])]),t._v(" "),a("i",{staticClass:"el-icon-more img-gd",attrs:{slot:"reference"},slot:"reference"})])],1)])]),t._v(" "),a("draggable",{staticClass:"board-column-content",attrs:{list:e.statusList,options:{group:{name:"status"},dragClass:"sortable-drag"}}},t._l(e.statusList,(function(e,i){return a("div",{key:i.taskId,ref:"taskRow",refInFor:!0,staticClass:"board-item"},[a("flexbox",{attrs:{align:"stretch"}},[a("div",{staticClass:"element-label"},[e.statusType?a("status-tag",{attrs:{"status-name":e.statusName,type:e.statusType}}):t._e()],1)])],1)})))],1)],1)})),t._v(" "),a("div",{staticClass:"board-column-new-list"},[t.createBoardShow||0!=t.loading?t.createBoardShow&&0==t.loading?a("div",{staticClass:"input-btn"},[a("el-input",{attrs:{maxlength:10,size:"small",placeholder:"未命名列"},on:{blur:function(e){t.createBoardSave(t.boardName)}},model:{value:t.boardName,callback:function(e){t.boardName=e},expression:"boardName"}})],1):t._e():a("div",{staticClass:"new-list",on:{click:function(e){t.createBoardShow=!0}}},[a("el-button",{attrs:{icon:"el-icon-plus"}},[t._v("新建列")])],1)])],2),t._v(" "),a("div",{staticClass:"bottom-label"},[a("flexbox",{staticClass:"board-column-wrapper ignoreClass",attrs:{orient:"vertical",align:"stretch"}},[a("div",{staticClass:"board-column-header"},[a("span",{staticClass:"text"},[t._v("以下状态未在看板列中，如果希望特定状态下的事项不在看板显示,可将状态拖进该列")])]),t._v(" "),a("div",{directives:[{name:"empty",rawName:"v-empty",value:0==t.statusList.length,expression:"statusList.length == 0"}],attrs:{"xs-empty-icon":"none","xs-empty-text":"所有事项状态已添加到看板"}},[a("draggable",{staticClass:"board-column-content",attrs:{list:t.statusList,options:{group:{name:"status"},dragClass:"sortable-drag"}}},t._l(t.statusList,(function(e,i){return a("div",{key:i,ref:"taskRow",refInFor:!0,staticClass:"board-item"},[a("flexbox",{attrs:{align:"stretch"}},[a("div",{staticClass:"element-label"},[e.statusType?a("status-tag",{attrs:{"status-name":e.statusName,type:e.statusType}}):t._e()],1)])],1)})))],1)])],1)],1)},o=[],l=(a("a434"),a("1557")),c=a("b76a"),d=a.n(c),u=a("20a0"),h={components:{draggable:d.a,StatusTag:l["a"]},directives:{scrollx:u["a"]},props:{showType:String,statusList:{type:Array,default:function(){return[]}},list:{type:Array,default:function(){return[]}}},data:function(){return{loading:!1,createBoardShow:!1,boardName:"",editBoardName:""}},computed:{},watch:{showType:function(){this.createBoardShow=!1}},created:function(){},mounted:function(){document.body.ondrop=function(t){t.preventDefault(),t.stopPropagation()}},methods:{renameBoardSubmit:function(t,e){this.list[e].boardName=this.editBoardName,t.renameShow=!1,this.editBoardName=""},renameBoardClick:function(t,e){var a=this;this.editBoardName=t.boardName,t.taskHandleShow=!1,t.renameShow=!0,this.$nextTick((function(){a.$refs.text[0].focus()}))},delectBoardClick:function(t,e){var a=this;this.$confirm("您确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.list.splice(e,1)})).catch((function(){}))},createBoardSave:function(t){this.list.push({boardName:t||"未命名列",eventId:this.eventId,statusList:[],sorting:this.list.length}),this.createBoardShow=!1,this.boardName=""}}},p=h,m=(a("f5d2"),a("2877")),f=Object(m["a"])(p,r,o,!1,null,"4670eb7c",null),b=f.exports,v=a("6651"),g={name:"PanelSetting",components:{TaskBoard:b},props:{visible:{type:Boolean,required:!0,default:!1},itemType:String},data:function(){return{loading:!1,list:[],statusList:[],schemeRelationId:""}},mounted:function(){this.getList(this.$route.params.id),this.getStatusList(this.$route.params.id)},methods:{getList:function(t){var e=this;Object(n["z"])({projectId:t,taskType:v["e"][this.itemType]}).then((function(t){e.loading=!1,e.list=t.data.map((function(t){return t.renameShow=!1,t}))})).catch((function(){e.loading=!1}))},getStatusList:function(t){var e=this;Object(n["x"])({projectId:t,taskType:v["e"][this.itemType]}).then((function(t){e.statusList=t.data||[]})).catch((function(){}))},handleConfirm:function(){var t=this,e=this.list||[],a=e.some((function(t){return 0==t.statusList.length}));if(a)return this.$message.error("看板列表中必须存在状态");var i=[];if(e.forEach((function(t){var e={boardName:t.boardName,boardStatusBOList:[]};t.statusList.forEach((function(t){e.boardStatusBOList.push({statusId:t.id||t.statusId})})),i.push(e)})),!i.length)return this.$message.error("看板不能为空");var s={boardBOS:i,projectId:this.$route.params.id,taskType:v["e"][this.itemType]};this.loading=!0,Object(n["A"])(s).then((function(e){t.$emit("update"),t.$message.success("操作成功"),t.loading=!1})).catch((function(){t.loading=!1}))},close:function(){this.$emit("update:visible",!1)}}},k=g,y=(a("ef49"),Object(m["a"])(k,i,s,!1,null,"2516a565",null));e["a"]=y.exports},"1c17":function(t,e,a){},"1c59":function(t,e,a){"use strict";var i=a("6d61"),s=a("6566");i("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),s)},"20a0":function(t,e,a){"use strict";a("d3b7"),a("159b");var i=a("26a1"),s=a("2b0e"),n={isDown:!1,coord:{x:0,y:0}},r=null,o=[],l=function(t){this&&this.contains(t.target)&&(r.style.cursor="pointer",n.isDown=!0,n.coord.x=t.pageX,n.coord.y=t.pageY)},c=function(t){r.style.cursor="default",n.isDown=!1,n.coord.x=0,n.coord.y=0},d=function(t){if(n.isDown){var e=n.coord.x-t.pageX;n.coord.x=t.pageX,r.scrollLeft=r.scrollLeft+e}},u=function(t){h(t)?(r.style.cursor="default",n.isDown=!1):this&&this.contains(t.target)&&(r.scrollLeft+=t.deltaY)},h=function(t){var e=!1;return o.forEach((function(a){var i=document.getElementsByClassName(a);if(i&&!e)for(var s=0;s<i.length;s++){var n=i[s],r=n.getBoundingClientRect();if(t.clientY>r.top&&t.clientY<r.top+r.height&&t.clientX>r.left&&t.clientX<r.left+r.width){e=!0;break}}})),e};e["a"]=s["default"].directive("scrollx",{bind:function(t,e,a){var i=e.value;o=i.ignoreClass},inserted:function(t){r=t,Object(i["b"])(document,"mousedown",l.bind(t)),Object(i["b"])(document,"wheel",u.bind(t)),Object(i["b"])(document,"mouseup",c.bind(t)),Object(i["b"])(document,"mousemove",d.bind(t))},unbind:function(t){Object(i["a"])(document,"mousedown",l.bind(t)),Object(i["a"])(document,"mouseup",c.bind(t)),Object(i["a"])(document,"wheel",u.bind(t)),Object(i["a"])(document,"mousemove",d.bind(t)),n={isDown:!1,coord:{x:0,y:0}}}})},"212b":function(t,e,a){},"229b":function(t,e,a){"use strict";a("56d8")},"25f6":function(t,e,a){"use strict";a("4c91")},"270c":function(t,e,a){},2796:function(t,e,a){"use strict";a("4d91")},"2a91":function(t,e,a){"use strict";a("71fa")},"2b7d":function(t,e,a){"use strict";a("8a8e")},"2d69":function(t,e,a){"use strict";a.d(e,"e",(function(){return s})),a.d(e,"d",(function(){return n})),a.d(e,"c",(function(){return r})),a.d(e,"a",(function(){return o})),a.d(e,"b",(function(){return l}));var i=a("b775");function s(t){return Object(i["a"])({url:"work/work/queryOwnerRoleList/"+t.workId,method:"post"})}function n(t){return Object(i["a"])({url:"work/work/updateOrder",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function r(t){return Object(i["a"])({url:"work/work/updateClassOrder",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function o(t){return Object(i["a"])({url:"project/getProjectGantt",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}function l(t){return Object(i["a"])({url:"projectTaskTime/queryProjectTaskTimeList",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:t})}},"365a":function(t,e,a){},"397a":function(t,e,a){},"3b70":function(t,e,a){"use strict";a("bd6c")},4042:function(t,e,a){"use strict";a("d3b7"),a("159b"),a("caad");var i=a("6bfe");e["a"]={methods:{getAdvancedFilterOptionName:function(t,e){var a="date"===e||"datetime"===e;return{1:"等于",2:"不等于",3:"包含",4:"不包含",5:"为空",6:"不为空",7:a?"晚于":"大于",8:a?"不早于":"大于等于",9:a?"早于":"小于",10:a?"不晚于":"小于等于",12:"开始于",13:"结束于",14:a?"等于（时间段）":"等于（范围）"}[t]||""},getAdvancedFilterOptions:function(t,e){return"text"==t||"textarea"==t||"website"==t||"mobile"==t||"email"==t||"module"==t||"serial_number"==t?[{value:"is",label:"等于",disabled:!1,type:1},{value:"isNot",label:"不等于",disabled:!1,type:2},{value:"contains",label:"包含",disabled:!1,type:3},{value:"notContains",label:"不包含",disabled:!1,type:4},{value:"startWith",label:"开始于",disabled:!1,type:12},{value:"endWith",label:"结束于",disabled:!1,type:13},{value:"isNull",label:"为空",disabled:!1,type:5},{value:"isNotNull",label:"不为空",disabled:!1,type:6}]:"invoiceStatus"===e||"checkStatus"==t||"dealStatus"==t||"status"==t?[{value:"is",label:"等于",disabled:!1,type:1},{value:"isNot",label:"不等于",disabled:!1,type:2}]:"select"==t||"field_attention"==t?[{value:"is",label:"等于",disabled:!1,type:1},{value:"isNot",label:"不等于",disabled:!1,type:2},{value:"isNull",label:"为空",disabled:!1,type:5},{value:"isNotNull",label:"不为空",disabled:!1,type:6}]:"boolean_value"==t?[{value:"is",label:"等于",disabled:!1,type:1},{value:"isNot",label:"不等于",disabled:!1,type:2}]:"checkbox"==t||"location"==t?[{value:"is",label:"等于",disabled:!1,type:1},{value:"isNot",label:"不等于",disabled:!1,type:2},{value:"contains",label:"包含",disabled:!1,type:3},{value:"notContains",label:"不包含",disabled:!1,type:4},{value:"isNull",label:"为空",disabled:!1,type:5},{value:"isNotNull",label:"不为空",disabled:!1,type:6}]:"number"==t||"floatnumber"==t||"percent"==t?[{value:"is",label:"等于",disabled:!1,type:1},{value:"isNot",label:"不等于",disabled:!1,type:2},{value:"gt",label:"大于",disabled:!1,type:7},{value:"egt",label:"大于等于",disabled:!1,type:8},{value:"lt",label:"小于",disabled:!1,type:9},{value:"elt",label:"小于等于",disabled:!1,type:10},{value:"range",label:"等于（范围）",disabled:!1,type:14},{value:"isNull",label:"为空",disabled:!1,type:5},{value:"isNotNull",label:"不为空",disabled:!1,type:6}]:"date"==t||"datetime"==t?[{value:"is",label:"等于",disabled:!1,type:1},{value:"isNot",label:"不等于",disabled:!1,type:2},{value:"lt",label:"早于",disabled:!1,type:9},{value:"gt",label:"晚于",disabled:!1,type:7},{value:"egt",label:"不早于",disabled:!1,type:8},{value:"elt",label:"不晚于",disabled:!1,type:10},{value:"range",label:"等于（时间段）",disabled:!1,type:14},{value:"isNull",label:"为空",disabled:!1,type:5},{value:"isNotNull",label:"不为空",disabled:!1,type:6}]:"date_interval"==t||"position"==t?[]:"user"==t||"structure"==t||"single_user"==t||"field_tag"==t?[{value:"contains",label:"包含",disabled:!1,type:3},{value:"notContains",label:"不包含",disabled:!1,type:4},{value:"isNull",label:"为空",disabled:!1,type:5},{value:"isNotNull",label:"不为空",disabled:!1,type:6}]:[]},getAdvancedFilterDefaultItemByFormType:function(t,e,a){e||(e=t),"business_cause"==t.formType?(t.typeOption=e.setting,t.settingList=[],t.flowName="",t.settingName="",t.value=""):"checkStatus"==t.formType||"dealStatus"==t.formType||"invoiceStatus"==t.formType||"receivedStatus"==t.formType?(t.setting=e.setting||[],t.value=""):"map_address"==t.formType?t.address={state:"",city:"",area:""}:"user"===t.formType||"single_user"===t.formType||"structure"===t.formType||"category"===t.formType||"position"===t.formType?t.value=[]:"date"===t.formType||"datetime"===t.formType?(t.value="",this.$set(t,"timeType",""),this.$set(t,"timeTypeName",""),this.$set(t,"range",[])):"select"==t.formType||"checkbox"===t.formType||"field_attention"===t.formType?(t.setting=e.setting||[],t.value=[]):"number"==t.formType||"floatnumber"==t.formType||"percent"==t.formType?(t.min="",t.max="",t.value=""):"field_tag"===t.formType?(t.setting=e.setting||[],t.value=""):t.value="";var i=this.getAdvancedFilterOptions(a?a(t):t.formType,t.fieldName);if(i.length>0){var s=i[0];t.condition=s.value,t.type=s.type}else t.condition="is",t.type=1;return t},resetAdvancedFilterFieldsValue:function(t){t.forEach((function(t){"number"==t.formType||"floatnumber"==t.formType||"percent"==t.formType?(t.min="",t.max="",t.value=""):"business_cause"==t.formType?(t.flowName="",t.settingName="",t.value="",t.settingList=[]):"map_address"==t.formType?t.address={state:"",city:"",area:""}:["date","datetime"].includes(t.formType)?(t.value="",t.range=[]):Object(i["a"])(t.value)?t.value=[]:Object(i["c"])(t.value)?t.value={}:t.value=""}))}}}},4213:function(t,e,a){"use strict";a("212b")},"432b":function(t,e,a){"use strict";a("397a")},"47bd":function(t,e,a){},"47c1":function(t,e,a){"use strict";a("d75b")},"480b":function(t,e,a){},"48be":function(t,e,a){},"4c91":function(t,e,a){},"4d91":function(t,e,a){},"4ec9":function(t,e,a){a("6f48")},"4fad":function(t,e,a){var i=a("d039"),s=a("861d"),n=a("c6b6"),r=a("d86b"),o=Object.isExtensible,l=i((function(){o(1)}));t.exports=l||r?function(t){return!!s(t)&&((!r||"ArrayBuffer"!=n(t))&&(!o||o(t)))}:o},"50cf":function(t,e,a){"use strict";a("8f79")},5577:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition",{attrs:{name:"slide-fade"}},[a("el-card",{staticClass:"project-screening",style:{"z-index":t.zIndex}},[a("p",{staticClass:"header"},[a("span",{staticClass:"label"},[t._v("高级筛选")]),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:t.resetBtn}},[t._v("重置")]),t._v(" "),a("span",{staticClass:"rt el-icon-close",on:{click:t.close}})],1),t._v(" "),a("div",{staticClass:"content"},t._l(t.filterFieldList,(function(e,i){return a("div",{key:i,staticClass:"menu-list"},[a("p",{staticClass:"item-label",on:{click:function(a){t.rowFun(e)}}},[t._v("\n          "+t._s(e.label)+"\n          "),a("span",{class:e.expand?"el-icon-arrow-right item-expand":"el-icon-arrow-down item-expand"})]),t._v(" "),t._l(e.list,(function(s,n){return a("div",{directives:[{name:"show",rawName:"v-show",value:0==e.expand,expression:"item.expand == false"}],key:n,class:["item-list",s.checked?"item-list-active":"",1==i?"time-item-list":""],on:{click:function(a){t.rowChecked(s,i,n,e.list)}}},["user"==e.type?a("xr-avatar",{staticClass:"user-img",attrs:{name:s.realname,size:24,src:s.img}}):"label"==e.type?a("span",{staticClass:"tag-icon",style:{backgroundColor:s.color}},[a("i",{staticClass:"wk wk-label"})]):"status"==e.type&&s.statusType?a("status-tag",{attrs:{type:s.statusType,"status-name":s.statusName}}):t._e(),t._v(" "),a("span",{staticClass:"item-list-label"},[t._v(t._s(s.name))]),t._v(" "),a("span",{staticClass:"el-icon-check rt"})],1)}))],2)})))])],1)},s=[],n=a("b85c"),r=a("2909"),o=(a("99af"),a("4de4"),a("d3b7"),a("caad"),a("d81d"),a("b0c0"),a("c740"),a("1658")),l=a("a535"),c=a("1557"),d=a("6651"),u=a("ed08"),h={name:"ListFilter",components:{StatusTag:c["a"]},props:{listType:String,list:Array},data:function(){return{zIndex:Object(u["n"])(),filterFieldList:[],filterItems:[{type:"status",field:"statusQuery",label:"状态",id:"3",expand:!1,list:[{name:"未开始",id:1,checked:!1},{name:"进行中",id:2,checked:!1},{name:"已完成",id:3,checked:!1}]},{type:"iteration",field:"belongIterationIdQuery",label:"所属迭代",id:"3",expand:!1,list:[]},{type:"priority",field:"priorityQuery",label:"优先级",id:"3",expand:!1,list:[]},{type:"label",field:"labelQuery",label:"标签",id:"3",expand:!1,list:[]},{type:"user",field:"mainUserIdQuery",label:"负责人",id:"3",expand:!1,list:[]}],iteration:[{type:"status",field:"statusQuery",label:"状态",id:"3",expand:!1,list:[{name:"未开始",id:1,checked:!1},{name:"进行中",id:2,checked:!1},{name:"已完成",id:3,checked:!1}]},{type:"user",field:"mainUserIdQuery",label:"负责人",id:"1",expand:!1,list:[]}]}},watch:{list:{handler:function(t){this.getFilterField()},deep:!0,immediate:!0}},mounted:function(){document.getElementById("app").addEventListener("click",this.taskShowHandle,!1)},methods:{getFilterField:function(){if(this.list&&this.list.length)this.filterFieldList=Object(u["r"])(this.list);else{var t=[{type:"itemType",field:"typeQuery",label:"事项类型",id:"3",expand:!1,list:[{name:"需求",id:2,checked:!1},{name:"任务",id:3,checked:!1},{name:"缺陷",id:4,checked:!1}]}].concat(Object(r["a"])(this.filterItems)),e=this.filterItems.filter((function(t){return"belongIterationIdQuery"!=t.field}));if(this.filterFieldList={all:t,item:this.filterItems,iteration:this.iteration,itemDetail:e}[this.listType],["all","item","itemDetail"].includes(this.listType)){var a=this.getFieldIndex("priority");this.filterFieldList[a].list=d["f"].map((function(t){return t.name=t.label,t.id=t.key,t.checked=!1,t})),this.getLabelList(),"itemDetail"!=this.listType&&this.getIterationList()}this.getUserList()}},getFieldIndex:function(t){var e=this.filterFieldList.findIndex((function(e){return e.type==t}));return e},getUserList:function(){var t=this,e={projectId:this.$route.params.id};Object(l["u"])(e).then((function(e){var a,i=e.data||[],s=Object(n["a"])(t.filterFieldList);try{for(s.s();!(a=s.n()).done;){var r=a.value;"user"==r.type&&(r.list=Object(u["r"])(i).map((function(t){return t.name=t.realname,t.id=t.userId,t.checked=!1,t})))}}catch(o){s.e(o)}finally{s.f()}}))},getLabelList:function(){var t=this,e=this.getFieldIndex("label");this.filterFieldList[e].list=[],Object(o["w"])({name:""}).then((function(a){t.filterFieldList[e].list=a.data.map((function(t){return t.id=t.labelId,t.checked=!1,t}))})).catch((function(){}))},getIterationList:function(){var t=this,e=this.getFieldIndex("iteration");this.filterFieldList[e].list=[];var a={type:0,pageType:0,projectId:this.$route.params.id,name:""};Object(o["T"])(a).then((function(a){t.filterFieldList[e].list=(a.data.list||[]).map((function(t){return t.id=t.taskId,t.checked=!1,t}))}))},close:function(){this.$emit("close-filter")},rowChecked:function(t,e,a,i){i[a].checked=!t.checked,this.$emit("change",this.filterFieldList)},resetBtn:function(){var t,e=Object(n["a"])(this.filterFieldList);try{for(e.s();!(t=e.n()).done;){var a,i=t.value,s=Object(n["a"])(i.list);try{for(s.s();!(a=s.n()).done;){var r=a.value;r.checked=!1}}catch(o){s.e(o)}finally{s.f()}}}catch(o){e.e(o)}finally{e.f()}this.$emit("change",this.filterFieldList)},rowFun:function(t){t.expand?t.expand=!1:t.expand=!0},taskShowHandle:function(t){this.$el.contains(t.target)||this.close()}}},p=h,m=(a("47c1"),a("2877")),f=Object(m["a"])(p,i,s,!1,null,"2ddd3d1e",null);e["a"]=f.exports},"560f":function(t,e,a){"use strict";a("ce63")},"56d8":function(t,e,a){},5868:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{},[t.dialogVisible?a("el-dialog",{ref:"wkDialog",attrs:{"append-to-body":!0,"close-on-click-modal":!1,visible:t.dialogVisible,title:t.title,width:"800px","custom-class":"no-padding-dialog"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.handleClose}},[a("div",{staticClass:"main"},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"100px"}},t._l(t.fieldList,(function(e,i){return a("el-form-item",{key:i,style:{width:e.width},attrs:{label:e.label,prop:e.field}},["txt"==e.type?a("el-input",{attrs:{placeholder:e.placeholder},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}}):"user"==e.type?a("wk-user-select",{staticStyle:{width:"100%"},attrs:{props:t.userSelectProps,radio:""},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}}):"date"==e.type?a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:e.placeholder},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}}):"textarea"==e.type?a("el-input",{attrs:{type:"textarea",placeholder:e.placeholder},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}}):t._e()],1)}))),t._v(" "),a("div",{staticClass:"btn-wrap",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:t.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[t._v("保存")]),t._v(" "),a("el-button",{nativeOn:{click:function(e){return t.handleClose(e)}}},[t._v("取消")])],1)],1)]):t._e()],1)},s=[],n=a("5530"),r=(a("b0c0"),a("1658")),o=a("a535"),l=a("5c0a"),c=a("9dba"),d=a("2f62"),u={name:"CreateIteration",components:{WkUserSelect:l["a"]},mixins:[c["a"]],props:{visible:{type:Boolean,required:!0,default:!1},itemType:String,type:String,detailData:{type:Object,default:function(){return{}}}},data:function(){return{dialogVisible:!1,loading:!1,fieldList:[{type:"txt",label:"迭代名称",field:"name",placeholder:"请输入迭代名称",width:"100%"},{type:"date",label:"开始时间",field:"startTime",placeholder:"请选择开始时间",width:"48%"},{type:"date",label:"结束时间",field:"stopTime",placeholder:"请选择结束时间",width:"48%"},{type:"textarea",label:"迭代目标",field:"target",placeholder:"请输入迭代目标",width:"100%"},{type:"user",label:"负责人",field:"mainUserId",width:"48%"}],ruleForm:{name:"",mainUserId:"",startTime:"",stopTime:"",target:""},rules:{name:[{required:!0,message:"请输入迭代名称",trigger:"change"}]}}},computed:Object(n["a"])(Object(n["a"])({},Object(d["b"])(["userInfo"])),{},{title:function(){return"edit"==this.type?"编辑迭代":"新建迭代"},userSelectProps:function(){return{request:o["u"],params:{projectId:this.$route.params.id},isList:!0}}}),watch:{visible:{handler:function(t){t&&(this.ruleForm={name:this.detailData.name,mainUserId:this.detailData.mainUserId,startTime:this.detailData.startTime,stopTime:this.detailData.stopTime,target:this.detailData.target}),this.dialogVisible=t},immediate:!0}},methods:{handleClose:function(){this.dialogVisible=!1,this.$emit("update:visible",!1),this.$emit("close")},handleConfirm:function(){var t=this;this.$refs.ruleForm.validate((function(e){if(e){t.loading=!0;var a=Object(n["a"])({companyId:t.userInfo.companyId,type:1,projectId:t.$route.params.id},t.ruleForm);"edit"==t.type&&(a.taskId=t.detailData.taskId);var i="edit"==t.type?r["qb"]:r["W"];i(a).then((function(e){t.$emit("save-success",{type:t.itemType}),t.loading=!1})).catch((function(){t.loading=!1}))}}))}}},h=u,p=(a("00cd"),a("2877")),m=Object(p["a"])(h,i,s,!1,null,"5bda30e0",null);e["a"]=m.exports},"596b":function(t,e,a){"use strict";a("1c17")},"5a29":function(t,e,a){},"5a4a":function(t,e,a){"use strict";a("041c")},"5e68":function(t,e,a){},6062:function(t,e,a){a("1c59")},"64a4":function(t,e,a){"use strict";a("5e68")},6566:function(t,e,a){"use strict";var i=a("9bf2").f,s=a("7c73"),n=a("6964"),r=a("0366"),o=a("19aa"),l=a("7234"),c=a("2266"),d=a("c6d2"),u=a("4754"),h=a("2626"),p=a("83ab"),m=a("f183").fastKey,f=a("69f3"),b=f.set,v=f.getterFor;t.exports={getConstructor:function(t,e,a,d){var u=t((function(t,i){o(t,h),b(t,{type:e,index:s(null),first:void 0,last:void 0,size:0}),p||(t.size=0),l(i)||c(i,t[d],{that:t,AS_ENTRIES:a})})),h=u.prototype,f=v(e),g=function(t,e,a){var i,s,n=f(t),r=k(t,e);return r?r.value=a:(n.last=r={index:s=m(e,!0),key:e,value:a,previous:i=n.last,next:void 0,removed:!1},n.first||(n.first=r),i&&(i.next=r),p?n.size++:t.size++,"F"!==s&&(n.index[s]=r)),t},k=function(t,e){var a,i=f(t),s=m(e);if("F"!==s)return i.index[s];for(a=i.first;a;a=a.next)if(a.key==e)return a};return n(h,{clear:function(){var t=this,e=f(t),a=e.index,i=e.first;while(i)i.removed=!0,i.previous&&(i.previous=i.previous.next=void 0),delete a[i.index],i=i.next;e.first=e.last=void 0,p?e.size=0:t.size=0},delete:function(t){var e=this,a=f(e),i=k(e,t);if(i){var s=i.next,n=i.previous;delete a.index[i.index],i.removed=!0,n&&(n.next=s),s&&(s.previous=n),a.first==i&&(a.first=s),a.last==i&&(a.last=n),p?a.size--:e.size--}return!!i},forEach:function(t){var e,a=f(this),i=r(t,arguments.length>1?arguments[1]:void 0);while(e=e?e.next:a.first){i(e.value,e.key,this);while(e&&e.removed)e=e.previous}},has:function(t){return!!k(this,t)}}),n(h,a?{get:function(t){var e=k(this,t);return e&&e.value},set:function(t,e){return g(this,0===t?0:t,e)}}:{add:function(t){return g(this,t=0===t?0:t,t)}}),p&&i(h,"size",{get:function(){return f(this).size}}),u},setStrong:function(t,e,a){var i=e+" Iterator",s=v(e),n=v(i);d(t,e,(function(t,e){b(this,{type:i,target:t,state:s(t),kind:e,last:void 0})}),(function(){var t=n(this),e=t.kind,a=t.last;while(a&&a.removed)a=a.previous;return t.target&&(t.last=a=a?a.next:t.state.first)?u("keys"==e?a.key:"values"==e?a.value:[a.key,a.value],!1):(t.target=void 0,u(void 0,!0))}),a?"entries":"values",!a,!0),h(e)}}},"664f":function(t,e,a){},"66c8":function(t,e,a){},6894:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAABYlAAAWJQFJUiTwAAAFAklEQVR4nO2bT0wUVxzHP7sQFljAEv4EOehJxaagtNaFSJomstaakIaQkkgltmnTepJD02vVc1NTbvZgWku1CQkhjYlR4dADCeA/WiBA483DSgSLCusCgaWH326K23nDvNnZWWH5JJuQfcPvfee7M2/e/H7veVjH2kwoG2gH2oB3gGK2BnPAfeAa0OUpq1yJN3jif6zNhKqAHuBN1+W5ywTQ4imrnIKYAbGTHwTeSJ8uV3kG1HvKKqc8scv+L7b+L5/IBHDAi9zzmXbyIOfc7kUGvEylzbM2E/qHrTPa6zLnJXNPHqDYm24F6SbjDch2vcfFl/AkBAvPYWlRvvPlQsEOKK+E3HxX5aTegOUlGLsDUyPyeTptfnxJBVTVyqf6MOT4UirPszYTWktJ5NnH0N8Lw/2wFLEXw5cHgUZobIbSnc7qi+G8AeF5uN4FAzcguupMTG8WNJyApnbwFzoTM4azBowOw6+dsDDnWMhXKCiGUx1QE3AspDMGRKPw+xXo63ZAkgWCrfDRafAm/xBL3oDVFbjyPdz7I2kxWhx6H05/DVnJjePJ/Xc0av3ks3OgOgD7a2H3Xigph/zY/RwJw+w0PHoIkyMwOgQry+bx4n1++k1SV0JyV0DvTxtf9v4iONoC73343wlvRCQMAzfhdjeEX5gfG2yF5s+sxTXAvgGjw3DpvPkxgSC0fAEFRba6IDwPPZdh6Jb5cWfO2x4Y7RkQnocLX6lHe48H2s7CkeO2RP2PwT642ql+rBYUw7kfbT0i7d0817vMT/7Lb507eYD6IJw5J/MBIxbmRJMN9A2YfSyTHBVtZ+FAnS0xprz1LnzSoW4fuCHaNNE3oL9XfSkGgs7+8onUB6HuA+O26Kpo00TPgOUlmdsb4S+SAS/VtHwufRkx3C8aNdAzYOyO+sXmaIv90V4HfyEcazVuW4qIRg30DJgaMf4+O0ee827RcFz6NGLygVYoZwyoDlif5DhBnh9qFAPt339qhbJuwOJLdTJjf61Wp46g6vPptGi1iHUDnoTUbbv3Wg7jGLv2qNvMtCZg3YCF5+q2knLLYRyjtELdZqY1AesGxBOYRrh5/8fJ86vbzLQmkPFpcesG+HLVbZGwA1I0MevTTGsC1g0o2KFum90g1Z0KzPo005qAdQPKK9Vtjx5aDuMYZn2aaU3AugG5+VK0MGJSMUFKJao+Syq0qkt6g2CVYvIxOuTuOBAJS59G7DuoFcoZA1aWJYfnFgM31UnT/W9rhdIzoPqwlKuMuN0tqbJUE56Xvozw5YlGDfQMyPFJrc5Q2AtJYKaansvqTHGgUbuYqj8RamxW5+aGbkkCM1UM9qkzxN4s0aaJvgGlO6VQqeJqJ4zf1Q67IeN3JbaKhhO2Ksj2psJN7ZKKNiK6CpcuOHslDPZJTLO0eFO7rdD2DPAXSpVWRXQVui7CLz8kNzCG5yVG10XzUvupDttlc3dKY8daJY1l9ga3nk1RGgMpjv78nfXiaE2dZHJ27ZH3+bghdoqjIBXitBZHYdOXx7cXSGwvkdleJLW9TC41BsSJL5ScfCBFCysLJfcdlLe6Tb1QUsVrtlTWfQNeM7bT4ukWkG68yKbCTGXOC9xLt4o0ct8L/JZuFWnkWnzj5BhQlW41LiMbJ2MbiT8GNnjx3lI8Q/YPr3gBPGWV48ARYCqdqlxigti+YVi3exxe2T5/EjjE1tlTqNw+/y9M0diegvOS1gAAAABJRU5ErkJggg=="},"6d61":function(t,e,a){"use strict";var i=a("23e7"),s=a("da84"),n=a("e330"),r=a("94ca"),o=a("cb2d"),l=a("f183"),c=a("2266"),d=a("19aa"),u=a("1626"),h=a("7234"),p=a("861d"),m=a("d039"),f=a("1c7e"),b=a("d44e"),v=a("7156");t.exports=function(t,e,a){var g=-1!==t.indexOf("Map"),k=-1!==t.indexOf("Weak"),y=g?"set":"add",C=s[t],w=C&&C.prototype,T=C,_={},x=function(t){var e=n(w[t]);o(w,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(k&&!p(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return k&&!p(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(k&&!p(t))&&e(this,0===t?0:t)}:function(t,a){return e(this,0===t?0:t,a),this})},I=r(t,!u(C)||!(k||w.forEach&&!m((function(){(new C).entries().next()}))));if(I)T=a.getConstructor(e,t,g,y),l.enable();else if(r(t,!0)){var D=new T,j=D[y](k?{}:-0,1)!=D,L=m((function(){D.has(1)})),S=f((function(t){new C(t)})),O=!k&&m((function(){var t=new C,e=5;while(e--)t[y](e,e);return!t.has(-0)}));S||(T=e((function(t,e){d(t,w);var a=v(new C,t,T);return h(e)||c(e,a[y],{that:a,AS_ENTRIES:g}),a})),T.prototype=w,w.constructor=T),(L||O)&&(x("delete"),x("has"),g&&x("get")),(O||j)&&x(y),k&&w.clear&&delete w.clear}return _[t]=T,i({global:!0,constructor:!0,forced:T!=C},_),b(T,t),k||a.setStrong(T,t,g),T}},"6f48":function(t,e,a){"use strict";var i=a("6d61"),s=a("6566");i("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),s)},"704b":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABHNCSVQICAgIfAhkiAAABA9JREFUSEu9l2tIFFEUgM+u5iMfs+KWmpD5J+gdWkGRKQSRPVCjfpSaGmgm5rOoDMqilFBSS+hhoJKmf8zKICgKTSgINC3o9ccelIYr7vpm0d3Ouc5M4+zs7qjRhcvcnTlzvjnnnnPuWQ2oHFarNRZFI3Gux6njr/R2F04jf23VaDQP1ajUOBJCGAGycebwMDU66SPKcVbgR9BacdgFIzQZ3ygTgOYv72GsrQXGO9phsvcbzu9MoWvQUpwh4BkeAQsj94Lb8jUCiKApCH+gRFYEI5S+mCyFic52GLxdxK5qhkdYBPilFQBd+VGO8Fz5uzZghNagUBIJ9l88CiOP69XwbGS898TDonO3hPs1CE+RCs0AC5ZaRkzQm74TyL3zGWR1QGkjaL05UkN7TrHChgjm97Sabv5M2DxvqAAgeNDNJ8LPOGHPGZiP3h5c6uTudV+9EawWC5g/dKgyXkle4nYKuFCKdgFciDfOUwD1pkeLALdVGyCwohlAq4WB4iwYfdbkEO614wD4n8a4xA/ty4rBj+0U5clqPuAuILhQANOXcASVRq/n1mjQoyLXxcEwNWgA090yMNVVKMK5w3nAxWeBi58eJvt/geFyJoy/eirKSlxuRLCfhq9IzRRItLfy4YvKdEn54KLztwvnEnOBS8hm0CnjABirS2CoodJGV3DdayHP4wjMctZYVQSDOJWGIziXkANcYo5TKOn1Sy0AHU4cFQRuxUWk3M1qLCcZstaZpQoR3kbgr/gg5EfMSrEM2osgqeWThj4m5qoPdOheqS4qp+RuHF0EttKqZ5O3w4gVHjL4kVPg4sOKAkwNm8B4p1hxT5UUhr4ZYbdnDaYg8tmfBguWhDAFdGCYGm/MCaza1dJAmhz4jZWHXB0wF1d3qw4upZQhi3UpJ6dTjdKophSG7l23u2WSXGbB5TSdpMVBnqe+BzMlcAMYa6/CUP01Rbg8nailwQLyDgvIFpsXWBnML3GYMr6HjoMu+QRvuQEGruTB6PP7NrpmFBB6ilYrlkx3rNUBZU1/XWmnIpGOGUUG3d6XHQvmj29FuMTNJiyZupmHRMdL6D22SxR2WxEGgZWPMPa1YLiUAWMvFLsYUd5r+z7Qn61EQ/CQyNgN5s/d4jN7hwQ1dRTdnPxYJDiei2D+RM2k86EkLzkWTahhmXgs8u5me03r/9YICHaIrc+wEV0ePe8uhLU+JQ2g9SGH2ml9JPAaXP/rZq8W3Zss3Sjn7S0G3GBV8eza29Qz4BG+TeCwjkMeHY4aetpzsp6dBpTno60tMIENvWXUJG4DnThaLw5BEeAVRQ39WoFBgZQ8q4Ze4nbaHGpJaU4fR84HAakaUiM/+78wcv18ixSF94U/bet4GUpW6Z82x8nOv/QH6Y86/GAeSQEAAAAASUVORK5CYII="},7078:function(t,e,a){"use strict";a.d(e,"b",(function(){return s})),a.d(e,"a",(function(){return n}));a("d3b7"),a("159b"),a("b64b");var i=a("b775");function s(t){return Object(i["a"])({url:"hrmEmployee/queryInEmployeeList",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function n(t){return Object(i["a"])({url:"hrmEmployee/queryDeptEmployeeList/".concat(t),method:"post"})}},7195:function(t,e,a){"use strict";a.d(e,"b",(function(){return s})),a.d(e,"a",(function(){return n}));var i=a("b775");function s(t){return Object(i["a"])({url:"/hrmEmployee/queryInspectionDeptEmployeeList/".concat(t),method:"post",data:t})}function n(t){return Object(i["a"])({url:"hrmEmployee/queryInspectionAllEmployeeList",method:"post",data:t})}},"71fa":function(t,e,a){},7714:function(t,e,a){"use strict";a("edcf")},"77bc":function(t,e,a){"use strict";a("0cd3")},"790d":function(t,e,a){"use strict";a("bf01")},"796a":function(t,e,a){"use strict";a("93a3")},"796a3":function(t,e,a){},"7b96":function(t,e,a){},"7ba3":function(t,e,a){"use strict";a("ca1e")},"7e09":function(t,e,a){},"7e33":function(t,e,a){"use strict";a("ce25")},8067:function(t,e,a){},"806b":function(t,e,a){"use strict";a("66c8")},"82e4":function(t,e,a){},"834f":function(t,e,a){},86906:function(t,e,a){"use strict";a("b07b")},8696:function(t,e,a){"use strict";a("664f")},8862:function(t,e,a){"use strict";a("796a3")},"88ff":function(t,e,a){"use strict";a("0100")},8917:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var i=a("b775");function s(t){return Object(i["a"])({url:"jxcProductType/queryJxcProductType",method:"post",data:t})}},"8a8e":function(t,e,a){},"8f79":function(t,e,a){},"92d3":function(t,e,a){"use strict";a("d6bf")},9346:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{loading:t.loading,title:t.title,visible:t.visible,"append-to-body":"",width:"700px","before-close":t.close},on:{"update:visible":function(e){t.visible=e}}},[a("div",{staticClass:"el-dialog-div"},[a("el-form",{ref:"formData",staticClass:"demo-ruleForm",attrs:{model:t.formData,rules:t.rules}},[a("el-form-item",{attrs:{label:"公告内容",prop:"content"}},[a("el-input",{attrs:{type:"textarea",rows:8},model:{value:t.formData.content,callback:function(e){t.$set(t.formData,"content",e)},expression:"formData.content"}})],1)],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.close}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确定")])],1)])},s=[],n=(a("a9e3"),a("dc1b")),r={name:"CreateNotice",components:{},props:{action:{type:Object,default:function(){return{type:"create"}}},projectId:{type:[String,Number],required:!0},visible:Boolean},data:function(){return{formData:{content:""},rules:{content:[{required:!0,message:"公告正文不能为空",trigger:"blur"},{max:1e3,message:"最长不超过1000个字符",trigger:"change"}]},loading:!1}},computed:{title:function(){return"create"==this.action.type?"新建公告":"编辑公告"}},created:function(){if("edit"==this.action.type){var t=this.action.data;this.formData={content:t.content}}},methods:{onSubmit:function(){var t=this;this.$refs.formData.validate((function(e){if(!e)return!1;t.loading=!0;var a={projectId:t.projectId,content:t.formData.content};"edit"==t.action.type&&(a.projectAnnouncementId=t.action.data.projectAnnouncementId);var i={create:n["a"],edit:n["d"]}[t.action.type];i(a).then((function(e){t.$message.success("".concat(t.title,"成功")),t.$emit("onSubmit"),t.close(),t.loading=!1})).catch((function(){t.$message.error("".concat(t.title,"失败")),t.loading=!1}))}))},close:function(){this.$emit("close")}}},o=r,l=(a("c1a0"),a("2877")),c=Object(l["a"])(o,i,s,!1,null,"4efd6ab8",null);e["a"]=c.exports},"93a3":function(t,e,a){},"94dd":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAABYlAAAWJQFJUiTwAAAELklEQVR4nO2bTWwbRRiGn93sOnY3TeLEdV27KVB+FJWKklIQpQogAQdQDygIAUEBDqWnSpwQ4siVnpCQkCouKCItSCAuXBBIoABVEakKrSILVNQUYpI0sZ0Ex4l3Y3NwIoXu2jOo8Y5k73OKZr/NvPPueMb+Zj+NLWTsigGMAMPAA0CU5iAHTABjwGjS1JzNC9rmHxm70g98BhzwXZ6/TALPJU0tDRsGbAz+PNCtTpev5IGjSVNLaxvT/hea/8nfzCRwSKf6mW+1wUN1zCM61QWvVRnWMnYlS/Os9v+XnJaxKxXVKlSiqxagmsAA1QJUExigWoBqDNnAcqXC97PLXMwVWbbXiYdNjsUsDvbsaKS+hiO1Dc6slHj71wxfFUqua6/v6uCtexNE2mpPpqJT5svpPBcWCuSd8q0pFhAz23g03sFTe7owdE0YLzRgxSnzyoUpzq/aNWNOxCzeOZTyvJZdczg18RffFd3mNZKhrjDvDuyt+2BAYg344nqu7uABPpwvcGlhxfPae+lZ3wcP8PniKh9dnRfGCQ34Zm5ZqsPxG+643JrDx/MFqfsbwWhmibLgAy40IL3qiEIA+NtjlswUbYpSdzeGa+tlcqX6s1doQMJok+qsy3THdXq0+UkE6DTrb3RCAx7piUh1djjq3g6TVognrZDU/Y1guNfCFOwEQgNevC1KXPBPBiMGjyc6Xe0a8OY9cXo18Xa03ew3dE7eHRPGCQ1IWe28fyBR04SBkMHp+1I1nT7Ys4NPD/fxQrfcTLpVDK26LZ870sdeq10YL50P+POfNcamsoxni1y2HR5sN3lmdwdD+6J0h+S+UNrlCoslh0ZlIHQNukKG1BegTYKEiGoBqgkMUC1ANYEBqgWoJjBAtQDVBAaoFqCawADVAlQTGKBagGoCA1QLUI300djNCZGHwgZPx3e2RkLkh9llTk3OMOeRZB8IGXwwkKKvo3b6KZ1f5czVG3ySb3yS3NDgtV6Lk3fFSG1HSmy6sMbxn657Dn6TwYjB6MN3eOYFr2RXGL40zYLPiaf9hs5ZibygcA04N5WrO3iA8aLDtzNLrvYKcPq3Od8HD/CHU+bM79twNPZjVm7aXsy5zwYzhRJfe5wo+8XYQgFb8PCEBsw461KdLdruuCWPNj8pAkt2/aM9oQH9YbkVfk/YdLUlIib+nAZ4c3ubTjTk1rUVoQFPxHdKdTa4yx0XbTd4OWZJ3d8IRpKdiHZEoQHP7oty1OPpbuVEzOL+Xu9XZd7o381jEf/PB4e6wrx6p/hoLHhFRvZkqKVfkmpmWv7HUGCAagGqCQxQLUA1OtWiwlYlpwM/q1ahkAkdOKtahULGNgsnLwP9qtX4TLVwcqOQ+HnAndJpXvJU64cdHSBpaleAY0BapSqfmGSjbhi2VI/Df8rnXwKO0DwFlTXL5/8FYO93uLXgnbwAAAAASUVORK5CYII="},9732:function(t,e,a){},9759:function(t,e,a){},9821:function(t,e,a){"use strict";a("480b")},"9dba":function(t,e,a){"use strict";e["a"]={watch:{loading:function(t){if(t){var e=this.$refs.wkDialog.$refs.dialog;this.loadingInstance=this.$loading({target:e})}else this.loadingInstance&&this.loadingInstance.close()}}}},a03b:function(t,e,a){"use strict";a("82e4")},a074:function(t,e,a){"use strict";a("e926")},a123:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAABYlAAAWJQFJUiTwAAADMUlEQVR4nO2bzUsUcRjHPzOz7ri+bbvK6q6WYWqrLmmaZIRQh/CgBOEbWdob2BsUEfTf1KFIQYgIEgIPHbvkITLZDCwvHkTSOpgv+9Jh11LL1xnnKXc+p2VmeObzfPc3v4UdHoUVTE3GHUA30AXUAR72BjPAMNAHPPEFlMjyCWX5w9RkPAg8Ayot17OWUaDVF1DCkAwg2fwbYJ+cl6XMAid8ASWsJJf9O/b+N7+WUaBaJfHMp1rzkOi5WyWx4aUqXcrUZPwre2e33y4zKqnbPIBHlTaQxg5AWkAaOwBpAWlSPgCHWYUWF6JEo2ZV2xhNA6eumVLLcADzPyIMPP5IeGTaDJ8tEwzl0dlzGN1lrAXDj8DQ4ITlzQOER6YZGpwwXMdwABPj3wxLSN7bcADxeNywxE6JmXDvlP8VsAOQFpDGDkBaQBo7AGkBaewApAWksQOQFpDGDkBaQBo7AGkBaewApAWksQOQvLm/MAtfQaakgnnvBbZLTX0+5zrLiETh6cMPjI/NiHhYvgJUVaGlrYyOniBpuoYrQ+PKrRA19flWqwAWr4CsbCdd16o4eChn1XFNU2nvDuLJdfH61RcrlawLoLjETdfVSrLdzr+eVxQ401yMN1fnef8YsZg1f7dbEkBDYyHNrSVo2uZPXF1DAdlunf5HoyzMRza93ii7ugc40lTaLgY521G6peaXKa/w0Hu3hhy3vot2CXYtAI83nRv3jlJ7fGebm78ok5v3a/EXZZlstppdCaC0wsvtB3UE9huTd3uc9N6pprTCa5LZn5gewKmmYi5fD5GRac72orscXOoNUdfgN6XeWkzbBHVdo62ngqojuWaV/IXmUGi9UI43L52hl59/H9/GvrIehgNoaS1jbm4JfyATb166YaGNON10AI83nRcDn1hajNLQGDBcU5maFHy/vUNi0TixaByH8x9YARKomoKqKZtfuJVaplT5j7EDkBaQxg5AWkAaOwASQ4WpyowKvJW2EGRYBfqlLQTpWx6cfA8EpW0sJjE4mRwkbge+CwtZySyJ+eGICuALKCPASSAsaWURoyTnhmHF9DisGp8/Dxxj78wUrjs+/xOOj6LaJAENaQAAAABJRU5ErkJggg=="},a19b:function(t,e,a){},a1c1:function(t,e,a){"use strict";a("e1a3")},a693:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("xr-create",{attrs:{loading:t.loading,title:t.title},on:{close:t.handleClose,save:t.saveClick}},[i("create-sections",{attrs:{title:"基本信息"}},[i("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"100px"}},t._l(t.fieldList,(function(e,s){return i("el-form-item",{key:s,style:{width:e.width},attrs:{label:e.label,prop:e.field}},["text"==e.type?i("el-input",{attrs:{type:"textarea",maxlength:"100","show-word-limit":"",placeholder:e.placeholder},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}}):"number"==e.type?i("el-input",{attrs:{type:"number",maxlength:"100",placeholder:e.placeholder},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}}):"user"==e.type?i("wk-user-select",{staticStyle:{width:"100%"},attrs:{props:t.userSelectProps,radio:""},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}}):"users"==e.type?i("wk-user-select",{staticStyle:{width:"100%"},attrs:{props:t.userSelectProps},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}}):"date"==e.type?i("el-date-picker",{staticStyle:{width:"100%"},attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"date",placeholder:e.placeholder},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}}):"textarea"===e.type?i("tinymce",{ref:"editor",refInFor:!0,staticClass:"rich-txt",attrs:{height:200,init:{menubar:!1,toolbar_sticky:!0,statusbar:!1,contextmenu:"",content_style:"p { margin: 5px 0; line-height: 1.5;}",plugins:"paste",toolbar:"paste",paste_data_images:!0}},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}}):"item"==e.type?i("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",remote:"",clearable:"","remote-method":t.getItemData,loading:t.itemLoading},on:{focus:function(e){t.getItemData("")}},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}},t._l(t.options[e.field],(function(t){return i("el-option",{key:t.taskId,attrs:{label:t.name,value:t.taskId}})}))):"select"==e.type?i("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:e.placeholder},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}},t._l(t.options[e.field],(function(a){return i("el-option",{key:a.key,attrs:{label:a.label,value:a.key}},["boardStatusId"===e.field?[i("status-tag",{attrs:{type:a.statusType,"status-name":a.statusName}})]:t._e()],2)}))):"file"==e.type?i("div",{staticClass:"file"},[i("file-cell",{attrs:{"file-list":t.ruleForm[e.field],"show-time":!1,"show-delete":""},on:{delete:function(e){t.fileDelete(arguments[0],arguments[1],t.data)}}}),t._v(" "),i("el-upload",{staticClass:"upload-file",attrs:{"http-request":t.httpRequest,action:"https://jsonplaceholder.typicode.com/posts/",multiple:"","list-type":"picture"}},[i("span",{staticClass:"add-btn"},[i("i",{staticClass:"wk wk-l-plus"}),t._v(" "),i("span",{staticClass:"label"},[t._v("附件")])])])],1):"subItem"==e.type?[i("div",{staticClass:"sub-task-all"},t._l(t.ruleForm[e.field],(function(s,n){return i("div",{key:n,staticClass:"sub-task"},[s.showEdit?i("handle-sub-item",{attrs:{name:s.name,type:"update"},on:{update:function(e){t.addOrUpdateSubItem(e,n,"update")}}}):i("flexbox",{staticStyle:{padding:"14px"}},[i("div",{on:{click:function(t){t.stopPropagation()}}},[i("el-checkbox",{model:{value:s.checked,callback:function(e){t.$set(s,"checked",e)},expression:"sitem.checked"}})],1),t._v(" "),i("img",{staticClass:"item-img",attrs:{src:a("02fe"),alt:""}}),t._v(" "),i("div",{staticClass:"sub-task__bd text-one-line",class:{"is-checked":s.checked}},[t._v("\n                  "+t._s(s.name)+"\n                ")]),t._v(" "),i("div",{staticClass:"edit-del-dropdown"},[i("el-dropdown",{attrs:{"hide-on-click":!1},on:{command:function(e){t.handleSubItem(e,n)}}},[i("span",{staticClass:"el-dropdown-link"},[i("i",{staticClass:"el-icon-more",staticStyle:{cursor:"pointer"}})]),t._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:{type:"update",data:e}}},[i("span",[t._v("编辑")])]),t._v(" "),i("el-dropdown-item",{attrs:{command:{type:"delete",data:e}}},[i("span",[t._v("删除")])])],1)],1)],1)])],1)}))),t._v(" "),t.addSubtasks?i("handle-sub-item",{attrs:{type:"add"},on:{add:t.addOrUpdateSubItem}}):t._e(),t._v(" "),t.addSubtasks?t._e():i("span",{staticClass:"add-btn",on:{click:function(e){t.addSubtasks=!0}}},[i("i",{staticClass:"wk wk-l-plus"}),t._v(" "),i("span",{staticClass:"label"},[t._v("子工作项")])])]:t._e()],2)})))],1)],1)},s=[];a("a4d3"),a("b64b");function n(t,e){if(null==t)return{};var a,i,s={},n=Object.keys(t);for(i=0;i<n.length;i++)a=n[i],e.indexOf(a)>=0||(s[a]=t[a]);return s}function r(t,e){if(null==t)return{};var a,i,s=n(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(i=0;i<r.length;i++)a=r[i],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(s[a]=t[a])}return s}var o=a("5530"),l=(a("a9e3"),a("caad"),a("14d9"),a("a15b"),a("d81d"),a("b0c0"),a("a434"),a("1658")),c=a("a535"),d=a("e04a"),u=a("8156"),h=a("10ff"),p=a("8256"),m=a("5c0a"),f=a("deea"),b=a("1557"),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:t.handleBlur,expression:"handleBlur"}],staticClass:"create-box"},[i("el-checkbox",{staticClass:"checked",model:{value:t.checked,callback:function(e){t.checked=e},expression:"checked"}}),t._v(" "),i("img",{staticClass:"item-img",attrs:{src:a("02fe"),alt:""}}),t._v(" "),i("el-input",{ref:"subInput",staticClass:"input",attrs:{placeholder:"子工作项标题"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1)},g=[],k={name:"HandleSubItem",components:{},props:{type:String,name:String},data:function(){return{checked:!1,title:""}},computed:{},watch:{},created:function(){this.name&&(this.title=this.name)},mounted:function(){this.$refs.subInput.focus()},methods:{handleClose:function(){this.$emit("close")},handleBlur:function(t){this.$emit(this.type,{checked:this.checked,name:this.title}),this.title=""}}},y=k,C=(a("df8a"),a("2877")),w=Object(C["a"])(y,v,g,!1,null,"0d7d091f",null),T=w.exports,_=a("6651"),x=a("ed08"),I=a("7a1a"),D=a("2f62"),j=["actualHour","surplusHours","childTaskList","projectTaskRelation"],L={name:"CreateItem",components:{XrCreate:u["a"],CreateSections:h["a"],Tinymce:p["a"],FileCell:f["a"],WkUserSelect:m["a"],StatusTag:b["a"],HandleSubItem:T},props:{visible:{type:Boolean,required:!0,default:!1},itemType:String,isAgility:Boolean,iterationId:[String,Number]},data:function(){return{loading:!1,dialogVisible:!1,fieldList:[],itemLoading:!1,ruleForm:{},rules:{name:[{required:!0,message:"请输入事项标题",trigger:"change"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}]},options:{priority:_["f"],belongIterationId:[],boardStatusId:[],relatedDemandId:[],wrongType:[{label:"功能缺陷",key:1},{label:"UI界面问题",key:2},{label:"易用性问题",key:3},{label:"安全问题",key:4},{label:"性能问题",key:5},{label:"代码错误",key:6}]},batchId:Object(x["q"])(),addSubtasks:!1,childSubList:[]}},computed:Object(o["a"])(Object(o["a"])({},Object(D["b"])(["userInfo"])),{},{title:function(){var t={Require:"需求",Task:"任务",Defects:"缺陷"}[this.itemType];return"新建".concat(t)},eventId:function(){var t={Require:1,Task:2,Defects:3}[this.itemType];return t},userSelectProps:function(){return{request:c["u"],params:{projectId:this.$route.params.id},isList:!0}}}),watch:{visible:{handler:function(t){this.dialogVisible=t,t&&(this.getField(),this.getIterationOption(),this.getAllStatus())},immediate:!0}},created:function(){this.debouncedSaveField=Object(I["debounce"])(300,this.saveClick)},mounted:function(){},beforeDestroy:function(){},methods:{getField:function(){for(var t=this,e=[{type:"text",label:"事项标题",field:"name",placeholder:"请输入事项标题",width:"100%"},{type:"textarea",label:"事项描述",field:"description",placeholder:"请输入事项描述",width:"100%"},{type:"date",label:"开始时间",field:"startTime",placeholder:"请选择开始时间",width:"50%"},{type:"date",label:"结束时间",field:"stopTime",placeholder:"请选择结束时间",width:"50%"},{type:"select",label:"优先级",field:"priority",placeholder:"请选择优先级",width:"50%"},{type:"user",label:"处理人",field:"mainUserId",width:"50%"},{type:"users",label:"团队成员",field:"ownerUserId",width:"50%"},{type:"select",label:"状态",field:"boardStatusId",placeholder:"请选择状态",width:"50%"},{type:"select",label:"所属迭代",field:"belongIterationId",placeholder:"请选择所属迭代",width:"50%"},{type:"number",label:"进度",field:"progress",placeholder:"请输入进度",width:"50%"},{type:"number",label:"预估工时",field:"estimatedManHours",placeholder:"请输入预估工时",width:"50%"},{type:"number",label:"实际投入时长",field:"actualHour",placeholder:"请输入实际投入时长",width:"50%"},{type:"number",label:"剩余工时",field:"surplusHours",placeholder:"请输入剩余工时",width:"50%"},{type:"item",label:"关联需求",field:"relatedDemandId",placeholder:"未关联需求",width:"50%"},{type:"select",label:"缺陷类型",field:"wrongType",placeholder:"请选择缺陷类型",width:"50%"},{type:"subItem",label:"子工作项",field:"childTaskList",width:"50%"},{type:"file",label:"附件",field:"file",width:"50%"}],a=[],i=function(e){return!t.isAgility&&["belongIterationId","progress","estimatedManHours","childTaskList"].includes(e.field)||"Defects"!==t.itemType&&["relatedDemandId","wrongType"].includes(e.field)},s=0,n=e;s<n.length;s++){var r=n[s];i(r)||(a.push(r),this.$set(this.ruleForm,r.field,this.initData(r)))}this.fieldList=a},initData:function(t){return["ownerUserId","file","childTaskList","projectTaskRelation"].includes(t.field)?[]:"priority"===t.field?"2":""},handleClose:function(){this.dialogVisible=!1,this.$emit("update:visible",!1),this.$emit("close")},saveClick:function(){var t=this;this.$refs.ruleForm.validate((function(e){if(e){t.loading=!0;var a=t.ruleForm,i=a.actualHour,s=a.surplusHours,n=a.childTaskList,c=void 0===n?[]:n,d=a.projectTaskRelation,u=r(a,j),h={};for(var p in d)if(Object.hasOwnProperty.call(d,p)){var m=d[p];h[p]=m.join()}var f=Object(o["a"])(Object(o["a"])({companyId:t.userInfo.companyId,type:_["e"][t.itemType],projectId:t.$route.params.id},u),{},{ownerUserId:u.ownerUserId.join(),projectTaskRelation:h,childTaskList:c.map((function(t){return{name:t.name}})),taskTimeList:[{actualHour:i,surplusHours:s}]});t.iterationId&&(f.belongIterationId=t.iterationId),Object(l["W"])(f).then((function(e){t.$emit("save-success",{type:t.itemType}),t.loading=!1})).catch((function(){t.loading=!1}))}}))},getItemData:function(t){var e=this,a={name:t,projectId:this.$route.params.id,pageType:0,type:2};this.itemLoading=!0,Object(l["R"])(a).then((function(t){e.options.relatedDemandId=t.data.list||[],e.itemLoading=!1})).catch((function(){e.itemLoading=!1}))},fileDelete:function(t,e,a){this.ruleForm["file"].splice(t,1)},httpRequest:function(t){var e=this;this.$wkUploadFile.upload({file:t.file,params:{batchId:this.batchId}}).then((function(t){var a=t.res,i=a.data||{},s=e.ruleForm["file"]||[];s.push(i),e.$set(e.ruleForm,"file",s),e.$message.success("上传成功")})).catch((function(){}))},addOrUpdateSubItem:function(t,e,a){if(!t.name)return this.$message.warning("请输入子工作项标题！");"update"===a?(this.ruleForm.childTaskList[e].showEdit=!1,this.ruleForm.childTaskList[e].checked=t.checked,this.ruleForm.childTaskList[e].name=t.name):(this.ruleForm.childTaskList.push(t),this.addSubtasks=!1)},handleSubItem:function(t,e){var a=t.type;"update"===a?this.$set(this.ruleForm.childTaskList[e],"showEdit",!0):"delete"===a&&this.ruleForm.childTaskList.splice(e,1)},subTaskDelete:function(t,e,a){this.ruleForm[a.field].splice(e,1)},subTaskAdd:function(t,e){var a=this.ruleForm[e.field]||[];a.push(t),this.$set(this.ruleForm,e.field,a)},getIterationOption:function(){var t=this,e={type:0,projectId:this.$route.params.id,name:"",pageType:0};Object(l["T"])(e).then((function(e){var a=(e.data.list||[]).map((function(t){return t.label=t.name,t.key=t.taskId,t}));t.$set(t.options,"belongIterationId",a)})).catch((function(){}))},getAllStatus:function(){var t=this,e={projectId:this.$route.params.id,eventId:{Require:1,Task:2,Defects:3}[this.itemType]};Object(d["b"])(e).then((function(e){t.allStatusList=e.data||[];var a=(e.data||[]).map((function(t){return t.label=t.statusName,t.key=t.id,t}));t.$set(t.options,"boardStatusId",a)}))}}},S=L,O=(a("ab61"),Object(C["a"])(S,i,s,!1,null,"d34dc688",null));e["a"]=O.exports},ab61:function(t,e,a){"use strict";a("cdfe")},abfd:function(t,e,a){"use strict";a("7e09")},ae7d:function(t,e,a){"use strict";a("04c5")},b07b:function(t,e,a){},b966:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"item",class:{clicked:t.item.clicked}},[a("div",{ref:"wrap",staticClass:"inner-wrap"},[a("el-tooltip",{attrs:{content:t.item.name,disabled:t.isShowTooltip,placement:"top"}},[a("span",{ref:"name",staticClass:"item-title"},[t._v(t._s(t.item.name))])]),t._v(" "),a("span",{on:{click:function(t){t.stopPropagation()}}},[t.dropdowns&&t.dropdowns.length>0?a("el-dropdown",{attrs:{trigger:"click"},on:{command:function(e){t.dropdownCommand(e,t.item)}}},[a("el-button",{staticClass:"dropdown-btn",attrs:{icon:"el-icon-more"}}),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.dropdowns,(function(e,i){return a("el-dropdown-item",{key:i,attrs:{command:e.command}},["plan"==e.command?[t.iterationList&&t.iterationList.length>0?a("el-dropdown",{attrs:{trigger:"hover"},on:{command:t.handleCommand}},[a("span",[t._v(t._s(e.name))]),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.iterationList,(function(e,i){return a("el-dropdown-item",{key:i,attrs:{command:e}},[t._v("\n                    "+t._s(e.name)+"\n                  ")])})))],1):t._e()]:[t._v("\n              "+t._s(e.name)+"\n            ")]],2)})))],1):t._e()],1)],1),t._v(" "),a("div",{staticClass:"item-desc"},[a("div",{staticClass:"item-left"},[a("img",{staticClass:"item-pic",attrs:{src:t.getIconClass(t.item)}}),t._v(" "),a("span",{staticClass:"mark"},[t._v("#"+t._s(t.item.num))])]),t._v(" "),a("div",{staticClass:"item-right"},[a("span",{staticClass:"icon-name"},[a("img",{staticClass:"item-img",attrs:{src:t.getPriorityPic(t.item.priority),alt:""}}),t._v(" "),a("span",[t._v(t._s(t.getPriority(t.item.priority)))])]),t._v(" "),a("status-tag",{attrs:{type:t.item.status,"status-name":t.item.boardStatusName}}),t._v(" "),t.item.mainUserId?a("xr-avatar",{staticClass:"user-photo",attrs:{id:t.item.mainUserId,trigger:"hover",name:t.item.mainUserName,src:t.item.mainUserImg,size:24}}):t._e()],1)])])},s=[],n=(a("14d9"),a("b0c0"),a("1658")),r=a("1557"),o=a("6651"),l={name:"Item",components:{StatusTag:r["a"]},props:{item:Object,iterationList:Array},data:function(){return{isShowTooltip:!0}},computed:{editAuth:function(){return this.$auth("coordination.editMatters","PM")},delAuth:function(){return this.$auth("coordination.deletMatters","PM")},dropdowns:function(){if(!this.editAuth&&!this.delAuth)return[];var t=[];return this.editAuth&&(this.item.belongIterationId?t.push({command:"move",name:"移出迭代"}):t.push({command:"plan",name:"规划进迭代"})),this.delAuth&&t.push({command:"del",name:"删除事项"}),t}},mounted:function(){var t=this;this.$nextTick((function(){t.isShowTooltip=t.$refs.name.offsetWidth<t.$refs.wrap.offsetWidth-35}))},methods:{getIconClass:function(t){return Object(o["b"])(t)},getPriority:function(t){return Object(o["a"])(t)},getPriorityPic:function(t){return Object(o["c"])(t)},dropdownCommand:function(t){var e=this;"move"==t?this.$confirm("确定移出迭代?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t={taskIds:[e.item.taskId]};Object(n["D"])(t).then((function(t){e.$message.success("操作成功"),e.$emit("save-success")}))})).catch((function(){})):"del"==t&&this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t={taskId:e.item.taskId};Object(n["N"])(t).then((function(t){e.$message({type:"success",message:"删除成功"}),e.$emit("save-success")})).catch((function(){}))})).catch((function(){}))},handleCommand:function(t){var e=this,a={taskIds:[this.item.taskId],belongIterationId:t.taskId};Object(n["D"])(a).then((function(t){e.$message.success("操作成功"),e.$emit("save-success")}))}}},c=l,d=(a("88ff"),a("2877")),u=Object(d["a"])(c,i,s,!1,null,"0e7aed82",null);e["a"]=u.exports},ba94:function(t,e,a){"use strict";a("5a29")},bb2f:function(t,e,a){var i=a("d039");t.exports=!i((function(){return Object.isExtensible(Object.preventExtensions({}))}))},bd6c:function(t,e,a){},bf01:function(t,e,a){t.exports={colorPrimary:"#0052CC",colorBlack:"#172B4D",colorSuccess:"#36B37E",colorWarning:"#FFAB00",colorDanger:"#FF5630",colorN40:"#DFE1E6",axisLineColor:"#DFE1E6",axisLabelFontWeight:"500"}},bfee:function(t,e,a){},c1a0:function(t,e,a){"use strict";a("9759")},c82b:function(t,e,a){"use strict";a("05f8")},ca1e:function(t,e,a){},cb01:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"board-list"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"board-column-content-parent"},t._l(t.taskList,(function(e,i){return a("div",{key:i,staticClass:"board-column"},[a("flexbox",{staticClass:"board-column-wrapper ignoreClass",attrs:{orient:"vertical",align:"stretch"}},[a("div",{staticClass:"board-column-header"},[a("div",[a("span",{staticClass:"text"},[t._v(t._s(e[t.tableNameField])+"  "+t._s(e.children.length)+" ")])])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.draging,expression:"draging"}],staticClass:"board-column-content is-flex"},t._l(e.statusList,(function(e,i){return a("div",{key:i,ref:"taskRow",refInFor:!0,staticClass:"target-item",class:{"is-hover":e.hover},on:{dragenter:function(a){t.targetDragenter(a,e)},dragleave:function(a){t.targetDragleave(a,e)},dragover:function(a){t.targetDragover(a,e)},drop:function(a){t.targetDragDrop(a,e)}}},[t._v(t._s(e.statusName))])}))),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.draging,expression:"!draging"}],staticClass:"board-column-content"},t._l(e.children,(function(s,n){return a("div",{key:n,ref:"taskRow",refInFor:!0,staticClass:"board-item",attrs:{draggable:"true"},on:{dragstart:function(e){t.dragstart(e,s)},dragend:t.dragend}},[a("flexbox",{attrs:{align:"stretch"}},[a("draggable-item",{attrs:{item:s},nativeOn:{click:function(a){t.enterDetail(s,e.children,i,n)}}})],1)],1)})))])],1)}))),t._v(" "),t.taskDetailShow?a("item-detail",{ref:"particulars",attrs:{id:t.taskId,"detail-index":t.detailIndex,"no-listener-class":["el-table__body"]},on:{"update-list":t.handleUpdateList,close:function(e){t.taskDetailShow=!1}}}):t._e()],1)},s=[],n=a("5530"),r=a("b85c"),o=(a("4ec9"),a("d3b7"),a("3ca3"),a("ddb0"),a("14d9"),a("ac1f"),a("841c"),a("159b"),a("e9c4"),a("1658")),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"list-wrap",class:{clicked:t.item.clicked}},[a("div",{staticClass:"item-title"},[t._v(t._s(t.item.name))]),t._v(" "),t.item.stopTime?a("div",[a("el-tag",{staticClass:"project-tag",class:3==t.item.status?"is-common":[t.getOverTimeStatus(t.item.stopTime)],attrs:{"disable-transitions":""}},[t._v("\n      "+t._s(t.formatTime(t.item.stopTime)+"截止")+"\n    ")])],1):t._e(),t._v(" "),a("div",{staticClass:"item-desc"},[a("div",{staticClass:"item-left"},[a("img",{staticClass:"item-img",attrs:{src:t.getIconClass(t.item),alt:""}}),t._v(" "),a("span",{staticClass:"mark"},[t._v("#"+t._s(t.item.num))])]),t._v(" "),a("div",{staticClass:"item-right"},[a("span",{staticClass:"icon-name"},[a("img",{staticClass:"item-img",attrs:{src:t.getPriorityPic(t.item.priority),alt:""}}),t._v(" "),a("span",[t._v(t._s(t.getPriority(t.item.priority)))])]),t._v(" "),a("status-tag",{attrs:{"status-name":t.item.boardStatusName,type:t.item.status}}),t._v(" "),t.item.mainUserId?a("xr-avatar",{staticClass:"user-photo",attrs:{id:t.item.mainUserId,trigger:"hover",name:t.item.mainUserName,size:24,src:t.item.mainUserImg}}):t._e()],1)])])},c=[],d=a("1557"),u=a("6651"),h={name:"DraggableItem",components:{StatusTag:d["a"]},props:{item:{type:Object,required:!0}},data:function(){return{isShowTooltip:!0}},computed:{},watch:{},created:function(){},mounted:function(){},methods:{moveEndTask:function(){},onMouseOver:function(){this.$refs.title.offsetWidth>224?this.isShowTooltip=!1:this.isShowTooltip=!0},getIconClass:function(t){return Object(u["b"])(t)},getPriority:function(t){return Object(u["a"])(t)},getPriorityPic:function(t){return Object(u["c"])(t)},getOverTimeStatus:function(t){var e=this.handleTime(t);return"今天"===e||"明天"===e?"is-near":this.$moment(t).isBefore(this.$moment())?"is-over":"is-common"},formatTime:function(t){if(!t)return null;var e=this.handleTime(t);if(e)return e;var a=this.$moment().isSame(t,"year");return a?this.$moment(t).format("M月D日"):this.$moment(t).format("YYYY年M月D日")},handleTime:function(t){var e=this.$moment(t).format("YYYY-MM-DD").split("-"),a=new Date,i=[a.getFullYear(),a.getMonth()+1,a.getDate()],s=new Date(a.setTime(a.getTime()+864e5)),n=[s.getFullYear(),s.getMonth()+1,s.getDate()],r=new Date(a.setTime(a.getTime()-1728e5)),o=[r.getFullYear(),r.getMonth()+1,r.getDate()];return i[0]==e[0]&&i[1]==e[1]&&i[2]==e[2]?"今天":n[0]==e[0]&&n[1]==e[1]&&n[2]==e[2]?"明天":o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2]&&"昨天"}}},p=h,m=(a("92d3"),a("2877")),f=Object(m["a"])(p,l,c,!1,null,"03eaacdb",null),b=f.exports,v=a("e605"),g=(a("a9e3"),a("d81d"),a("4de4"),a("a434"),a("b0c0"),a("2d69")),k=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.sendLoading,expression:"sendLoading"}],staticClass:"task-quick-add",class:["add",{unfold:t.isUnfold,"is-close":!t.isUnfold,"hide-border":"hideBorder"===t.showStyle&&!t.isUnfold}]},[t.isUnfold?a("i",{staticClass:"wk wk-close",on:{click:t.addClose}}):t._e(),t._v(" "),a("el-input",{ref:"input",staticClass:"input",attrs:{maxlength:100,"prefix-icon":t.isUnfold?"":"el-icon-plus",placeholder:"添加任务"},on:{focus:t.inputFocus},model:{value:t.sendContent,callback:function(e){t.sendContent=e},expression:"sendContent"}}),t._v(" "),a("flexbox",{staticClass:"add-info"},[a("el-date-picker",{ref:"endTime",class:{"no-time-top":!t.sendStopTime},attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:""},model:{value:t.sendStopTime,callback:function(e){t.sendStopTime=e},expression:"sendStopTime"}}),t._v(" "),a("wk-user-select",{staticStyle:{height:"auto !important"},attrs:{value:t.mainUser?t.mainUser.userId:"",radio:""},on:{change:t.selectMainUser}},[a("div",{staticClass:"select-user",attrs:{slot:"reference"},slot:"reference"},[t.createMainUser?a("xr-avatar",{staticClass:"add-info__interval",attrs:{name:t.createMainUser.realname,size:24,src:t.createMainUser.img}}):a("i",{staticClass:"wk wk-persons add-info__btn add-info__interval"})],1)]),t._v(" "),a("i",{staticClass:"el-icon-more add-info__btn add-info__interval",on:{click:t.moreClick}})],1),t._v(" "),"hideBorder"===t.showStyle?a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:t.send,expression:"send"}],staticClass:"send-btn",attrs:{type:"primary"}},[t._v("保存")]):a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:t.send,expression:"send"}],staticClass:"send-btn",attrs:{icon:"wk wk-top",type:"primary"}},[t._v("发布")]),t._v(" "),t.taskCreateShow?a("task-create",{attrs:{action:t.createAction},on:{save:t.createSuccess,close:function(e){t.taskCreateShow=!1}}}):t._e()],1)},y=[],C=a("5c0a"),w=a("b775");function T(t){return Object(w["a"])({url:"workTask/saveWorkTask",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function _(t){return Object(w["a"])({url:"workTask/queryTaskInfo/".concat(t.taskId),method:"post"})}function x(t){return Object(w["a"])({url:"workTask/queryTrashTaskInfo",method:"post",data:t})}function I(t){return Object(w["a"])({url:"workTaskLog/queryTaskLog/".concat(t.taskId),method:"post"})}function D(t){return Object(w["a"])({url:"oaTask/deleteWorkTaskLabel",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}var j=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("xr-create",{attrs:{loading:t.loading,title:t.title},on:{close:t.close,save:t.saveClick}},[a("create-sections",{attrs:{title:"基本信息"}},[a("wk-form",{ref:"crmForm",attrs:{model:t.fieldForm,rules:t.fieldRules,"field-from":t.fieldForm,"field-list":t.fieldList,"label-position":"top"},on:{change:t.formChange},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.data;return[i&&"tag"==i.formType?a("div",{staticClass:"label"},[t._l(t.fieldForm[i.field],(function(e,i){return a("span",{key:i,staticClass:"item-color",style:[{background:e.color?t.colorRgb(e.color,.1):"#ccc"},{color:e.color?e.color:"#ccc"}]},[t._v("\n            "+t._s(e.labelName||e.name)+"\n          ")])})),t._v(" "),a("div",{staticClass:"add-tag"},[a("tag-index",{attrs:{placement:"right"},on:{change:function(e){t.otherChange(e,i)}}},[a("span",{staticClass:"add-btn",attrs:{slot:"editIndex"},slot:"editIndex"},[a("i",{staticClass:"wk wk-l-plus"}),t._v(" "),a("span",{staticClass:"label"},[t._v("标签")])])])],1)],2):t._e(),t._v(" "),i&&"subTask"==i.formType?[t.fieldForm[i.field]?a("div",{class:{"sub-task-all":t.fieldForm[i.field]&&t.fieldForm[i.field].length>0}},t._l(t.fieldForm[i.field],(function(e,s){return a("div",{key:s,staticClass:"sub-task"},[a("flexbox",{staticStyle:{padding:"14px"}},[a("div",{on:{click:function(t){t.stopPropagation()}}},[a("el-checkbox",{model:{value:e.checked,callback:function(a){t.$set(e,"checked",a)},expression:"item.checked"}})],1),t._v(" "),a("div",{staticClass:"sub-task__bd text-one-line",class:{"is-checked":e.checked}},[t._v("\n                  "+t._s(e.name)+"\n                ")]),t._v(" "),a("div",{staticClass:"edit-del-box"},[a("el-dropdown",{attrs:{"hide-on-click":!1},on:{command:function(a){t.subTaskDelete(e,s,i)}}},[a("i",{staticClass:"el-icon-more more",staticStyle:{cursor:"pointer"}}),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",[a("span",{attrs:{type:"text"}},[t._v("删除")])])],1)],1)],1),t._v(" "),e.stopTime?a("div",{staticClass:"bg-color task-bg-color",staticStyle:{"margin-left":"8px"}},[t._v(t._s(t._f("moment")(e.stopTime,"YYYY-MM-DD"))+" 截止")]):t._e(),t._v(" "),e.mainUser?a("xr-avatar",{staticClass:"user-img",attrs:{name:e.mainUser.realname,size:25,src:e.mainUser.img}}):t._e()],1)],1)}))):t._e(),t._v(" "),t.addSubtasks?a("div",[a("span",{staticClass:"add-btn",on:{click:function(e){t.addSubtasks=!1}}},[a("i",{staticClass:"wk wk-l-plus"}),t._v(" "),a("span",{staticClass:"label"},[t._v("子任务")])])]):a("sub-task",{attrs:{"sub-task-com":"new","check-disabled":!1},on:{add:function(e){t.subTaskAdd(e,i)},close:function(e){t.addSubtasks=!0}}})]:t._e(),t._v(" "),i&&"taskFile"==i.formType?a("div",[a("file-cell",{attrs:{"file-list":t.fieldForm[i.field],"show-time":!1,"show-delete":""},on:{delete:function(e){t.fileDelete(arguments[0],arguments[1],i)}}}),t._v(" "),a("el-upload",{staticClass:"upload-file",attrs:{"http-request":t.httpRequest,action:"https://jsonplaceholder.typicode.com/posts/",multiple:"","list-type":"picture"}},[a("span",{staticClass:"add-btn"},[a("i",{staticClass:"wk wk-l-plus"}),t._v(" "),a("span",{staticClass:"label"},[t._v("附件")])])])],1):t._e()]}}])})],1)],1)},L=[],S=(a("a15b"),a("8156")),O=a("10ff"),$=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",t._g(t._b({ref:"form",staticClass:"wk-form",class:t.customClass},"el-form",t.$attrs,!1),t.$listeners),[t._l(t.fieldList,(function(e,i){return a("el-form-item",{key:i,class:[e.className||"","is-"+e.formType],attrs:{prop:e.field}},[a("template",{slot:"label"},[t._v(t._s(e.name)),"tooltip"==e.tipType?a("el-tooltip",{attrs:{effect:"dark",placement:"top"}},[a("div",{attrs:{slot:"content"},domProps:{innerHTML:t._s(t.getTips(e))},slot:"content"}),t._v(" "),a("i",{staticClass:"wk wk-help wk-help-tips"})]):"system-help"==e.tipType||e.helpType?a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":e.helpType,"data-id":e.helpId}}):a("span",{staticClass:"label-tips"},[t._v("\n        "+t._s(t.getTips(e))+"\n      ")])],1),t._v(" "),"text"==e.formType?a("el-input",{attrs:{disabled:e.disabled,maxlength:e.maxlength||100,placeholder:e.placeholder,type:e.formType},on:{input:function(a){t.commonChange(e,i,a)}},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,a)},expression:"fieldFrom[item.field]"}}):t.isTrimInput(e.formType)?a("el-input",{attrs:{disabled:e.disabled,"prefix-icon":t.getInputIcon(e.formType),placeholder:e.placeholder,type:"text"},on:{input:function(a){t.commonChange(e,i,a)}},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,"string"===typeof a?a.trim():a)},expression:"fieldFrom[item.field]"}}):"number"==e.formType?a("el-input-number",{attrs:{placeholder:e.placeholder,disabled:e.disabled,controls:!1,max:e.hasOwnProperty("max")?e.max:1/0},on:{change:function(a){t.commonChange(e,i,a)}},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,a)},expression:"fieldFrom[item.field]"}}):"floatnumber"==e.formType?a("el-input-number",{attrs:{placeholder:e.placeholder,disabled:e.disabled,controls:!1},on:{change:function(a){t.commonChange(e,i,a)}},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,a)},expression:"fieldFrom[item.field]"}}):"textarea"==e.formType?a("el-input",{attrs:{disabled:e.disabled,rows:3,autosize:{minRows:3},maxlength:e.maxlength||800,placeholder:e.placeholder,type:e.formType,resize:"none"},on:{input:function(a){t.commonChange(e,i,a)}},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,a)},expression:"fieldFrom[item.field]"}}):"select"===e.formType&&e.setting.includes(t.LOGIC_OTHER)?a("wk-select",{attrs:{disabled:e.disabled,clearable:e.clearable,placeholder:e.placeholder,options:e.setting,"show-type":1===e.precisions?"tiled":"default","other-show-input":""},on:{change:function(a){t.commonChange(e,i,a)}},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,a)},expression:"fieldFrom[item.field]"}}):"checkbox"===e.formType&&e.setting.includes(t.LOGIC_OTHER)?a("wk-checkbox",{attrs:{disabled:e.disabled,clearable:e.clearable,placeholder:e.placeholder,options:e.setting,"show-type":1===e.precisions?"tiled":"default","other-show-input":""},on:{change:function(a){t.commonChange(e,i,a)}},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,a)},expression:"fieldFrom[item.field]"}}):["checkbox","select"].includes(e.formType)?a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",remote:"","remote-method":t.remoteMethod,disabled:e.disabled,clearable:e.clearable,placeholder:e.placeholder,multiple:"checkbox"===e.formType},on:{change:function(a){t.commonChange(e,i,a)}},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,a)},expression:"fieldFrom[item.field]"}},t._l(t.filterOptions(e.setting),(function(e,i){return a("el-option",{key:i,attrs:{label:t.isEmptyValue(e.value)?e:e.label||e.name,value:t.isEmptyValue(e.value)?e:e.value}})}))):"date"==e.formType?a("el-date-picker",{staticStyle:{width:"100%"},attrs:{disabled:e.disabled,clearable:"",type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:function(a){t.commonChange(e,i,a)}},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,a)},expression:"fieldFrom[item.field]"}}):"dateRange"==e.formType?a("el-date-picker",{staticStyle:{width:"100%"},attrs:{disabled:e.disabled,type:e.dateType||"daterange","value-format":e.dateValueFormat||"yyyy-MM-dd",clearable:"","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:function(a){t.commonChange(e,i,a)}},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,a)},expression:"fieldFrom[item.field]"}}):"datetime"==e.formType?a("el-date-picker",{staticStyle:{width:"100%"},attrs:{disabled:e.disabled,clearable:"",type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期"},on:{change:function(a){t.commonChange(e,i,a)}},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,a)},expression:"fieldFrom[item.field]"}}):"structure"==e.formType&&(e.request||e.props||e.params)?a("wk-dep-select",{staticStyle:{width:"100%"},attrs:{request:e.request,props:e.props,params:e.params,disabled:e.disabled,radio:!!t.isEmptyValue(e.radio)||e.radio},on:{change:function(a){t.depOrUserChange(e,i,arguments[0],arguments[1])}},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,a)},expression:"fieldFrom[item.field]"}}):"structure"==e.formType?a("wk-dept-dialog-select",{staticStyle:{width:"100%"},attrs:{disabled:e.disabled,radio:!!t.isEmptyValue(e.radio)||e.radio},on:{change:function(a){t.depOrUserChange(e,i,arguments[0],arguments[1])}},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,a)},expression:"fieldFrom[item.field]"}}):["single_user","user"].includes(e.formType)&&(e.request||e.props||e.params)?a("wk-user-select",{staticStyle:{width:"100%"},attrs:{request:e.request,props:e.props,params:e.params,disabled:e.disabled,radio:!!t.isEmptyValue(e.radio)||e.radio},on:{change:function(a){t.depOrUserChange(e,i,arguments[0],arguments[1])}},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,a)},expression:"fieldFrom[item.field]"}}):["single_user","user"].includes(e.formType)?a("wk-user-dialog-select",{staticStyle:{width:"100%"},attrs:{disabled:e.disabled,radio:!!t.isEmptyValue(e.radio)||e.radio},on:{change:function(a){t.depOrUserChange(e,i,arguments[0],arguments[1])}},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,a)},expression:"fieldFrom[item.field]"}}):"radio"==e.formType?a("el-radio-group",{attrs:{disabled:e.disabled,placeholder:e.placeholder},on:{change:function(a){t.commonChange(e,i,a)}},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,a)},expression:"fieldFrom[item.field]"}},t._l(e.setting,(function(e,i){return a("el-radio",{key:i,attrs:{label:t.isEmptyValue(e.value)?e:e.value}},[t._v("\n        "+t._s(t.isEmptyValue(e.value)?e:e.label||e.name)+"\n      ")])}))):"boolean_value"==e.formType?a("el-switch",{attrs:{disabled:e.disabled,"active-value":"1","inactive-value":"0"},model:{value:t.fieldFrom[e.field],callback:function(a){t.$set(t.fieldFrom,e.field,a)},expression:"fieldFrom[item.field]"}}):"address"==e.formType?a("v-distpicker",{attrs:{province:t.fieldFrom[e.field].province,city:t.fieldFrom[e.field].city,area:t.fieldFrom[e.field].area},on:{province:function(a){t.selectProvince(a,e,i)},city:function(a){t.selectCity(a,e,i)},area:function(a){t.selectArea(a,e,i)}}}):"file"==e.formType?a("xh-files",{attrs:{value:t.fieldFrom[e.field],disabled:e.disabled},on:{"value-change":function(a){t.oldChange(a,e,i)}}}):[t._t("default",null,{data:e,index:i})]],2)})),t._v(" "),t._t("suffix")],2)},A=[],F=(a("466d"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"elclickoutside",rawName:"v-elclickoutside",value:t.handleClose,expression:"handleClose"}],ref:"reference",staticClass:"wk-dep-select xh-form-border",class:[t.disabled?"is_disabled":"is_valid",{is_focus:t.visible}],attrs:{wrap:"wrap"},on:{click:t.containerClick}},[a("div",{staticClass:"el-select__tags"},t._l(t.showSelects,(function(e,i){return a("span",{key:i,staticClass:"user-item text-one-line"},[t._v(t._s(t.$getDeptName(e))+"\n      "),a("i",{staticClass:"delete-icon el-icon-close",on:{click:function(e){e.stopPropagation(),t.deleteDep(i)}}})])}))),t._v(" "),t.selects.length>t.max?a("i",{staticClass:"el-icon-more"}):t._e(),t._v(" "),a("i",{class:["el-icon-arrow-up"]}),t._v(" "),0==t.selects.length?a("div",{staticClass:"user-placeholder text-one-line"},[t._v(t._s(t.placeholder))]):t._e(),t._v(" "),a("transition",{attrs:{name:"el-zoom-in-top"},on:{"before-enter":t.handleMenuEnter,"after-leave":t.doDestroy}},[a("wk-select-dropdown",{directives:[{name:"show",rawName:"v-show",value:t.visible&&!t.disabled,expression:"visible && !disabled"}],ref:"popper",attrs:{"append-to-body":t.popperAppendToBody}},[a("el-scrollbar",{ref:"scrollbar",attrs:{tag:"div"}},[t.initView?a("wk-dep",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{disabled:t.disabled,options:t.options,props:t.config,radio:t.radio},on:{change:t.wkDepChange,close:function(e){t.visible=!1}},model:{value:t.dataValue,callback:function(e){t.dataValue=e},expression:"dataValue"}}):t._e()],1)],1)],1)],1)}),U=[],N=(a("fb6a"),a("caad"),a("2532"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"el-select-dropdown el-popper",class:[{"is-multiple":t.$parent.multiple},t.popperClass],style:{minWidth:t.minWidth}},[t._t("default")],2)}),V=[],P=a("e974"),E=a.n(P),B={name:"WkSelectDropdown",componentName:"WkSelectDropdown",mixins:[E.a],props:{placement:{type:String,default:"bottom-start"},boundariesPadding:{type:Number,default:0},popperOptions:{type:Object,default:function(){return{gpuAcceleration:!1}}},visibleArrow:{type:Boolean,default:!1},appendToBody:{type:Boolean,default:!0}},data:function(){return{minWidth:"300px"}},computed:{popperClass:function(){return this.$parent.popperClass}},watch:{},mounted:function(){var t=this;this.referenceElm=this.$parent.$el,this.$parent.popperElm=this.popperElm=this.$el,this.$on("updatePopper",(function(){t.$parent.visible&&t.updatePopper()})),this.$on("destroyPopper",this.destroyPopper)}},R=B,M=Object(m["a"])(R,N,V,!1,null,null,null),q=M.exports,W=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"xh-user"},[t.headerShow?a("div",{staticClass:"xh-user__hd"},[t._v("\n    部门\n  ")]):t._e(),t._v(" "),a("div",{staticClass:"xh-user__bd"},[a("el-autocomplete",{attrs:{disabled:t.disabled,"popper-append-to-body":!1,"fetch-suggestions":t.searchListUser,placeholder:"请输入内容"},on:{select:t.searchSelect},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.item;return[a("span",[t._v(t._s(i[t.config.label]))])]}}]),model:{value:t.searchInput,callback:function(e){t.searchInput=e},expression:"searchInput"}}),t._v(" "),a("div",{staticClass:"search-list"},[a("el-breadcrumb",{staticStyle:{padding:"5px 0"},attrs:{"separator-class":"el-icon-arrow-right"}},t._l(t.breadcrumbList,(function(e,i){return a("el-breadcrumb-item",{key:i},[a("a",{attrs:{href:"javascript:;"},on:{click:function(a){t.breadcrumbBtn(e,i)}}},[t._v(t._s(e.label))])])}))),t._v(" "),t.currentBreadcrumbItem?a("div",{staticClass:"xh-user__list"},[t.radio?t._e():a("el-checkbox",{staticStyle:{"line-height":"30px"},attrs:{disabled:t.disabled},on:{change:t.handleCheckAllChange},model:{value:t.allChecked,callback:function(e){t.allChecked=e},expression:"allChecked"}},[t._v("全选")]),t._v(" "),a("wk-dep-checkbox",{ref:"depCheckbox",attrs:{radio:t.radio,data:t.currentBreadcrumbItem.deptList,props:t.props,disabled:t.disabled,value:t.value},on:{input:function(e){t.$emit("input",e)},change:t.checkboxChange,"all-select":t.userAllSelect,next:t.nextDebounceClick}})],1):t._e()],1)],1),t._v(" "),a("div",{staticClass:"xh-user__ft"},[a("span",{staticClass:"select-info"},[t._v("已选择"),a("span",{staticClass:"select-info--num"},[t._v(t._s(t.value?t.value.length:0))]),t._v("项")]),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:t.clearAll}},[t._v("清空")])],1)])},H=[];function Y(t){return Object(w["a"])({url:"hrmDept/queryTreeList",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}var z=a("2934"),G=a("aa59"),Q=a("d22a"),J=a("8ed6"),K=a("7a1a"),X={value:"deptId",label:"name",request:null,params:null,dataType:"manage"},Z={name:"WkDep",components:{WkDepCheckbox:G["a"]},inheritAttrs:!1,props:{radio:Boolean,headerShow:{type:Boolean,default:!0},options:Array,value:Array,props:{type:Object,default:function(){return{}}},disabled:{type:Boolean,default:!1}},data:function(){return{searchInput:"",searchUserList:[],breadcrumbList:[],currentBreadcrumbItem:null,allChecked:!1}},computed:{config:function(){return Object(J["a"])(Object(n["a"])({},X),this.props||{})}},watch:{breadcrumbList:function(){this.currentBreadcrumbItem=this.breadcrumbList[this.breadcrumbList.length-1]},options:{handler:function(){this.options?this.getDepUserList(0,this.options):this.requestDepList()},immediate:!0}},created:function(){this.nextDebounceClick=Object(K["debounce"])(300,this.nextClick)},methods:{searchListUser:function(t,e){var a=this,i=this.currentBreadcrumbItem.deptList;if(i&&i.length>0){var s=i;e(t?s.filter((function(e){return Q["a"].match(e[a.config.label]||"",t)})):s)}},searchSelect:function(t){this.$refs.depCheckbox.searchSelect(t)},checkboxChange:function(t){var e=this;this.radio?(this.$emit("input",t.length>0?[t[t.length-1]]:[]),this.$emit("close")):this.$emit("input",t),this.$nextTick((function(){e.$emit("change",t)}))},handleCheckAllChange:function(t){this.$refs.depCheckbox&&this.$refs.depCheckbox.handleCheckAllChange(t)},userAllSelect:function(t){this.allChecked!=t&&(this.allChecked=t)},clearAll:function(){this.$emit("input",[])},getDepUserList:function(t,e){0==t?this.breadcrumbList=[{label:"全部",deptList:e,employeeList:[]}]:this.breadcrumbList.push({label:e.name,deptList:e.children,employeeList:[]})},requestDepList:function(){var t=this;this.loading=!0;var e="hrm"===this.config.dataType?Y:this.config.request||z["e"];e(this.config.params||{type:"tree"}).then((function(e){t.getDepUserList(0,e.data||[]),t.loading=!1})).catch((function(){t.loading=!1}))},nextClick:function(t){this.radio||(this.allChecked=!1),this.getDepUserList(t.deptId,t)},breadcrumbBtn:function(t,e){e+1<=this.breadcrumbList.length-1&&this.breadcrumbList.splice(e+1,this.breadcrumbList.length-1)}}},tt=Z,et=(a("64a4"),Object(m["a"])(tt,W,H,!1,null,"0cba2dfc",null)),at=et.exports,it=a("d010"),st=a.n(it),nt=a("8122"),rt=a("ed08"),ot=a("2f62"),lt={value:"deptId",label:"name",request:null,params:null,dataType:"manage",isList:!1},ct={name:"WkDepSelect",components:{WkSelectDropdown:q,WkDep:at},mixins:[st.a],props:{radio:Boolean,max:{type:Number,default:2},props:{type:Object,default:function(){return{value:"deptId",label:"name"}}},placeholder:{type:String,default:function(){return"请选择"}},value:{required:!0},request:Function,params:Object,options:Array,disabled:{type:Boolean,default:!1},popperAppendToBody:{type:Boolean,default:!0}},data:function(){return{visible:!1,dataValue:[],loading:!1,initView:!1}},computed:Object(n["a"])(Object(n["a"])({},Object(ot["b"])(["deptList","hrmDeptList"])),{},{optionsList:function(){return"manage"===this.config.dataType?this.deptList:"hrm"===this.config.dataType?this.hrmDeptList:[]},showSelects:function(){return this.selects&&this.selects.length>this.max?this.selects.slice(0,this.max):this.selects},selects:function(){return this.optionsList.length?this.getSelectList():[]},config:function(){var t=Object(J["a"])(Object(n["a"])({},lt),this.props||{});return this.request&&(t.request=this.request),this.params&&(t.params=this.params),t}}),watch:{visible:function(t){t?this.broadcast("WkSelectDropdown","updatePopper"):this.broadcast("WkSelectDropdown","destroyPopper"),this.$emit("visible-change",t)},value:function(){this.verifyValue()},props:{handler:function(){this.requestDepList()},immediate:!0},dataValue:function(t,e){this.radio?this.$emit("input",this.dataValue&&this.dataValue.length?this.dataValue[0]:""):this.$emit("input",this.dataValue)}},created:function(){this.verifyValue()},methods:{getSelectList:function(){var t=[];return this.recursionOptions(this.optionsList,this.dataValue,t),t},recursionOptions:function(t,e,a){var i=this;t.forEach((function(t){e.includes(t[i.config.value])&&a.push(t),t.children&&i.recursionOptions(t.children,e,a)}))},verifyValue:function(){var t=this;if(this.radio||Array.isArray(this.value)||this.$emit("input",[]),this.radio&&(Array.isArray(this.value)||null===this.value||void 0===this.value)&&this.$emit("input",""),this.radio)this.value!==this.dataValue&&(this.value?this.dataValue=[this.value]:this.dataValue=[]);else if(!Object(nt["valueEquals"])(this.value,this.dataValue))if(this.value&&this.value.length){var e=this.value[0];e[this.config.value]?this.dataValue=this.value.map((function(e){return e[t.config.value]})):this.dataValue=Object(rt["r"])(this.value)}else this.dataValue=[]},requestDepList:function(){"manage"===this.config.dataType?this.$store.dispatch("debounceGetDeptList"):"hrm"===this.config.dataType&&this.$store.dispatch("debounceGetHrmDeptList")},handleClose:function(){this.visible=!1},handleMenuEnter:function(){},doDestroy:function(){this.$refs.popper&&this.$refs.popper.doDestroy()},deleteDep:function(t){if(!this.disabled){var e=Object(rt["r"])(this.dataValue);e.splice(t,1),this.dataValue=e,this.wkDepChange()}},focusClick:function(){this.$emit("focus")},wkDepChange:function(){var t=this;this.$nextTick((function(){if(t.radio){var e=t.dataValue&&t.dataValue.length?t.dataValue[0]:"";t.$emit("input",e),t.dispatch("ElFormItem","el.form.change",e)}else t.$emit("input",t.dataValue),t.dispatch("ElFormItem","el.form.change",t.dataValue);t.$emit("change",t.dataValue,t.selects)}))},containerClick:function(){this.disabled||(this.initView=!0,this.visible=!this.visible)}}},dt=ct,ut=(a("e07a"),Object(m["a"])(dt,F,U,!1,null,"f1a945cc",null)),ht=ut.exports,pt=a("8f81"),mt=a("bfba"),ft=a("5a8c"),bt=a("f068"),vt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wk-select"},[t.valueIsObject?["default"===t.showType?a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",remote:"","remote-method":t.remoteMethod,disabled:t.disabled,clearable:t.clearable,placeholder:t.placeholder},on:{change:t.valueChange},model:{value:t.dataValue.select,callback:function(e){t.$set(t.dataValue,"select",e)},expression:"dataValue.select"}},t._l(t.filterOptions,(function(e,i){return a("el-option",{key:i,attrs:{label:t.isEmptyValue(e.value)?e:e.label||e.name,title:t.isEmptyValue(e.value)?e:e.label||e.name,value:t.getValue(e)}})}))):"tiled"===t.showType?a("el-radio-group",{on:{change:t.valueChange},model:{value:t.dataValue.select,callback:function(e){t.$set(t.dataValue,"select",e)},expression:"dataValue.select"}},t._l(t.options,(function(e,i){return a("el-radio",{key:i,attrs:{label:t.getValue(e)}},[t._v("\n        "+t._s(t.isEmptyValue(e.value)?e:e.label||e.name)+"\n      ")])}))):t._e(),t._v(" "),t.dataValue.select===t.LOGIC_OTHER&&t.otherShowInput?a("el-input",{attrs:{disabled:t.disabled,maxlength:100,placeholder:"其他选项需填写，否则为无效选项"},on:{blur:t.inputBlur},model:{value:t.dataValue.otherValue,callback:function(e){t.$set(t.dataValue,"otherValue",e)},expression:"dataValue.otherValue"}}):t._e()]:t._e()],2)},gt=[],kt=(a("7db0"),a("498a"),a("6bfe")),yt="其他",Ct={name:"WkSelect",components:{},mixins:[st.a],props:{value:[String,Number],otherShowInput:{type:Boolean,default:!1},disabled:Boolean,clearable:Boolean,placeholder:String,options:{type:Array,default:function(){return[]}},showType:{type:String,default:"default"}},data:function(){return{LOGIC_OTHER:yt,dataValue:{select:"",otherValue:""},search:""}},computed:{valueIsObject:function(){return Object(kt["c"])(this.dataValue)},filterOptions:function(){var t=this;return this.search?this.options.filter((function(e){return Q["a"].match(t.isEmptyValue(e.value)?e:e.label||e.name,t.search)})):this.options}},watch:{value:{handler:function(t,e){this.validValue()},immediate:!0},options:{handler:function(t,e){this.validValue()},deep:!0}},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{validValue:function(){var t=this;if(Object(kt["a"])(this.options)&&0!==this.options.length)if(this.value!==this.dataValue.select&&this.value!==this.dataValue.otherValue)if(Object(kt["b"])(this.value))this.dataValue={select:"",otherValue:""};else if(this.otherShowInput){var e=this.options.find((function(e){return t.getValue(e)===t.value}));e?this.dataValue.select!==this.value&&(this.dataValue={select:this.value,otherValue:""}):this.dataValue.otherValue!==this.value&&(this.dataValue={select:yt,otherValue:this.value})}else this.dataValue={select:this.value,otherValue:""};else Object(kt["b"])(this.value)&&(this.dataValue.select!==yt?this.dataValue={select:"",otherValue:""}:this.dataValue={select:yt,otherValue:""})},getValue:function(t){return this.isEmptyValue(t.value)?t:t.value},isEmptyValue:function(t){return null===t||void 0==t},valueChange:function(){var t=this.dataValue.select===yt?this.dataValue.otherValue.trim():this.dataValue.select;this.$emit("input",t),this.$emit("change",t),this.dispatch("ElFormItem","el.form.change",t)},inputBlur:function(){var t=this.dataValue.otherValue,e=this.options.length>0&&!this.isEmptyValue(this.options[0].value),a=this.options.find((function(a){return e?a.value===t.trim():a===t.trim()}));a&&(this.dataValue.otherValue=""),this.$emit("input",this.dataValue.otherValue),this.$emit("change",this.dataValue.otherValue),this.dispatch("ElFormItem","el.form.change",this.dataValue.otherValue)},remoteMethod:function(t){this.search=t}}},wt=Ct,Tt=(a("ed7b"),Object(m["a"])(wt,vt,gt,!1,null,"c99ca4d8",null)),_t=Tt.exports,xt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wk-checkbox"},[t.valueIsObject?["default"===t.showType?a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",remote:"","remote-method":t.remoteMethod,disabled:t.disabled,clearable:t.clearable,placeholder:t.placeholder,multiple:""},on:{change:t.valueChange},model:{value:t.dataValue.select,callback:function(e){t.$set(t.dataValue,"select",e)},expression:"dataValue.select"}},t._l(t.filterOptions,(function(e,i){return a("el-option",{key:i,attrs:{label:t.isEmptyValue(e.value)?e:e.label||e.name,value:t.getValue(e)}})}))):"tiled"===t.showType?a("el-checkbox-group",{attrs:{disabled:t.disabled},on:{change:t.valueChange},model:{value:t.dataValue.select,callback:function(e){t.$set(t.dataValue,"select",e)},expression:"dataValue.select"}},t._l(t.options,(function(e,i){return a("el-checkbox",{key:i,attrs:{label:t.getValue(e)}},[t._v("\n        "+t._s(t.isEmptyValue(e.value)?e:e.label||e.name)+"\n      ")])}))):t._e(),t._v(" "),t.dataValue.select.includes(t.LOGIC_OTHER)&&t.otherShowInput?a("el-input",{attrs:{disabled:t.disabled,maxlength:100,placeholder:"其他选项需填写，否则为无效选项"},on:{blur:t.inputBlur},model:{value:t.dataValue.otherValue,callback:function(e){t.$set(t.dataValue,"otherValue",e)},expression:"dataValue.otherValue"}}):t._e()]:t._e()],2)},It=[],Dt="其他",jt={name:"WkCheckbox",components:{},mixins:[st.a],props:{value:{},otherShowInput:{type:Boolean,default:!1},disabled:Boolean,clearable:Boolean,placeholder:String,options:{type:Array,default:function(){return[]}},showType:{type:String,default:"default"}},data:function(){return{LOGIC_OTHER:Dt,dataValue:{select:[],otherValue:""},search:""}},computed:{valueIsObject:function(){return Object(kt["c"])(this.dataValue)},filterOptions:function(){var t=this;return this.search?this.options.filter((function(e){return Q["a"].match(t.isEmptyValue(e.value)?e:e.label||e.name,t.search)})):this.options}},watch:{value:{handler:function(t,e){this.validValue()},immediate:!0}},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{validValue:function(){var t=this;if(Object(kt["b"])(this.value))this.dataValue={select:[],otherValue:""};else{var e=this.value;"string"===typeof e&&e&&(e=e.split(","));var a=!1;if(this.otherShowInput){var i=Object(kt["a"])(e)?e:[],s=i.filter((function(e){return!t.options.includes(e)}));if(s.length>0){var n=i.filter((function(t){return!s.includes(t)}));n.push(Dt);var r=this.removeInvalidValue(n);this.dataValue={select:r,otherValue:s[s.length-1]},a=r.length!==n.length}else if(!Object(nt["valueEquals"])(i,this.dataValue.select)){var o=this.removeInvalidValue(i);this.dataValue={select:o,otherValue:""},a=o.length!==i.length}}else{var l=this.removeInvalidValue(e);this.dataValue={select:l,otherValue:""},a=l.length!==e.length}a&&this.valueChange(!1)}},removeInvalidValue:function(t){var e=this;if(this.options&&this.options.length>0&&Object(kt["a"])(t)&&t.length>0){var a=this.options.map((function(t){return e.getValue(t)}));return t.filter((function(t){return a.includes(t)}))}return t},getValue:function(t){return this.isEmptyValue(t.value)?t:t.value},isEmptyValue:function(t){return null===t||void 0==t},valueChange:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.dataValue.select.includes(Dt)){var e=this.dataValue.select.filter((function(t){return t!==Dt})),a=this.dataValue.otherValue.trim();a&&(e.push(a),this.$emit("input",e),!1!==t&&(this.$emit("change",e),this.dispatch("ElFormItem","el.form.change",e)))}else this.dataValue.otherValue="",this.$emit("input",this.dataValue.select),!1!==t&&(this.$emit("change",this.dataValue.select),this.dispatch("ElFormItem","el.form.change",this.dataValue.select))},inputBlur:function(){this.valueChange()},remoteMethod:function(t){this.search=t}}},Lt=jt,St=(a("f49d"),Object(m["a"])(Lt,xt,It,!1,null,"14f24f2b",null)),Ot=St.exports,$t={methods:{isTrimInput:function(t,e){return!("floatnumber"!=t||!e)||["mobile","email","website"].includes(t)},getInputIcon:function(t){return{mobile:"wk wk-icon-mobile",email:"wk wk-icon-email-outline",website:"wk wk-icon-link"}[t]},getInputMaxlength:function(t){return"website"===t?800:100},depOrUserChange:function(t,e,a,i){this.$emit("change",t,e,a,i)},commonChange:function(t,e,a){this.$emit("change",t,e,a)},isEmptyValue:function(t){return null===t||void 0==t},oldChange:function(t,e,a){this.$set(this.fieldFrom,e.field,t.value),this.$emit("change",e,a,t.value),this.$refs.form&&this.$refs.form.validateField(e.field)},selectProvince:function(t,e,a){this.fieldFrom[e.field].province=t.value,this.addressChange(e,a,t,this.fieldFrom[e.field])},selectCity:function(t,e,a){this.fieldFrom[e.field].city=t.value,this.addressChange(e,a,t,this.fieldFrom[e.field])},selectArea:function(t,e,a){this.fieldFrom[e.field].area=t.value,this.addressChange(e,a,t,this.fieldFrom[e.field])},addressChange:function(t,e,a){this.$emit("change",t,e,a)},getTips:function(t){var e=t.tips||t.inputTips;return"tooltip"==t.tipType?Object(kt["b"])(e)?"":e:Object(kt["b"])(e)?"":"（".concat(e,"）")},getShowValue:function(t){return!t.hasOwnProperty("show")||t.show}}},At="其他",Ft={name:"WkForm",components:{WkUserSelect:C["a"],WkDepSelect:ht,WkUserDialogSelect:pt["a"],WkDeptDialogSelect:mt["a"],VDistpicker:ft["a"],XhFiles:bt["a"],WkSelect:_t,WkCheckbox:Ot},mixins:[$t],inheritAttrs:!1,props:{fieldFrom:{type:Object,default:function(){return{}}},fieldList:{type:Array,default:function(){return[]}},customClass:{type:String,default:"is-two-columns"}},data:function(){return{LOGIC_OTHER:At,instance:null,search:""}},computed:{filterOptions:function(){var t=this;return function(e){return t.search?e.filter((function(e){return Q["a"].match(t.isEmptyValue(e.value)?e:e.label||e.name,t.search)})):e}}},watch:{},mounted:function(){var t=this;this.$nextTick((function(){t.instance=t.$refs.form}))},beforeDestroy:function(){},methods:{remoteMethod:function(t){this.search=t}}},Ut=Ft,Nt=(a("790d"),a("229b"),Object(m["a"])(Ut,$,A,!1,null,"5575eb99",null)),Vt=Nt.exports,Pt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-popover",{attrs:{placement:t.placement,width:t.popoverWidth,"popper-class":t.noPadding?"no-padding-popover":"",trigger:"click"},model:{value:t.tagShow,callback:function(e){t.tagShow=e},expression:"tagShow"}},[0==t.tagContent?a("div",{staticClass:"tag-popover-box"},[a("div",{staticClass:"tag-top"},[a("span",[t._v("选择标签")]),t._v(" "),a("span",{staticClass:"el-icon-close rt cursor-pointer",on:{click:function(e){t.tagShow=!1}}})]),t._v(" "),a("el-input",{attrs:{placeholder:"搜索标签","prefix-icon":"el-icon-search",size:"small"},model:{value:t.tagSearch,callback:function(e){t.tagSearch=e},expression:"tagSearch"}}),t._v(" "),a("div",{staticClass:"tag-content"},t._l(t.showTagList,(function(e,i){return a("div",{key:i,staticClass:"tag-list",on:{click:function(a){t.tagSelectClick(e,i)}}},[a("i",{staticClass:"wukong wukong-black-label",style:{color:e.color}}),t._v(" "),a("span",{staticClass:"item-label"},[t._v(t._s(e.name))]),t._v(" "),e.check?a("span",{staticClass:"el-icon-check rt"}):t._e()])}))),t._v(" "),a("div",{staticClass:"tag-footer"},[a("div",[a("el-button",{staticClass:"footer-row",attrs:{type:"text"},on:{click:t.createTagClick}},[t._v("+ 创建标签")])],1),t._v(" "),a("div",[a("el-button",{staticClass:"footer-row",attrs:{type:"text"},on:{click:t.managementTag}},[t._v("+ 管理标签")])],1)])],1):1==t.tagContent||3==t.tagContent?a("new-tag",{attrs:{"new-tag-title":t.newTagTitle,"new-tag-input":t.newTagInput,"bg-color-props":t.bgColorProps},on:{changeColor:t.changeColor,close:t.tagClose,tagCreateSubmit:t.tagCreateSubmit,tagCancel:t.tagCancel,back:t.back}}):2==t.tagContent?a("editTag",{attrs:{"edit-tag-list":t.tagList},on:{back:t.back,close:t.tagClose,editBtn:t.editTagClick,deleteBtn:t.deleteBtn}}):t._e(),t._v(" "),a("span",{attrs:{slot:"reference"},on:{click:t.referenceFun},slot:"reference"},[t._t("editIndex")],2)],1)},Et=[],Bt=(a("99af"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"new-tag-dialog"},[a("flexbox",{staticClass:"tag-dialog-header"},[a("div",{staticClass:"tag-dialog-header__text"},[a("span",{staticClass:"el-icon-arrow-left",on:{click:t.back}}),t._v("\n      "+t._s(t.newTagTitle)+"\n    ")]),t._v(" "),a("i",{staticClass:"el-icon-close icon-close",on:{click:t.close}})]),t._v(" "),a("div",{staticClass:"search"},[a("el-input",{attrs:{maxlength:10,placeholder:"输入标签名，最多十个字符"},model:{value:t.input,callback:function(e){t.input="string"===typeof e?e.trim():e},expression:"input"}}),t._v(" "),a("span",{staticClass:"checked-color",style:{background:t.showBgColor}})],1),t._v(" "),a("div",{staticClass:"color-box"},t._l(t.colorList,(function(e,i){return a("span",{key:i,style:{background:e},on:{click:function(a){t.changeColor(e)}}})}))),t._v(" "),a("div",{staticClass:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:t.tagCreateSubmit,expression:"tagCreateSubmit"}],attrs:{type:"primary"}},[t._v("保存")]),t._v(" "),a("el-button",{on:{click:t.tagCancel}},[t._v("取消")])],1)],1)}),Rt=[],Mt={props:{newTagTitle:String,newTagInput:String,bgColorProps:String},data:function(){return{colorList:["#0052CC","#00A3BF","#DE350B","#5243AA","#00875A","#FF991F","#091E42"],input:this.newTagInput,showBgColor:""}},watch:{bgColorProps:function(t){this.showBgColor=t||"#0052CC"}},mounted:function(){this.showBgColor=this.bgColorProps||"#0052CC"},methods:{back:function(){this.$emit("back")},close:function(){this.$emit("close")},changeColor:function(t){this.$emit("changeColor",t)},tagCreateSubmit:function(){this.input?this.$emit("tagCreateSubmit",this.input,this.showBgColor):this.$message.error("请输入标签名")},tagCancel:function(){this.$emit("tagCancel")}}},qt=Mt,Wt=(a("596b"),Object(m["a"])(qt,Bt,Rt,!1,null,"532a7990",null)),Ht=Wt.exports,Yt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"edit-tag-dialog"},[a("flexbox",{staticClass:"tag-dialog-header"},[a("div",{staticClass:"tag-dialog-header__text"},[a("span",{staticClass:"el-icon-arrow-left",on:{click:t.back}}),t._v("\n      标签管理\n    ")]),t._v(" "),a("i",{staticClass:"el-icon-close icon-close",on:{click:t.close}})]),t._v(" "),a("div",{staticClass:"search"},[a("el-input",{attrs:{maxlength:10,placeholder:"输入标签名，最多十个字符"},model:{value:t.searchInput,callback:function(e){t.searchInput=e},expression:"searchInput"}})],1),t._v(" "),a("div",{staticClass:"content"},t._l(t.list,(function(e,i){return a("div",{key:i,staticClass:"tag-list"},[a("span",{staticClass:"tag-name",style:{background:e.color?e.color:"#ccc"}},[t._v("\n        "+t._s(e.name.length>10?e.name.substring(0,10)+"...":e.name)+"\n      ")]),t._v(" "),a("div",{staticClass:"rt"},[a("span",{staticClass:"el-icon-edit",on:{click:function(a){t.editBtn(e)}}}),t._v(" "),a("span",{staticClass:"el-icon-delete",on:{click:function(a){t.deleteBtn(e)}}})])])})))],1)},zt=[],Gt={props:{editTagList:Array},data:function(){return{searchInput:""}},computed:{list:function(){var t=this;return this.editTagList.filter((function(e){return e.name.indexOf(t.searchInput)>-1}))}},watch:{},methods:{back:function(){this.$emit("back")},close:function(){this.$emit("close")},deleteBtn:function(t){this.$emit("deleteBtn",t)},editBtn:function(t){this.$emit("editBtn",t)}}},Qt=Gt,Jt=(a("2b7d"),Object(m["a"])(Qt,Yt,zt,!1,null,"e12b1720",null)),Kt=Jt.exports;function Xt(t){return Object(w["a"])({url:"workTaskLabel/getLabelList",method:"post",data:t})}function Zt(t){return Object(w["a"])({url:"workTaskLabel/deleteLabel",method:"post",data:t})}function te(t){return Object(w["a"])({url:"workTaskLabel/saveLabel",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function ee(t){return Object(w["a"])({url:"workTaskLabel/setLabel",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}var ae={components:{NewTag:Ht,EditTag:Kt},props:{taskData:{type:Object,default:function(){return{}}},placement:String},data:function(){return{tagShow:!1,tagContent:0,tagSearch:"",tagList:[],newTagType:"create",newTagInput:"",bgColorProps:"",editTagId:""}},computed:{showTagList:function(){for(var t=[],e=0;e<this.tagList.length;e++){var a=this.tagList[e];a.name.indexOf(this.tagSearch)>-1&&t.push(a)}return t},popoverWidth:function(){return 1==this.tagContent?330:2==this.tagContent?400:220},newTagTitle:function(){return"create"===this.newTagType?"创建新标签":"编辑标签"},noPadding:function(){return[1,2,3].includes(this.tagContent)}},watch:{},mounted:function(){},methods:{createTagClick:function(){this.newTagType="create",this.newTagInput="",this.tagContent=1},editTagClick:function(t){this.editTagId=t.labelId,this.newTagType="update",this.tagContent=1,this.bgColorProps=t.color,this.newTagInput=t.name},managementTag:function(){this.tagContent=2},tagSelectClick:function(t,e){var a=this;if(this.$listeners.change)t.check=!t.check,this.$emit("change",this.tagList.filter((function(t){return t.check})));else if(t.check)D({taskId:this.taskData.taskId,labelId:t.labelId}).then((function(e){t.check=!1,a.updateDetailList(t,"delete")})).catch((function(){t.check=!0}));else{var i=this.tagList.filter((function(t){return t.check})).concat(t);Object(o["ib"])({taskId:this.taskData.taskId,labelId:i.map((function(t){return t.labelId})).join(",")}).then((function(e){t.check=!0;var i=[];a.tagList.forEach((function(t){t.check&&(t.labelName=t.name,i.push(t))})),a.taskData.labelList=i})).catch((function(){t.check=!1}))}},updateDetailList:function(t,e){if(this.taskData&&this.taskData.labelList){for(var a=-1,i=0;i<this.taskData.labelList.length;i++){var s=this.taskData.labelList[i];if(s.labelId==t.labelId){a=i;break}}a>=0&&("delete"==e?this.taskData.labelList.splice(a,1):this.taskData.labelList.splice(a,1,t))}},changeColor:function(t){this.bgColorProps=t},tagClose:function(){this.tagShow=!1},tagCreateSubmit:function(t,e){var a=this;"create"==this.newTagType?te({name:t,color:e}).then((function(t){a.getTagList(),a.back(),a.$message.success("创建成功")})):ee({name:t,labelId:this.editTagId,color:e}).then((function(i){var s,n=Object(r["a"])(a.tagList);try{for(n.s();!(s=n.n()).done;){var o=s.value;o.labelId==a.editTagId&&(o.name=t,o.color=e,o.labelName=o.name,a.updateDetailList(o,"update"))}}catch(l){n.e(l)}finally{n.f()}a.tagContent=2}))},tagCancel:function(){"create"==this.newTagType?(this.tagClose(),this.$message.info("已取消创建")):this.tagContent=2},back:function(){1==this.tagContent?this.tagContent="create"==this.newTagType?0:2:2==this.tagContent&&(this.tagContent=0)},deleteBtn:function(t){var e=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"is-particulars"}).then((function(){Zt({labelId:t.labelId}).then((function(a){for(var i in e.tagList)if(e.tagList[i].labelId==t.labelId){e.tagList.splice(i,1);break}e.$message({type:"success",message:"删除成功!"}),e.tagShow=!0})).catch((function(){e.tagShow=!0}))})).catch((function(){e.$message({type:"info",message:"已取消删除"}),e.tagShow=!0}))},getTagList:function(){var t=this;Xt().then((function(e){var a=e.data||[],i=[];t.tagList.length>0?i=t.tagList.filter((function(t){return t.check})).map((function(t){return t.labelId})):t.taskData&&t.taskData.labelList&&(i=t.taskData.labelList.map((function(t){return t.labelId})));var s,n=Object(r["a"])(a);try{for(n.s();!(s=n.n()).done;){var o=s.value;o.check=i.includes(o.labelId)}}catch(l){n.e(l)}finally{n.f()}t.tagList=a})).catch((function(){}))},referenceFun:function(){this.tagContent=0,this.tagList&&!this.tagList.length&&this.getTagList()}}},ie=ae,se=(a("ba94"),Object(m["a"])(ie,Pt,Et,!1,null,"15565314",null)),ne=se.exports,re=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-sub"},[a("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:t.subtasksSubmit,expression:"subtasksSubmit"}],staticClass:"subtasks-content"},[a("div",{staticClass:"checkbox-box subtasks-box"},[a("el-checkbox",{attrs:{disabled:t.checkDisabled},model:{value:t.checked,callback:function(e){t.checked=e},expression:"checked"}})],1),t._v(" "),a("div",{staticClass:"subtasks-content-box"},[a("el-input",{attrs:{maxlength:50,type:"textarea",autosize:"",placeholder:"请输入内容"},nativeOn:{keyup:function(e){return!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.subtasksSubmit(e)}},model:{value:t.subtasksTextarea,callback:function(e){t.subtasksTextarea=e},expression:"subtasksTextarea"}})],1),t._v(" "),a("flexbox",{staticClass:"subtasks-content-png"},[a("div",{staticClass:"time"},[a("el-date-picker",{ref:"subtasksDate",style:{width:t.subtasksDate?"54px":"28px"},attrs:{type:"date",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:t.subtasksDate,callback:function(e){t.subtasksDate=e},expression:"subtasksDate"}}),t._v(" "),t.subtasksDate?a("span",{staticClass:"bg-color"},[t._v(t._s(t._f("moment")(t.subtasksDate,"YYYY-MM-DD")))]):a("i",{staticClass:"wukong wukong-time-task",on:{click:t.subtasksDateFun}})],1),t._v(" "),a("wk-user-select",{staticStyle:{height:"auto !important"},attrs:{value:t.mainUser?t.mainUser.userId:"",request:t.ownerListRequest,params:t.ownerListParams,props:{isList:!!t.workId},radio:""},on:{change:t.xhUserCheckout}},[a("div",{staticClass:"select-box",attrs:{slot:"reference"},slot:"reference"},[t.mainUser?[a("xr-avatar",{attrs:{name:t.mainUser.realname,size:24,src:t.mainUser.img}})]:a("i",{staticClass:"wukong wukong-user"})],2)])],1)],1)])},oe=[],le=(a("1276"),{components:{WkUserSelect:C["a"]},props:{taskData:{type:Object,default:function(){return{}}},text:String,time:[String,Number],subData:Object,subTaskCom:{type:String,default:""},taskId:[Number,String],checkboxData:{type:Boolean,default:!1},checkDisabled:{type:Boolean,default:!0}},data:function(){return{subtasksDate:"",checked:!1,xhUserData:[],isRequesting:!1,subtasksTextarea:""}},computed:Object(n["a"])({mainUser:function(){return this.xhUserData&&this.xhUserData.length?this.xhUserData[0]:null},ownerListRequest:function(){return this.workId?g["e"]:null},ownerListParams:function(){return this.workId?{workId:this.workId}:null},workId:function(){return this.taskData&&this.taskData.workId&&0!=this.taskData.workId?this.taskData.workId:""},isChangeUser:function(){var t=this.subData.mainUser?[this.subData.mainUser]:[];return this.xhUserData.length!=t.length||!(!this.xhUserData.length||this.xhUserData[0].userId==this.subData.mainUser.userId)}},Object(ot["b"])(["userInfo"])),watch:{checkboxData:{handler:function(t){this.checked=t},immediate:!0}},created:function(){"edit"==this.subTaskCom&&(this.subtasksTextarea=this.text?this.text:"",this.subtasksDate=this.time,"{}"!==JSON.stringify(this.subData)?this.subData.mainUser&&(this.xhUserData=[this.subData.mainUser]):this.xhUserData=[])},methods:{subtasksSubmit:function(t){var e=this;this.subtasksTextarea=this.subtasksTextarea.split(/[\n]/).join(""),this.$listeners.add?(this.subtasksTextarea&&this.$emit("add",{checked:this.checked,name:this.subtasksTextarea,stopTime:this.subtasksDate,mainUser:0!=this.xhUserData.length?this.xhUserData[0]:null}),this.$emit("close")):this.subtasksTextarea&&!this.isRequesting?(this.isRequesting=!0,"new"==this.subTaskCom?Object(o["cb"])({pid:this.taskData.taskId,name:this.subtasksTextarea,stopTime:this.subtasksDate,mainUserId:0!=this.xhUserData.length?this.xhUserData[0].userId:""}).then((function(t){e.taskData.childTask.push({name:e.subtasksTextarea,stopTime:e.subtasksDate,taskId:t.data.taskId,mainUser:e.xhUserData.length>0?e.xhUserData[0]:e.userInfo}),e.$message.success("子任务创建成功"),e.subtasksTextarea="",e.subtasksDate="",e.isRequesting=!1,e.$emit("on-handle",{type:"add",result:"success"})})).catch((function(){e.$emit("on-handle",{type:"add",result:"error"}),e.$message.error("子任务创建失败"),e.isRequesting=!0})):"edit"==this.subTaskCom&&(1==this.isChangeUser||this.text!=this.subtasksTextarea||this.subtasksDate!=this.time?Object(o["eb"])({taskId:this.taskId,stopTime:this.subtasksDate,mainUserId:this.xhUserData.length>0?this.xhUserData[0].userId:"",name:this.subtasksTextarea}).then((function(t){for(var a=e.taskData.childTask,i=0;i<a.length;i++)if(a[i].taskId==e.taskId){var s=a[i];s.name=e.subtasksTextarea,s.stopTime=e.subtasksDate,s.mainUser=e.xhUserData.length>0?e.xhUserData[0]:null,a.splice(i,1,s);break}e.isRequesting=!1,e.$emit("on-handle",{type:"edit",result:"success"}),e.$message.success("子任务编辑成功")})).catch((function(){e.$emit("on-handle",{type:"edit",result:"error"}),e.$message.error("子任务编辑失败"),e.isRequesting=!1})):this.$emit("on-handle",{type:"cancel"}))):this.$emit("on-handle",{type:"cancel"})},xhUserCheckout:function(t,e){this.xhUserData=e},subtasksDateFun:function(){this.$refs.subtasksDate.change()}}}),ce=le,de=(a("796a"),Object(m["a"])(ce,re,oe,!1,null,"68f6a03c",null)),ue=de.exports,he=a("deea"),pe=a("a347"),me=a.n(pe),fe={data:function(){return{priorityList:[{id:3,label:"高",color:me.a.colorDanger},{id:2,label:"中",color:me.a.colorWarning},{id:1,label:"低",color:me.a.colorSuccess},{id:0,label:"无",color:me.a.colorN40}]}},methods:{getPriorityColor:function(t){return 1==t?{color:me.a.colorSuccess,label:"低"}:2==t?{color:me.a.colorWarning,label:"中"}:3==t?{color:me.a.colorDanger,label:"高"}:{color:me.a.colorN40,label:"无"}}}},be=a("53ca"),ve=(a("a630"),a("6062"),a("c740"),a("e170")),ge=(a("d9e2"),a("5319"),{methods:{UniquePromise:function(t){return new Promise((function(t){t()}))},getRules:function(t){var e=this,a=[];if(1==t.isNull&&"serial_number"!==t.formType&&(a.push({required:!0,message:t.name+"不能为空",trigger:["number","floatnumber","leads","customer","contacts","product","business","contract","receivables","receivablesPlan"].includes(t.formType)?["blur"]:["blur","change"]}),"detail_table"==t.formType?a.push({validator:function(t,a,i){var s=t.item;e.getDetailTableIsEmpty(s.fieldExtendList,a)?i(new Error(s.name+"不能为空")):i()},item:t,trigger:["blur","change"]}):"checkbox"==t.formType&&a.push({validator:function(t,e,a){var i=t.item;if(Object(kt["a"])(e)&&0!==e.length){var s=e.find((function(t){return Object(kt["b"])(t)}));""===s?a(new Error(i.name+"不能为空")):a()}else a(new Error(i.name+"不能为空"))},item:t,trigger:["blur","change"]})),1==t.isUnique&&this.UniquePromise){var i=function(a,i,s){Object(kt["b"])(i)?s():e.UniquePromise({field:t,rule:a,value:i}).then((function(){s()})).catch((function(t){s(new Error(t||"验证出错"))}))};a.push({validator:i,item:t,trigger:"checkbox"==t.formType||"select"==t.formType?["change","blur"]:["blur"]})}if("number"===t.formType||"percent"===t.formType){var s=function(a,i,s){t.hasOwnProperty("precisions")?e._getNumberRule(a,i,s):Object(kt["b"])(i)||Object(rt["v"])(i)?s():s(new Error("数字的整数部分须少于15位，小数部分须少于4位"))};a.push({validator:s,item:t,trigger:"number"===t.formType?["blur"]:["blur","change"]})}else if("floatnumber"===t.formType){var n=function(a,i,s){t.hasOwnProperty("precisions")?e._getNumberRule(a,i,s):Object(kt["b"])(i)||Object(rt["u"])(i)?s():s(new Error("货币的整数部分须少于15位，小数部分须少于2位"))};a.push({validator:n,item:t,trigger:["blur"]})}else if("mobile"===t.formType){var r=function(t,e,a){Object(kt["b"])(e)||Object(rt["t"])(e)?a():a(new Error("手机格式有误"))};a.push({validator:r,item:t,trigger:["blur"]})}else if("email"===t.formType){var o=function(t,e,a){Object(kt["b"])(e)||Object(rt["s"])(e)?a():a(new Error("邮箱格式有误"))};a.push({validator:o,item:t,trigger:["blur"]})}else if("location"===t.formType&&1==t.isNull){var l=function(e,a,i){!Object(kt["c"])(a)||Object(kt["c"])(a)&&Object(kt["b"])(a.lat)&&Object(kt["b"])(a.lng)&&Object(kt["b"])(a.address)?i(new Error(t.name+"不能为空")):i()};a.push({validator:l,item:t,trigger:["change"]})}else if("customer"===t.formType&&"superiorCustomerId"===t.fieldName){var c=function(t,a,i){e.action&&"update"===e.action.type&&Object(kt["a"])(a)&&a.length>0&&a[0].customerId===e.action.id?i(new Error("上级客户不能为当前客户")):i()};a.push({validator:c,item:t,trigger:["change"]})}else if("contacts"===t.formType&&"parentContactsId"===t.fieldName){var d=function(t,a,i){e.action&&"update"===e.action.type&&Object(kt["a"])(a)&&a.length>0&&a[0].contactsId===e.action.id?i(new Error("直属上级不能为当前联系人")):i()};a.push({validator:d,item:t,trigger:["change"]})}return a},_getNumberRule:function(t,e,a){var i=t.item,s=String(e).split("."),n=String(e).replace(".","").replace("-","").length,r="percent"===i.formType?10:15,o=Object(kt["b"])(i.minNumRestrict)?-1/0:Number(i.minNumRestrict||-1/0),l=Object(kt["b"])(i.maxNumRestrict)?1/0:Number(i.maxNumRestrict||1/0);n>r?a(new Error("最多支持".concat(r,"位数字（包含小数位）"))):Object(kt["b"])(i.precisions)&&String(e).includes(".")?a(new Error("不支持小数")):s.length>1&&s[1].length>Number(i.precisions)?a(new Error("小数位不能大于".concat(i.precisions))):e<o?a(new Error("不能小于".concat(o))):e>l?a(new Error("不能大于".concat(l))):a()},getDetailTableIsEmpty:function(t,e){for(var a=0;a<e.length;a++){var i=e[a];if(this.judgeFormValueIsEmpty(t,i))return!0}return!1},judgeFormValueIsEmpty:function(t,e){for(var a=0;a<t.length;a++){var i=t[a],s=e[i.fieldName];if("location"===i.formType){if(Object(kt["c"])(s)&&(!Object(kt["b"])(s.lat)||!Object(kt["b"])(s.lng)||!Object(kt["b"])(s.address)))return!1}else if(!Object(kt["b"])(s))return!1}return!0}}}),ke="其他",ye={mixins:[ge],props:{},methods:{getItemValue:function(t,e,a){var i=this;if(e=e||{},"contacts"==t.formType||"customer"==t.formType||"contract"==t.formType||"business"==t.formType){if("update"===a)return t.value?Object(rt["r"])(t.value):[];var s=e[t.formType];return s?[s]:[]}if("category"==t.formType)return t.value?t.value:[];if("product"==t.formType)return t.value;if("map_address"==t.formType)return"update"==a?(t.value.address&&(t.value.address=t.value.address.split(",")),t.value):{};if("address"==t.formType){if("update"==a){if(t.value){if("string"===typeof t.value){var n=t.value.split(",");return{province:n[0]||"",city:n[1]||"",area:n[2]||""}}return t.value}return{}}return{}}if("single_user"==t.formType)return"update"===a?Object(kt["c"])(t.value)&&t.value.userId?t.value.userId:"":Object(kt["a"])(t.defaultValue)&&t.defaultValue.length>0?Object(rt["r"])(t.defaultValue[0]).userId:"";if("user"==t.formType||"structure"==t.formType||"file"==t.formType)return"update"===a?t.value?Object(rt["r"])(t.value):[]:t.defaultValue?Object(rt["r"])(t.defaultValue):[];if("number"==t.formType||"floatnumber"==t.formType||"percent"==t.formType)return"update"==a?Object(kt["b"])(t.value)?void 0:t.value:Object(kt["b"])(t.defaultValue)?void 0:t.defaultValue;if("field_attention"==t.formType)return"update"==a?Object(kt["b"])(t.value)?0:Number(t.value):Object(kt["b"])(t.defaultValue)?0:Number(t.defaultValue);if("detail_table"==t.formType){var r=Object(kt["b"])(t.value)?[t.fieldExtendList]:t.value;if("string"===typeof r&&r)try{r=JSON.parse(r)}catch(l){}var o=[];return r.forEach((function(t){var e={};o.push(e),t.forEach((function(t){["select","checkbox"].includes(t.formType)&&(t.optionsData=null),e[t.fieldName]=i.getItemValue(t,null,a)}))})),o}return"update"==a?null===t.value||void 0===t.value?"":t.value:null===t.defaultValue||void 0===t.defaultValue?"":t.defaultValue},getUniquePromise:function(t,e,a){var i=this;return new Promise((function(s,n){var r={};r.fieldId=t.fieldId;var o=i.getRealParams(t,e);r.value=o&&"object"===Object(be["a"])(o)?JSON.stringify(o):o,"update"==a.type&&(r.batchId=a.batchId),Object(ve["h"])(r).then((function(e){var a=e.data||{};1===a.status?s():a.ownerUserName?n("".concat(t.name,"已存在，负责人为“").concat(a.ownerUserName,"”")):a.poolNames&&a.poolNames.length>0?n("".concat(t.name,"已存在，当前位于公海“").concat(a.poolNames.join("，"),"”")):n("".concat(t.name,"已存在"))})).catch((function(){n()}))}))},getFormItemDefaultProperty:function(t){var e=this,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=a?Object(rt["r"])(t):t;if(i.field=t.fieldName,"date_interval"===t.formType)2===t.precisions?(i.dateType="datetimerange",i.dateValueFormat="yyyy-MM-dd HH:mm:ss"):(i.dateType="daterange",i.dateValueFormat="yyyy-MM-dd");else if("position"===t.formType)i.showDetail=1===t.precisions,i.hideArea=3===t.precisions||4===t.precisions,i.onlyProvince=4===t.precisions;else if("detail_table"===t.formType){var s={};i.fieldExtendList.forEach((function(t){var a=Object(rt["r"])(t);e.getFormItemDefaultProperty(t,!1),t.show=1!==t.isHidden,t.show&&(t.rules=e.getRules(a)),e.getItemRadio(t,t),s[t.fieldName]=e.getItemValue(t)})),i.fieldForm=s;var n=Object(rt["r"])(t.fieldExtendList),r=Object(kt["b"])(t.value)?[n]:t.value;if("string"===typeof r&&r)try{r=JSON.parse(r)}catch(l){}var o=[];r.forEach((function(t){var a=[];t.forEach((function(t){var i=Object(rt["r"])(t),s=e.getFormItemDefaultProperty(t,!1);e.getItemRadio(t,s),s.show=1!==s.isHidden,s.show&&(s.rules=e.getRules(i)),a.push(s)})),o.push(a)})),i.fieldList=o}return i},getItemWithFromType:function(t,e){for(var a=null,i=0;i<t.length;i++){for(var s=t[i],n=0;n<s.length;n++){var r=s[n];if(r.formType===e){a=r;break}}if(a)break}return a},itemsForEach:function(t,e){for(var a=0;a<t.length;a++){var i=t[a];if(Object(kt["a"])(i))for(var s=0;s<i.length;s++){var n=i[s];e(n,a,s,i)}else e(i,a)}},getItemIsCanEdit:function(t,e){return!!Object(kt["b"])(t.authLevel)||("update"!==e||"serial_number"!==t.formType)&&3==t.authLevel},getItemRadio:function(t,e){"user"==t.formType||"structure"==t.formType?e.radio=!1:"single_user"==t.formType&&(e.radio=!0)},getFormErrorMessage:function(t){if(t.fields)for(var e=0;e<t.fields.length;e++){var a=t.fields[e];if("error"==a.validateState){this.$message.error(a.validateMessage);break}}},getItemRelatveInfo:function(t,e){var a=null;if("relative"==this.action.type)a=this.action.data[e];else{var i=t.length>0&&Object(kt["a"])(t[0]),s=i?this.getItemWithFromType(t,e):t.find((function(t){return t.formType===e}));s&&s.value&&s.value.length>0&&(a=s.value[0])}return a},getSubmiteParams:function(t,e,a,i){for(var s=this,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:["desc_text"],o={entity:{},field:[]},l=function(l){var c=t[l],d=null;if(d=c.hasOwnProperty("show")?c.show?e[c.fieldName]:null:e[c.fieldName],"product"==c.formType)s.getProductParams(o,d);else if("map_address"==c.formType)s.getCustomerAddressParams(o.entity,d);else if(1==c.fieldType){var u=s.getRealParams(c,d);o.entity[c.fieldName]=Object(kt["b"])(u)?"":u}else if(!r.includes(c.formType)){var h=Object(n["a"])(Object(n["a"])({},i?c:{}),{},{fieldName:c.fieldName,fieldType:c.fieldType,name:c.name,type:c.type,fieldId:c.fieldId,value:s.getRealParams(c,d)});Object(kt["a"])(a)&&a.forEach((function(t){h[t]=c[t]})),o.field.push(h)}},c=0;c<t.length;c++)l(c);return o},getProductParams:function(t,e){e?(t["product"]=e.product?e.product.map((function(t){return t.salesPrice=""==t.salesPrice?0:t.salesPrice,t.num=""==t.num?0:t.num,t.discount=""==t.discount?0:t.discount,t})):[],t.entity["totalPrice"]=e.totalPrice?e.totalPrice:0,t.entity["discountRate"]=e.discountRate?e.discountRate:0):(t["product"]=[],t.entity["totalPrice"]="",t.entity["discountRate"]="")},getCustomerAddressParams:function(t,e){e?(t["address"]=e.address?e.address.join(","):"",t["detailAddress"]=e.detailAddress,t["location"]=e.location,t["lng"]=e.lng,t["lat"]=e.lat):(t["address"]="",t["detailAddress"]="",t["location"]="",t["lng"]="",t["lat"]="")},getRealParams:function(t,e){var a=this,i=["customer","contacts","business","leads","contract"];if(i.includes(t.formType))return Object(kt["b"])(e)?"":Object(kt["a"])(e)&&e.length>0&&Object(kt["c"])(e[0])?e[0]["".concat(t.formType,"Id")]:Object(kt["a"])(e)?e[e.length-1]:["string","number"].includes(Object(be["a"])(e))?e:"";if("user"==t.formType||"structure"==t.formType){var s=e||[];return Object(kt["a"])(e)&&e.length>0&&Object(kt["c"])(e[0])&&(s=e.map((function(e){return"user"==t.formType?e.userId:e.id}))),Object(kt["a"])(s)?s.join(","):s}if("file"==t.formType)return e&&e.length>0?e[0].batchId:"";if("category"==t.formType)return Object(kt["b"])(e)?"":Object(kt["a"])(e)?e&&e.length>0?e[e.length-1]:"":e;if("checkbox"==t.formType)return Object(kt["a"])(e)?e.join(","):e;if("select"==t.formType)return e;if("detail_table"==t.formType){for(var n=t.fieldExtendList||[],r=[],o=Array.isArray(e)?e:[],l=function(t){var e=o[t];if(!a.getFormValueIsEmpty(n,e)){var i=[];n.forEach((function(t){var s=Object(rt["r"])(t);delete s.companyId,s.value=a.getRealParams(s,e[s.fieldName]),i.push(s)})),r.push(i)}},c=0;c<o.length;c++)l(c);return r}return e},getFormValueIsEmpty:function(t,e){for(var a=0;a<t.length;a++){var i=t[a],s=e[i.fieldName];if("location"===i.formType){if(Object(kt["c"])(s)&&(!Object(kt["b"])(s.lat)||!Object(kt["b"])(s.lng)||!Object(kt["b"])(s.address)))return!1}else if(!Object(kt["b"])(s))return!1}return!0},getFormAssistIds:function(t,e){var a=this,i=[],s=e?null:{};e&&this.itemsForEach(t,(function(t){e.hasOwnProperty(t.field)||(e[t.field]=a.getItemValue(t))})),this.itemsForEach(t,(function(t){if(s&&(s[t.field]=a.getItemValue(t)),["select","checkbox"].includes(t.formType)&&"options_type"===t.remark&&t.optionsData)for(var e in t.optionsData)i=i.concat(t.optionsData[e]||[])})),i=i.filter((function(t){return Boolean(t)})),i=Array.from(new Set(i));var n=[];return this.getFormAssistData(t,e||s,i,n),i.filter((function(t){return!n.includes(t)}))},getFormAssistData:function(t,e,a,i){var s=i.length;if(this.itemsForEach(t,(function(t){if(["select","checkbox"].includes(t.formType)&&"options_type"===t.remark&&t.optionsData){var s=e?e[t.field||t.fieldName]:t.value;if(!a.includes(t.formAssistId)){if("select"===t.formType)if(Object(kt["b"])(s))s=[];else{var n=t.setting.find((function(t){return Object(kt["c"])(t)?t.value===s:t===s}));if(n){var r=Object(kt["c"])(n)?n.value:n;s=[r]}else s=[ke]}else if("checkbox"===t.formType)if(Object(kt["a"])(s)){var o=Object(rt["r"])(s),l=o.filter((function(e){return!t.setting.includes(e)}));if(l.length>0){var c=o.filter((function(t){return!l.includes(t)}));c.push(ke),s=c}}else s=[];var d=function(e){if(s){var a=s.findIndex((function(t){return t==e}));if(-1===a)return"continue";for(var n=t.optionsData[e]||[],r=0;r<n.length;r++){var o=n[r];i.includes(o)||i.push(o)}}};for(var u in t.optionsData)d(u)}}})),s!==i.length){var n=a.filter((function(t){return!i.includes(t)}));this.getFormAssistData(t,e,n,i)}},getFormContentByOptionsChange:function(t,e){var a=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4?arguments[4]:void 0,r=this.fieldRules||i,o=this.action&&this.action.data?this.action.data:s,l=this.action&&this.action.type?this.action.type:n,c={},d={},u=this.getFormAssistIds(t,e);return this.itemsForEach(t,(function(t){t.show=!u.includes(t.formAssistId),!t.show||t.disabled&&1!=t.isNull||(r[t.field]?c[t.field]=r[t.field]:c[t.field]=a.getRules(t)),t.show&&(e.hasOwnProperty(t.field)?d[t.field]=e[t.field]:d[t.field]=a.getItemValue(t,o,l))})),{fieldForm:d,fieldRules:c}}}},Ce=a("c1df"),we=a.n(Ce),Te={name:"TaskCreate",components:{XrCreate:S["a"],CreateSections:O["a"],WkForm:Vt,TagIndex:ne,SubTask:ue,FileCell:he["a"]},mixins:[ye,fe],props:{action:{type:Object,default:function(){return{type:"save",id:"",data:{}}}}},data:function(){return{loading:!1,fieldList:[],fieldForm:{},fieldRules:{name:{required:!0,message:"任务名称不能为空",trigger:["blur","change"]}},addSubtasks:!0,batchId:Object(rt["q"])()}},computed:Object(n["a"])(Object(n["a"])({},Object(ot["b"])(["userInfo"])),{},{title:function(){return"update"===this.action.type?"编辑任务":"新建任务"}}),watch:{},created:function(){var t={priority:0,mainUserId:this.userInfo.userId,ownerUserId:[this.userInfo.userId]};if(this.action.data){var e=this.action.data;e.name&&(t.name=e.name),t.stopTime=e.stopTime||"",e.mainUserId&&(t.mainUserId=e.mainUserId)}this.fieldForm=t,this.getField()},mounted:function(){},beforeDestroy:function(){},methods:{getField:function(){var t=[{name:"任务名称",field:"name",formType:"text",setting:[]},{name:"描述",field:"description",formType:"textarea",setting:[]},{name:"优先级",field:"priority",formType:"select",setting:this.getPrioritySetting()},{name:"负责人",field:"mainUserId",radio:!0,formType:"user",setting:[]},{name:"开始时间",field:"startTime",formType:"date",setting:[]},{name:"结束时间",field:"stopTime",formType:"date",setting:[]},{name:"参与人",field:"ownerUserId",radio:!1,formType:"user",setting:[]},{name:"标签",field:"labelId",formType:"tag",setting:[]},{name:"子任务",field:"taskInfoList",formType:"subTask",setting:[]},{name:"附件",field:"files",formType:"taskFile",setting:[]}];this.fieldList=t},getPrioritySetting:function(){return this.priorityList.map((function(t){return{label:t.label,value:t.id}}))},saveClick:function(){var t=this;this.loading=!0;var e=this.$refs.crmForm.instance;e.validate((function(a){if(!a)return t.loading=!1,t.getFormErrorMessage(e),!1;t.submiteParams()}))},submiteParams:function(){var t=this,e={batchId:this.batchId};if(this.action.params&&(e=Object(n["a"])(Object(n["a"])({},e),this.action.params)),this.fieldList.forEach((function(a){if("user"===a.formType&&0==a.radio){var i=t.fieldForm[a.field]?t.fieldForm[a.field]:[];e[a.field]=i.join(",")}else if("tag"===a.formType){var s=t.fieldForm[a.field]?t.fieldForm[a.field]:[];e[a.field]=s.map((function(t){return t.labelId})).join(",")}else if("subTask"===a.formType){var n=t.fieldForm[a.field]||[];e[a.field]=n.map((function(t){return{status:t.checked?5:1,mainUserId:t.mainUser?t.mainUser.userId:"",name:t.name,stopTime:t.stopTime}}))}else"taskFile"!==a.formType&&(e[a.field]=t.fieldForm[a.field])})),e.startTime&&e.stopTime&&we()(e.stopTime).isBefore(we()(e.startTime)))return this.$message.error("开始时间必须小于结束时间"),void(this.loading=!1);T(e).then((function(e){t.loading=!1,t.$message.success("update"==t.action.type?"编辑成功":"添加成功"),t.close(),t.$emit("save")})).catch((function(){t.loading=!1}))},formChange:function(t,e,a,i){},otherChange:function(t,e){this.$set(this.fieldForm,e.field,t.value||t),this.$refs.crmForm.instance.validateField(e.field)},subTaskDelete:function(t,e,a){this.fieldForm[a.field].splice(e,1)},subTaskAdd:function(t,e){var a=this.fieldForm[e.field]||[];a.push(t),this.$set(this.fieldForm,e.field,a)},httpRequest:function(t){var e=this;this.$wkUploadFile.upload({file:t.file,params:{batchId:this.batchId}}).then((function(t){var a=t.res,i=a.data||{},s=e.fieldForm["files"]||[];s.push(i),e.$set(e.fieldForm,"files",s),e.$message.success("上传成功")})).catch((function(){}))},fileDelete:function(t,e,a){this.fieldForm["files"].splice(t,1)},close:function(){this.$emit("close")},colorRgb:function(t,e){return Object(rt["b"])(t,e)}}},_e=Te,xe=(a("c82b"),Object(m["a"])(_e,j,L,!1,null,"61f286aa",null)),Ie=xe.exports,De={relatedObj:{},relatedObjIds:{}},je={name:"TaskQuickAdd",components:{WkUserSelect:C["a"],TaskCreate:Ie},props:{showStyle:{type:String,default:"default"},params:Object,props:Object},data:function(){return{sendLoading:!1,isUnfold:!1,sendContent:"",sendStopTime:"",mainUser:[],taskCreateShow:!1,createAction:{type:"save"}}},computed:{createMainUser:function(){return this.mainUser&&this.mainUser.length?this.mainUser[0]:null},config:function(){return Object(J["a"])(Object(n["a"])({},De),this.props||{})}},watch:{},mounted:function(){},beforeDestroy:function(){},methods:{inputFocus:function(){var t=this;this.$emit("focus"),this.isUnfold=!0,this.$nextTick((function(){t.$refs.input.focus()}))},selectMainUser:function(t,e){this.mainUser=e},send:function(){var t=this;if(this.sendContent.length){this.sendLoading=!0;var e={name:this.sendContent,stopTime:this.sendStopTime,mainUserId:this.createMainUser?this.createMainUser.userId:""};this.params&&(e=Object(n["a"])(Object(n["a"])({},e),this.params)),T(e).then((function(e){t.sendLoading=!1,t.$message.success("新建成功"),t.resetSendData(),t.$emit("send")})).catch((function(){t.sendLoading=!1}))}else this.$message.error("请填写任务标题")},resetSendData:function(){this.sendContent="",this.sendStopTime="",this.mainUser=[],this.isUnfold=!1},createSuccess:function(){this.resetSendData(),this.$emit("send")},addClose:function(){this.isUnfold=!1},moreClick:function(){this.createAction={type:"save",data:{name:this.sendContent,stopTime:this.sendStopTime,mainUserId:this.createMainUser?this.createMainUser.userId:"",relatedObj:this.config.relatedObj,relatedObjIds:this.config.relatedObjIds},params:this.params},this.taskCreateShow=!0}}},Le=je,Se=(a("0d64"),Object(m["a"])(Le,k,y,!1,null,"44939bb7",null)),Oe=Se.exports,$e=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("slide-view",{directives:[{name:"empty",rawName:"v-empty",value:!t.canShowDetail,expression:"!canShowDetail"}],ref:"sideView",staticClass:"d-view",attrs:{"no-listener-class":t.noListenerClass,"body-style":{padding:0,height:"100%"},"xs-empty-icon":"nopermission","xs-empty-text":"暂无权限"},on:{afterEnter:t.viewAfterEnter,close:t.hideView}},[null!==t.loading?i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"main"},[t.taskData?[i("div",{staticClass:"main__left left-padding"},[i("flexbox",{staticClass:"main-top",attrs:{justify:"space-between"}},[t.taskData.createUser?i("span",[t._v(t._s(t.taskData.createUser.realname)+" 创建于 "+t._s(t.taskData.createTime))]):t._e()]),t._v(" "),i("flexbox",{staticClass:"margin-top-base",attrs:{align:"stretch"}},[t.nameVinput?i("wk-edit-wrap",{on:{save:function(e){t.submiteTaskName(t.taskDataName)},cancel:function(e){t.nameVinput=!1}}},[i("el-input",{attrs:{maxlength:100,size:"medium"},model:{value:t.taskDataName,callback:function(e){t.taskDataName=e},expression:"taskDataName"}})],1):i("el-tooltip",{attrs:{content:t.taskData.name,effect:"dark",placement:"top"}},[i("div",{class:["task-name","backgroud-btn",{"is-checked":t.taskData.checked}],on:{click:t.editTaskName}},[t._v(t._s(t.taskData.name))])])],1),t._v(" "),t.labelList?i("div",{staticClass:"label",staticStyle:{"margin-top":"4px"}},[i("tag-view",{staticClass:"tag-view",attrs:{value:t.tagLabelList,"max-length":1/0,wrap:"wrap"}},[t.getPermission("setTaskLabel")?i("div",{staticClass:"add-tag"},[i("tag-index",{attrs:{placement:"bottom-start","task-data":t.taskData}},[i("el-button",{attrs:{slot:"editIndex",type:"icon",size:"small",icon:"wk wk-icon-label-solid"},slot:"editIndex"})],1)],1):t._e()])],1):t._e(),t._v(" "),i("div",{staticClass:"participant margin-top-base"},[i("flexbox",{staticClass:"participant-bd",attrs:{wrap:"wrap"}},[t._l(t.ownerUserShowList,(function(e,s){return i("span",{key:s,class:["owner-list",{"owner-list-fold":t.taskData.ownerUserList.length<5}]},[i("xr-avatar",{staticClass:"user-img",attrs:{name:e.realname,size:32,src:e.img}}),t._v(" "),t.getPermission("setTaskOwnerUser")?i("img",{staticClass:"el-icon-close",attrs:{src:a("704b")},on:{click:function(a){t.deleteOwnerList(e,s)}}}):t._e()],1)})),t._v(" "),t.taskData.ownerUserList.length>5?i("el-dropdown",{attrs:{trigger:"click","hide-on-click":!1}},[i("el-button",{staticClass:"dropdown-btn owner-list-button"},[t._v("\n                +"+t._s(t.taskData.ownerUserList.length-5)+"\n              ")]),t._v(" "),i("el-dropdown-menu",{staticClass:"owner-list-dropdown",attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.ownerUserHideList,(function(e,a){return i("el-dropdown-item",{key:a,staticClass:"owner-list-dropdown-list"},[i("xr-avatar",{staticClass:"owner-list-dropdown-img",staticStyle:{"margin-right":"10px"},attrs:{name:e.realname,size:32,src:e.img}}),t._v(" "),i("p",{staticClass:"owner-list-dropdown-text"},[t._v(t._s(e.realname)+" ")]),t._v(" "),i("i",{staticClass:"el-icon-close owner-list-dropdown-i",on:{click:function(i){t.deleteOwnerList(e,a+5)}}})],1)})))],1):t._e(),t._v(" "),t.getPermission("setTaskOwnerUser")?i("members-dep",{staticStyle:{"margin-left":"15px"},attrs:{"close-dep":!0,"content-block":!1,"user-checked-data":t.taskData.ownerUserList,"user-request":t.ownerListRequest,"user-params":t.ownerListParams},on:{popoverSubmit:t.editOwnerList}},[i("i",{staticClass:"wk wk-l-plus participant-add",attrs:{slot:"membersDep"},slot:"membersDep"})]):t._e()],2)],1),t._v(" "),i("div",{staticClass:"secitons"},[i("div",{staticClass:"section"},[i("div",{staticClass:"section__hd"},[i("span",[t._v("描述")])]),t._v(" "),i("div",{staticClass:"section__bd description"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.addDescriptionShow,expression:"!addDescriptionShow"}]},[t.taskData.description?i("div",{staticClass:"description-content",on:{click:t.editTaskDescription}},[t._v(t._s(t.taskData.description))]):i("div",{staticClass:"description-empty"},[i("span",{staticClass:"color-label",on:{click:t.editTaskDescription}},[t._v("暂无描述")])])]),t._v(" "),i("wk-edit-wrap",{directives:[{name:"show",rawName:"v-show",value:t.addDescriptionShow,expression:"addDescriptionShow"}],on:{save:t.submiteDescription,cancel:function(e){t.addDescriptionTextarea="",t.addDescriptionShow=!1}}},[i("el-input",{attrs:{autosize:{minRows:2},maxlength:2e3,"show-word-limit":"",type:"textarea",placeholder:"请输入内容"},model:{value:t.addDescriptionTextarea,callback:function(e){t.addDescriptionTextarea=e},expression:"addDescriptionTextarea"}})],1)],1)]),t._v(" "),i("div",{staticClass:"section"},[i("div",{staticClass:"section__hd"},[i("span",[t._v("子任务("+t._s(t.subTaskDoneNum)+"/"+t._s(t.taskData.childTask.length)+")")]),t._v(" "),i("i",{staticClass:"wk wk-l-plus section-add",staticStyle:{float:"right"},on:{click:function(e){t.addSubtasks=!1}}})]),t._v(" "),i("div",{staticClass:"section__bd"},[0==t.taskData.pid?i("div",[0===t.taskData.childTask.length&&t.addSubtasks?t._e():i("div",{staticClass:"sub-task-all"},[t._l(t.taskData.childTask,(function(e,a){return i("div",{key:a,staticClass:"sub-task"},[e.showEdit?i("sub-task",{attrs:{"sub-task-com":"edit",time:e.stopTime,"sub-data":e,text:e.name,"task-id":t.subTaskID,"checkbox-data":e.checked,"task-data":t.taskData},on:{"on-handle":function(a){t.handleSubTasksBlock(a,e)}}}):i("flexbox",{class:{"is-checked-background":e.checked},staticStyle:{padding:"14px"}},[i("div",{on:{click:function(t){t.stopPropagation()}}},[i("el-checkbox",{attrs:{disabled:!t.getPermission("setChildTaskStatus")},on:{change:function(a){t.subtasksCheckbox(e,a)}},model:{value:e.checked,callback:function(a){t.$set(e,"checked",a)},expression:"item.checked"}})],1),t._v(" "),i("div",{staticClass:"sub-task__bd text-one-line",class:{"is-checked":e.checked}},[t._v("\n                        "+t._s(e.name)+"\n                      ")]),t._v(" "),e.stopTime?i("div",{staticClass:"bg-color task-bg-color",staticStyle:{"margin-left":"8px"}},[t._v(t._s(t._f("moment")(e.stopTime,"YYYY-MM-DD"))+" 截止")]):t._e(),t._v(" "),e.mainUser?i("xr-avatar",{staticClass:"user-img",attrs:{name:e.mainUser.realname,size:25,src:e.mainUser.img}}):t._e(),t._v(" "),i("div",{staticClass:"edit-del-dropdown"},[i("el-dropdown",{attrs:{"hide-on-click":!1},on:{command:t.handleSubTask}},[i("span",{staticClass:"el-dropdown-link"},[i("i",{staticClass:"el-icon-more",staticStyle:{cursor:"pointer"}})]),t._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:{type:"update",data:e}}},[t.getPermission("updateChildTask")?i("span",[t._v("\n                                编辑\n                              ")]):t._e()]),t._v(" "),i("el-dropdown-item",{attrs:{command:{type:"delete",data:e}}},[t.getPermission("deleteChildTask")?i("span",[t._v("\n                                删除\n                              ")]):t._e()])],1)],1)],1)],1)],1)})),t._v(" "),t.addSubtasks?t._e():i("div",[i("sub-task",{attrs:{"sub-task-com":"new","task-data":t.taskData},on:{"on-handle":t.handleSubTasksBlock}})],1)],2),t._v(" "),t.getPermission("addChildTask")?void 0:t._e()],2):t._e()])]),t._v(" "),i("div",{staticClass:"section"},[i("div",{staticClass:"section__hd "},[i("span",[t._v("附件")]),t._v(" "),t.fileList.length?i("span",[t._v("("+t._s(t.fileList.length)+")")]):t._e(),t._v(" "),t.getPermission("uploadTaskFile")?i("el-upload",{staticClass:"upload-file",staticStyle:{float:"right"},attrs:{"http-request":t.httpRequest,action:"https://jsonplaceholder.typicode.com/posts/",multiple:"","list-type":"picture"}},[i("i",{staticClass:"wk wk-l-plus section-add",staticStyle:{float:"right"}})]):t._e()],1),t._v(" "),i("div",{staticStyle:{"margin-top":"20px"}},[i("file-cell",{attrs:{"file-list":t.fileList,"module-id":t.id,"show-delete":t.getPermission("deleteTaskFile")},on:{delete:t.accessoryDeleteFun}})],1)])]),t._v(" "),i("div",{staticClass:"margin-top-base "},[i("div",[t._v("活动")]),t._v(" "),i("div",{staticClass:"activity-title"},[t._v("\n            显示：\n            "),t._l(t.tabs,(function(e,a){return i("el-button",{key:a,attrs:{type:e.value===t.tabValue?"selected":""},on:{click:function(a){t.tabValue=e.value}}},[t._v(t._s(e.label))])}))],2),t._v(" "),"comment"===t.tabValue?i("flexbox",{directives:[{name:"loading",rawName:"v-loading",value:t.commentsLoading,expression:"commentsLoading"}],staticClass:"comment-cells",attrs:{direction:"column",align:"stretch"}},[t.replyList&&t.replyList.length>0?i("comment-list",{ref:"comment_list",attrs:{props:t.commentListProps,list:t.replyList},on:{delete:t.deleteComment,"close-other-reply":function(e){t.$refs.f_reply.toggleFocus(!0)}}}):t._e(),t._v(" "),i("flexbox",{staticClass:"reply-comment-wrap",attrs:{align:"stretch"}},[i("xr-avatar",{staticClass:"user-img",attrs:{name:t.userInfo.realname,size:32,src:t.userInfo.img}}),t._v(" "),i("reply-comment",{ref:"f_reply",on:{toggle:t.closeOtherReply,reply:t.handleReply}})],1)],1):"activity"===t.tabValue?i("div",{staticClass:"activity-cells"},t._l(t.activityList,(function(e,a){return i("flexbox",{key:a,staticClass:"activity-cell",attrs:{align:"stretch"}},[i("xr-avatar",{staticClass:"user-img",attrs:{name:e.realname,size:26,src:e.img}}),t._v(" "),i("div",{staticClass:"activity-cell__bd"},[i("div",{staticClass:"activity-info"},[i("span",{staticClass:"activity-info--name"},[t._v(t._s(e.realname))]),t._v(" "),i("span",{staticClass:"activity-info--time"},[t._v(t._s(e.createTime))])]),t._v(" "),i("div",{staticClass:"activity-content"},[t._v(t._s(e.content))])])],1)}))):t._e()],1)],1),t._v(" "),i("div",{staticClass:"main__right right-padding"},[i("div",{staticClass:"main-top align-right"},[t.isArchive?i("span",{staticClass:"margin-right-base"},[t._v("该任务已于 "+t._s(t.taskData.archiveTime)+" 被归档")]):t._e(),t._v(" "),t.isArchive?i("el-button",{attrs:{type:"primary"},on:{click:t.activateTask}},[t._v("激活")]):t._e(),t._v(" "),t.isRecycle?i("span",{staticClass:"margin-right-base"},[t._v("该任务已于 "+t._s(t.taskData.hiddenTime)+" 被放入回收站")]):t._e(),t._v(" "),t.isRecycle&&t.getPermission("restoreTask")?i("el-button",{attrs:{type:"primary"},on:{click:t.recoverTask}},[t._v("恢复")]):t._e(),t._v(" "),t.isRecycle&&t.getPermission("cleanTask")?i("el-button",{attrs:{type:"danger"},on:{click:t.thoroughDeleteTask}},[t._v("彻底删除")]):t._e(),t._v(" "),t.showArchiveBtn&&t.getPermission("archiveTask")?i("el-button",{attrs:{type:"primary"},on:{click:t.moreArchive}},[t._v("归档")]):t._e(),t._v(" "),!t.isRecycle&&t.getPermission("deleteTask")?i("el-dropdown",{attrs:{trigger:"click"},on:{command:t.morkDropdownClick}},[i("el-button",{staticClass:"dropdown-btn",attrs:{icon:"el-icon-more"}}),t._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"delete"}},[t._v("删除")])],1)],1):t._e()],1),t._v(" "),i("el-dropdown",{staticClass:"dropdown-status-btn",attrs:{disabled:!t.getPermission("setTaskStatus")},on:{command:t.completeMainTask}},[i("el-button",{class:{"is-done":t.taskData.checked},attrs:{disabled:!t.getPermission("setTaskStatus"),type:"primary"}},[t._v("\n            "+t._s(t.taskData.checked?"已完成":"进行中")),i("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",[t._v(t._s(t.taskData.checked?"进行中":"已完成"))])],1)],1),t._v(" "),i("wk-head-section",{attrs:{label:"详细信息"}},[i("div",{staticClass:"detail-form"},t._l(t.detailList,(function(e,a){return i("wk-section-item",{key:a,attrs:{label:e.label}},["priority"===e.field?i("flexbox",{nativeOn:{click:function(e){t.priorityVisible=!0}}},[i("el-popover",{attrs:{disabled:!t.getPermission("setTaskPriority"),"popper-class":"no-padding-popover",placement:"bottom",trigger:"click"},model:{value:t.priorityVisible,callback:function(e){t.priorityVisible=e},expression:"priorityVisible"}},[i("flexbox",{staticClass:"priority-select"},t._l(t.priorityList,(function(e,a){return i("div",{key:a,staticClass:"priority-select-item",on:{click:function(a){t.priorityBtn(e,t.taskData.priority)}}},[i("span",{staticClass:"priority--icon",style:{backgroundColor:e.color}},[t._v("\n                        "+t._s(e.label)+"\n                      ")])])}))),t._v(" "),i("div",{staticClass:"priority--slot",attrs:{slot:"reference"},slot:"reference"},[i("div",{staticClass:"priority--ball",style:{backgroundColor:t.priority.color}}),t._v(" "),i("span",{staticClass:"priority--text"},[t._v("\n                      "+t._s(t.priority.label)+"\n                    ")])])],1)],1):"mainUser"===e.field?i("wk-user-select",{staticStyle:{width:"100%"},attrs:{value:t.taskData.mainUser?t.taskData.mainUser.userId:"",request:t.ownerListRequest,params:t.ownerListParams,props:{isList:!!t.ownerListRequest},disabled:!t.getPermission("setTaskMainUser"),radio:""},on:{change:t.mainUserChange}},[i("flexbox",{staticClass:"head-btn",attrs:{slot:"reference"},slot:"reference"},[t.taskData.mainUser?i("xr-avatar",{staticClass:"user-img",attrs:{disabled:"",name:t.taskData.mainUser?t.taskData.mainUser.realname:"",size:30,src:t.taskData.mainUser?t.taskData.mainUser.img:""}}):i("span",{staticClass:"head-btn__text"},[t._v("\n                    点击选择负责人\n                  ")]),t._v(" "),i("div",{staticClass:"head-btn__bd"},[t.taskData.mainUser?i("div",{staticClass:"head-btn__bd--name"},[t._v("\n                      "+t._s(t.taskData.mainUser.realname)+"\n                    ")]):t._e()]),t._v(" "),i("i",{directives:[{name:"show",rawName:"v-show",value:t.taskData.mainUser&&t.getPermission("setTaskMainUser"),expression:"taskData.mainUser && getPermission('setTaskMainUser')"}],staticClass:"el-icon-close head-btn__close",on:{click:function(e){e.stopPropagation(),t.submiteMainUser(null)}}})],1)],1):"startTime"===e.field?i("flexbox",{staticClass:"head-btn"},[t.taskData.startTime?t._e():i("span",{staticClass:"head-btn__text"},[t._v("\n                  点击选择开始时间\n                ")]),t._v(" "),i("el-date-picker",{attrs:{clearable:!1,disabled:!t.getPermission("setTaskTime"),"picker-options":t.startTimeOptions,type:"date","value-format":"yyyy-MM-dd"},on:{change:function(e){t.timeChange("startTime")}},model:{value:t.taskData.startTime,callback:function(e){t.$set(t.taskData,"startTime",e)},expression:"taskData.startTime"}}),t._v(" "),i("div",{staticClass:"head-btn__bd"},[t.taskData.startTime?i("div",{staticClass:"head-btn__bd--title"},[t._v(t._s(t._f("moment")(t.taskData.startTime,"YYYY年MM月DD日")))]):t._e()]),t._v(" "),i("i",{directives:[{name:"show",rawName:"v-show",value:t.taskData.startTime,expression:"taskData.startTime"}],staticClass:"el-icon-close head-btn__close",on:{click:function(e){t.deleteTime("startTime")}}})],1):"stopTime"===e.field?i("flexbox",{staticClass:"head-btn"},[t.taskData.stopTime?t._e():i("span",{staticClass:"head-btn__text"},[t._v("点击选择结束时间")]),t._v(" "),i("el-date-picker",{attrs:{clearable:!1,disabled:!t.getPermission("setTaskTime"),"picker-options":t.stopTimeOptions,type:"date","value-format":"yyyy-MM-dd"},on:{change:function(e){t.timeChange("stopTime")}},model:{value:t.taskData.stopTime,callback:function(e){t.$set(t.taskData,"stopTime",e)},expression:"taskData.stopTime"}}),t._v(" "),i("div",{staticClass:"head-btn__bd"},[t.taskData.stopTime?i("div",{staticClass:"head-btn__bd--title"},[t._v(t._s(t._f("moment")(t.taskData.stopTime,"YYYY年MM月DD日")))]):t._e()]),t._v(" "),i("i",{directives:[{name:"show",rawName:"v-show",value:t.taskData.stopTime,expression:"taskData.stopTime"}],staticClass:"el-icon-close head-btn__close",on:{click:function(e){t.deleteTime("stopTime")}}})],1):t._e()],1)})))])],1)]:t._e()],2):t._e()])},Ae=[],Fe=(a("a4d3"),a("e01a"),a("130f")),Ue=a("5e38"),Ne=a.n(Ue);function Ve(t){return Object(w["a"])({url:"workTask/archiveByTaskId/".concat(t),method:"post"})}function Pe(t){return Object(w["a"])({url:"work/work/activation/".concat(t),method:"post"})}function Ee(t){return Object(w["a"])({url:"workTaskComment/setComment",method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function Be(t){return Object(w["a"])({url:"workTaskComment/deleteComment",method:"post",data:t})}function Re(t){return Object(w["a"])({url:"workTaskComment/queryCommentList",method:"post",data:t})}function Me(t){return Object(w["a"])({url:"workTask/deleteTask/".concat(t),method:"post"})}function qe(t){return Object(w["a"])({url:"workTask/restore/".concat(t),method:"post"})}var We=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-popover",{ref:"popover",attrs:{placement:t.placement,width:t.popoverWidth,"popper-class":"no-padding-popover",trigger:"click"},model:{value:t.popoverVisible,callback:function(e){t.popoverVisible=e},expression:"popoverVisible"}},[t.popoverContentShow?a("div",[a("employee-department",t._b({ref:"employeeDepartment",on:{select:t.popoverSubmit}},"employee-department",t.$attrs,!1)),t._v(" "),a("div",{staticClass:"popover-footer"},[t.isRadio?t._e():a("el-button",{attrs:{type:"primary"},on:{click:t.popoverSubmit}},[t._v("确定")]),t._v(" "),a("el-button",{on:{click:function(e){t.popoverVisible=!1}}},[t._v("取消")])],1)],1):t._e(),t._v(" "),a("div",{style:{display:t.contentBlock?"block":"inline-block"},attrs:{slot:"reference"},on:{click:t.showContentClick},slot:"reference"},[t._t("membersDep")],2)])},He=[],Ye=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"employee-department"},[a("div",{staticClass:"select-input"},[t._t("tabs"),t._v(" "),a("wk-user-dep",{ref:"userDep",attrs:{radio:t.radio,"user-value":t.userDataValue,props:t.props,"dep-value":t.depDataValue,options:t.userList},on:{userChange:t.userChange,depChange:t.depChange}})],2),t._v(" "),!t.radio||t.showPreview?a("div",{staticClass:"checked-content"},[a("div",{staticClass:"checked-top"},[a("span",{staticClass:"select-info"},[t._v("已选择"),a("span",{staticClass:"select-info--num"},[t._v(t._s(t.userDataValue.length+t.depDataValue.length))]),t._v("项")]),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:t.clearAll}},[t._v("清空")])],1),t._v(" "),a("div",{staticClass:"select-content"},[a("flexbox",{attrs:{justify:"stretch",wrap:"wrap"}},[t._l(t.depObjArray,(function(e,i){return a("div",{key:"dep"+i,staticClass:"select-item text-one-line"},[t._v(t._s(t.$getDeptName(e))),a("i",{staticClass:"el-icon-close delete-icon",on:{click:function(a){t.selectDelete(e,"dep")}}})])})),t._v(" "),t._l(t.userObjArray,(function(e,i){return a("div",{key:"user"+i,staticClass:"select-item text-one-line"},[t._v(t._s(t.$getUserName(e))),a("i",{staticClass:"el-icon-close delete-icon",on:{click:function(a){t.selectDelete(e,"user")}}})])}))],2)],1)]):t._e()])},ze=[],Ge=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"xh-user"},[t.headerShow?a("div",{staticClass:"xh-user__hd"},[t._v("\n    "+t._s(t.title)+"\n  ")]):t._e(),t._v(" "),a("div",{staticClass:"xh-user__bd"},[a("el-autocomplete",{attrs:{disabled:t.disabled,"popper-append-to-body":!1,"fetch-suggestions":t.searchListUser,placeholder:"请输入内容"},on:{select:t.searchSelect},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.item;return[a("span",[t._v(t._s(t.$getUserName(i,t.userConfig.label)))]),t._v(" "),a("span",{staticStyle:{color:"#6b778c"}},[t._v(t._s("("+(t.$getDeptName(i)||"")+(t.$getDeptName(i)?"-":"")+(i.post||"无")+")"))])]}}]),model:{value:t.searchInput,callback:function(e){t.searchInput=e},expression:"searchInput"}}),t._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"search-list"},[t.breadcrumbList.length>0&&!t.config.isList?a("el-breadcrumb",{staticStyle:{padding:"5px 0"},attrs:{"separator-class":"el-icon-arrow-right"}},t._l(t.breadcrumbList,(function(e,i){return a("el-breadcrumb-item",{key:i},[a("a",{attrs:{href:"javascript:;"},on:{click:function(a){t.breadcrumbBtn(e,i)}}},[t._v(t._s(e.label))])])}))):t._e(),t._v(" "),t.currentBreadcrumbItem?a("div",{staticClass:"xh-user__list"},[t.radio?t._e():a("el-checkbox",{staticStyle:{"line-height":"30px"},attrs:{disabled:t.disabled},on:{change:t.handleCheckAllChange},model:{value:t.allChecked,callback:function(e){t.allChecked=e},expression:"allChecked"}},[t._v("全选")]),t._v(" "),a("wk-dep-checkbox",{ref:"depCheckbox",class:"is-select-"+t.config.selectType,attrs:{radio:t.radio,data:t.currentBreadcrumbItem.deptList,props:t.depConfig,disabled:t.disabled||"user"===t.config.selectType},on:{next:t.nextDebounceClick,change:t.depCheckboxChange,"all-select":t.depAllSelect},model:{value:t.depDataValue,callback:function(e){t.depDataValue=e},expression:"depDataValue"}}),t._v(" "),a("wk-user-checkbox",{ref:"userCheckbox",class:"is-select-"+t.config.selectType,attrs:{radio:t.radio,data:t.currentBreadcrumbItem.employeeList,props:t.userConfig,disabled:t.disabled||"dep"===t.config.selectType},on:{change:t.userCheckboxChange,"all-select":t.userAllSelect},model:{value:t.userDataValue,callback:function(e){t.userDataValue=e},expression:"userDataValue"}})],1):t._e()],1)],1),t._v(" "),t.config.showFooter?a("flexbox",{staticClass:"xh-user__ft"},[a("flexbox-item",{staticClass:"select-info"},[t._v("已选择"),a("span",{staticClass:"select-info--num"},[t._v(t._s((t.depDataValue.length||0)+(t.userDataValue.length||0)))]),t._v("项")]),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:t.clearAll}},[t._v("清空")]),t._v(" "),t.config.showSureBtn?a("el-button",{attrs:{type:"text"},on:{click:t.sureClick}},[t._v("确定")]):t._e()],1):t._e()],1)},Qe=[],Je=a("e17e"),Ke=a("7078"),Xe=a("7195"),Ze=a("5956"),ta=a("9608"),ea={value:"userId",label:"realname"},aa={value:"deptId",label:"name"},ia={request:null,params:null,searchParams:null,dataType:"manage",isList:!1,showFooter:!0,showSureBtn:!1,selectType:"all"},sa={name:"WkUserDep",components:{WkDepCheckbox:G["a"],WkUserCheckbox:Ze["a"]},inheritAttrs:!1,props:{headerShow:{type:Boolean,default:!0},options:Array,radio:Boolean,props:{type:Object,default:function(){return{}}},userProps:{type:Object,default:function(){return{}}},userValue:Array,depProps:{type:Object,default:function(){return{}}},depValue:Array,disabled:{type:Boolean,default:!1}},data:function(){return{loading:!1,searchInput:"",searchUserList:[],breadcrumbList:[],currentBreadcrumbItem:null,allChecked:!1,userAllChecked:!1,depAllChecked:!1,userDataValue:[],depDataValue:[]}},computed:{userConfig:function(){return Object(J["a"])(Object(n["a"])({},ea),this.userProps||{})},depConfig:function(){return Object(J["a"])(Object(n["a"])({},aa),this.depProps||{})},config:function(){return Object(J["a"])(Object(n["a"])({},ia),this.props||{})},title:function(){return{all:"员工/部门",user:"员工",dep:"部门"}[this.config.selectType]}},watch:{breadcrumbList:function(){this.config.isList||(this.currentBreadcrumbItem=this.breadcrumbList[this.breadcrumbList.length-1])},options:{handler:function(){this.config.isList&&(this.currentBreadcrumbItem={employeeList:this.options})},immediate:!0},userValue:{handler:function(){Object(nt["valueEquals"])(this.userValue,this.userDataValue)||(this.userDataValue=Object(rt["r"])(this.userValue))},immediate:!0},depValue:{handler:function(){Object(nt["valueEquals"])(this.depValue,this.depDataValue)||(this.depDataValue=Object(rt["r"])(this.depValue))},immediate:!0}},created:function(){this.config.isList?this.nextDebounceClick=function(){}:(this.getDepUserList(0),this.nextDebounceClick=Object(K["debounce"])(300,this.nextClick))},methods:{searchListUser:function(t,e){var a=this;if(this.searchUserList&&this.searchUserList.length||this.options){var i=this.options||this.searchUserList;e(t?i.filter((function(e){return Q["a"].match(e[a.userConfig.label]||"",t)||Q["a"].match(a.$getDeptName(e)||"",t)})):i)}else{var s=this.getSearchRequest(),r={pageType:0};this.config.searchParams&&(r=Object(n["a"])(Object(n["a"])({},r),this.config.searchParams)),s(r).then((function(i){var s=i.data;a.searchUserList=s.hasOwnProperty("list")?s.list||[]:s||[],e(t?a.searchUserList.filter((function(e){return Q["a"].match(e[a.userConfig.label]||"",t)})):a.searchUserList)})).catch((function(){}))}},getSearchRequest:function(){return this.props.isKpi?Xe["a"]:"hrm"===this.config.dataType?Ke["b"]:Object(ta["a"])(this.config.request)||z["n"]},searchSelect:function(t){this.$refs.userCheckbox.searchSelect(t)},depCheckboxChange:function(t){var e=this;"user"!==this.config.selectType&&(this.radio&&(this.userDataValue&&this.userDataValue.length>0&&(this.userDataValue=[],this.config.showSureBtn||this.$emit("update:userValue",[])),this.$emit("close")),this.config.showSureBtn||(this.$emit("update:depValue",t),this.$nextTick((function(){e.$emit("depChange",t),e.$emit("change",e.userDataValue,t,"dep")}))))},userCheckboxChange:function(t){var e=this;"dep"!==this.config.selectType&&(this.radio&&(this.depDataValue&&this.depDataValue.length>0&&(this.depDataValue=[],this.config.showSureBtn||this.$emit("update:depValue",[])),this.$emit("close")),this.config.showSureBtn||(this.$emit("update:userValue",t),this.$nextTick((function(){e.$emit("userChange",t),e.$emit("change",t,e.depDataValue,"user")}))))},handleCheckAllChange:function(t){this.$refs.userCheckbox&&this.$refs.userCheckbox.handleCheckAllChange(t),this.$refs.depCheckbox&&this.$refs.depCheckbox.handleCheckAllChange(t)},userAllSelect:function(t){this.userAllChecked=t,!this.depAllChecked&&this.currentBreadcrumbItem.deptList&&0!==this.currentBreadcrumbItem.deptList.length&&"user"!==this.config.selectType||!this.userAllChecked?this.allChecked=!1:this.allChecked=!0},depAllSelect:function(t){this.depAllChecked=t,!this.depAllChecked||!this.userAllChecked&&this.currentBreadcrumbItem.employeeList&&0!==this.currentBreadcrumbItem.employeeList.length&&"dep"!==this.config.selectType?this.allChecked=!1:this.allChecked=!0},clearAll:function(){this.config.showSureBtn?(this.depDataValue=[],this.userDataValue=[]):(this.$emit("update:depValue",[]),this.$emit("update:userValue",[]),this.$emit("depChange",[]),this.$emit("userChange",[]))},sureClick:function(){this.$emit("update:depValue",this.depDataValue),this.$emit("update:userValue",this.userDataValue),this.$emit("depChange",this.depDataValue),this.$emit("userChange",this.userDataValue),this.$emit("change",this.userDataValue,this.userDataValue),this.$emit("close")},getDepUserList:function(t,e){var a=this;this.loading=!0;var i=this.props.isKpi?Xe["b"]:"hrm"===this.config.dataType?Ke["a"]:this.config.request||Je["a"];i(t).then((function(i){var s=i.data||{},n=s.deptList||[],r=s.employeeList||s.userList||[];0==t?a.breadcrumbList=[{label:"全部",deptList:n,employeeList:r}]:a.breadcrumbList.push({label:e.name,deptList:n,employeeList:r}),a.loading=!1})).catch((function(){a.loading=!1}))},nextClick:function(t){this.getDepUserList(t.deptId,t)},breadcrumbBtn:function(t,e){e+1<=this.breadcrumbList.length-1&&this.breadcrumbList.splice(e+1,this.breadcrumbList.length-1)}}},na=sa,ra=(a("e274"),Object(m["a"])(na,Ge,Qe,!1,null,"2b15d6fc",null)),oa=ra.exports,la={name:"EmployeeDepartment",components:{WkUserDep:oa},props:{radio:{type:Boolean,default:!1},showPreview:{type:Boolean,default:!1},userCheckedData:{type:Array,default:function(){return[]}},depCheckedData:{type:Array,default:function(){return[]}},closeUser:{type:Boolean,default:!1},closeDep:{type:Boolean,default:!1},userRequest:Function,userParams:Object},data:function(){return{userList:[],depList:[],depDataValue:[],userDataValue:[]}},computed:{props:function(){var t="all";return this.closeUser?t="dep":this.closeDep&&(t="user"),{request:this.userRequest,params:this.userParams,isList:!!this.userRequest,selectType:t,showFooter:!1}},depObjArray:function(){var t=this;return this.depList.filter((function(e){return t.depDataValue.includes(e.deptId)}))},userObjArray:function(){var t=this;return this.userList.filter((function(e){return t.userDataValue.includes(e.userId)}))}},watch:{userCheckedData:{handler:function(){var t=this.userCheckedData.map((function(t){return t.userId}));Object(nt["valueEquals"])(t,this.userDataValue)||(this.userDataValue=t)},immediate:!0},depCheckedData:{handler:function(){var t=this.depCheckedData.map((function(t){return t.deptId}));Object(nt["valueEquals"])(t,this.depDataValue)||(this.depDataValue=t)},immediate:!0}},created:function(){this.initInfo()},methods:{initInfo:function(){this.closeUser||this.getUserList(),this.closeDep||this.getDepList()},getDepList:function(){var t=this;Object(z["e"])().then((function(e){t.depList=e.data})).catch((function(){}))},getUserList:function(){var t=this,e=z["n"],a={};this.userRequest?(e=this.userRequest,a=this.userParams||{}):a={pageType:0},e(a).then((function(e){t.userList=e.data.list||e.data})).catch((function(){}))},selectDelete:function(t,e){if("user"===e){var a=this.userDataValue.findIndex((function(e){return e==t.userId}));-1!==a&&this.userDataValue.splice(a,1)}else if("dep"===e){var i=this.depDataValue.findIndex((function(e){return e==t.deptId}));-1!==i&&this.depDataValue.splice(i,1)}},valueChange:function(){this.$emit("select",this.userObjArray,this.depObjArray)},clearAll:function(){this.userDataValue=[],this.depDataValue=[]},userChange:function(t){this.userDataValue=t,this.radio&&this.valueChange()},depChange:function(t){this.depDataValue=t,this.radio&&this.valueChange()}}},ca=la,da=(a("a074"),Object(m["a"])(ca,Ye,ze,!1,null,"0daec2c7",null)),ua=da.exports,ha={name:"MembersDep",components:{EmployeeDepartment:ua},inheritAttrs:!1,props:{contentBlock:{type:Boolean,default:!0},placement:{type:String,default:"bottom-start"}},data:function(){return{popoverVisible:!1,data:{},popoverContentShow:!1}},computed:{popoverWidth:function(){return this.isRadio?"300":"600"},isRadio:function(){return this.$attrs.radio||!1},employeeDepartment:function(){return this.$refs.employeeDepartment}},watch:{popoverVisible:function(t){this.$emit("show",t)}},methods:{popoverSubmit:function(){this.popoverVisible=!1,this.$emit("popoverSubmit",this.employeeDepartment.userObjArray,this.employeeDepartment.depObjArray)},showContentClick:function(){this.popoverContentShow||(this.popoverContentShow=!0)}}},pa=ha,ma=(a("ae7d"),Object(m["a"])(pa,We,He,!1,null,"24b155d0",null)),fa=ma.exports,ba=a("0f6f"),va=a("787c"),ga=a("88c0"),ka=a("5feb"),ya=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"comment-list"},t._l(t.list,(function(e,i){return a("div",{key:i,staticClass:"comment-list-item"},[a("div",{staticClass:"parent-reply reply"},[a("div",{staticClass:"user-info"},[a("xr-avatar",{staticClass:"user-img",attrs:{id:e.user.userId,name:t.$getUserName(e.user),size:32,src:t.$getUserImg(e.user),disabled:!1}}),t._v(" "),a("div",{staticClass:"user-info__bd"},[a("span",[t._v(t._s(t.$getUserName(e.user)))]),t._v(" "),a("span",{staticClass:"time"},[t._v("\n            "+t._s(t._f("formatTime")(e.createTime))+"\n          ")])])],1),t._v(" "),a("div",{staticClass:"content"},[t._v(t._s(e.content))]),t._v(" "),t.showControl?a("div",{staticClass:"control"},[a("el-button",{staticClass:"reply-btn",attrs:{type:"text"},on:{click:function(e){t.handleToReply(i)}}},[t._v("回复")]),t._v(" "),a("el-button",{staticClass:"delete-btn",attrs:{type:"text"},on:{click:function(a){t.handleToDelete(e,i)}}},[t._v("删除")])],1):t._e(),t._v(" "),t.replyIndex===String(i)?a("reply-comment",{on:{reply:t.handleReply,close:function(e){t.replyIndex=null}}}):t._e()],1),t._v(" "),e.childCommentList&&e.childCommentList.length>0?t._l(e.childCommentList,(function(e,s){return a("div",{key:s,staticClass:"child-reply-list"},[a("div",{staticClass:"child-reply reply"},[a("div",{staticClass:"user-info"},[a("xr-avatar",{staticClass:"user-img",attrs:{id:e.user.userId,name:t.$getUserName(e.user),size:34,src:t.$getUserImg(e.user),disabled:!1}}),t._v(" "),a("div",{staticClass:"user-info__bd"},[a("span",[t._v("\n                "+t._s(t.$getUserName(e.user))+"\n              ")]),t._v(" "),a("span",{staticClass:"time"},[t._v("\n                "+t._s(e.createTime)+"\n              ")])])],1),t._v(" "),a("div",{staticClass:"child-content"},[a("span",[t._v("\n              回复 @"+t._s(t.$getUserName(e.replyUser))+"：\n            ")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(e.content))])]),t._v(" "),t.showControl?a("div",{staticClass:"control"},[a("el-button",{staticClass:"reply-btn",attrs:{type:"text"},on:{click:function(e){t.handleToReply(i,s)}}},[t._v("回复")]),t._v(" "),a("el-button",{staticClass:"delete-btn",attrs:{type:"text"},on:{click:function(a){t.handleToDelete(e,i,s)}}},[t._v("删除")])],1):t._e(),t._v(" "),t.replyIndex===i+"-"+s?a("reply-comment",{directives:[{name:"loading",rawName:"v-loading",value:t.commentLoading,expression:"commentLoading"}],on:{reply:t.handleReply,close:function(e){t.replyIndex=null}}}):t._e()],1)])})):t._e()],2)})))},Ca=[],wa=a("74fc"),Ta={addRequest:null,addParams:null,replyKey:"pid",replyValueKey:"userId",deleteRequest:null,deleteParams:null},_a={name:"CommentList",components:{ReplyComment:wa["a"]},filters:{formatTime:function(t){return Object(rt["g"])(t)}},props:{props:{type:Object,default:function(){return{}}},list:{type:Array,required:!0},showControl:{type:Boolean,default:!0}},data:function(){return{replyIndex:null,commentLoading:!1}},computed:Object(n["a"])(Object(n["a"])({},Object(ot["b"])(["userInfo"])),{},{config:function(){return Object(J["a"])(Object(n["a"])({},Ta),this.props||{})}}),methods:{handleToReply:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a="".concat(t).concat(null!==e?"-"+e:"");this.$emit("close-other-reply"),a!==this.replyIndex&&(this.replyIndex=a)},closeReply:function(){this.replyIndex=null},handleReply:function(t){var e=this,a={content:Ne()(t)},i=null,s=this.replyIndex.split("-"),r=this.list[s[0]];s[1]&&(i=r.childCommentList[s[1]]),r&&(a.mainId=r.commentId,a[this.config.replyKey]=this.getReplyValue(r,this.config.replyValueKey)),i&&(a[this.config.replyKey]=this.getReplyValue(i,this.config.replyValueKey)),this.commentLoading=!0,this.config.addRequest(Object(n["a"])(Object(n["a"])({},a),this.config.addParams||{})).then((function(t){t.data.user={userId:e.userInfo.userId,realname:e.$getUserName(e.userInfo),img:e.$getUserImg(e.userInfo)},t.data.replyUser=i?i.user:r.user,e.list[s[0]].childCommentList.push(t.data),e.replyIndex=null,e.commentLoading=!1})).catch((function(){e.commentLoading=!1}))},getReplyValue:function(t,e){if(e.indexOf(".")<0)return t[e];for(var a=e.split("."),i=t,s=0;s<a.length;s++)if(i=i[a[s]],void 0===i)return"";return i},handleToDelete:function(t,e){var a=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.config.deleteRequest(Object(n["a"])({commentId:t.commentId},a.config.deleteParams||{})).then((function(t){a.$message({type:"success",message:"删除成功!"}),i>=0?a.list[e].childCommentList.splice(i,1):a.$emit("delete",e)}))})).catch((function(){a.$message({type:"info",message:"已取消删除"})}))}}},xa=_a,Ia=(a("150b"),Object(m["a"])(xa,ya,Ca,!1,null,"2f4d0a05",null)),Da=Ia.exports,ja={name:"TaskDetail",components:{SlideView:Fe["a"],MembersDep:fa,TagIndex:ne,SubTask:ue,FileCell:he["a"],WkUserSelect:C["a"],CommentList:Da,ReplyComment:wa["a"],WkHeadSection:ba["a"],WkSectionItem:va["a"],WkEditWrap:ga["a"],TagView:ka["a"]},mixins:[fe],props:{id:[String,Number],isTrash:{type:Boolean,default:!1},detailIndex:Number,detailSection:Number,noListenerClass:{type:Array,default:function(){return["el-table__body"]}}},data:function(){var t=this;return{loading:null,canShowDetail:!0,ownerUserUnfold:!1,detailList:[{label:"优先级",formType:"priority",field:"priority"},{label:"负责人",formType:"user",field:"mainUser"},{label:"开始时间",formType:"date",field:"startTime"},{label:"结束时间",formType:"date",field:"stopTime"}],priorityVisible:!1,startTimeOptions:{disabledDate:function(e){return!(!t.taskData||!t.taskData.stopTime)&&we()(e).isAfter(t.taskData.stopTime)}},stopTimeOptions:{disabledDate:function(e){return!(!t.taskData||!t.taskData.startTime)&&we()(e).isBefore(t.taskData.startTime)}},addSubtasks:!0,nameVinput:!1,taskDataName:"",addDescriptionShow:!1,addDescriptionTextarea:"",subTaskDoneNum:0,addComments:!1,commentsLoading:!1,subTaskID:null,taskData:null,activityList:[],fileList:[],replyList:[],tabValue:"comment",tabs:[{label:"评论",value:"comment"},{label:"活动",value:"activity"}]}},computed:Object(n["a"])(Object(n["a"])({},Object(ot["b"])(["userInfo"])),{},{priority:function(){return 0!=this.taskData.priority&&this.taskData.priority?this.getPriorityColor(this.taskData.priority):this.priorityList[3]},ownerUserShowList:function(){var t=this.taskData.ownerUserList||[];return t.length>0?t.slice(0,5):t},ownerUserHideList:function(){var t=this.taskData.ownerUserList||[];return t.length>0?t.slice(5):t},isDisabled:function(){return this.isTrash},isArchive:function(){return 1==this.taskData.isArchive&&1!=this.taskData.ishidden},isRecycle:function(){return 1==this.taskData.ishidden},showArchiveBtn:function(){return this.workId&&!this.isArchive&&!this.isRecycle},subTaskProgress:function(){return 0==this.subTaskDoneNum?0:parseInt(this.subTaskDoneNum/this.taskData.childTask.length*100)},ownerListRequest:function(){return this.workId?g["e"]:null},ownerListParams:function(){return this.workId?{workId:this.workId}:null},workId:function(){return this.taskData&&this.taskData.workId&&0!=this.taskData.workId?this.taskData.workId:""},labelList:function(){return this.taskData?this.taskData.labelList||[]:null},tagLabelList:function(){return(this.labelList||[]).map((function(t){return{name:t.labelName,value:t.color?t.color:"#ccc"}}))},commentListProps:function(){return{addRequest:Ee,addParams:{typeId:this.taskData?this.taskData.taskId:"",type:"1"},replyKey:"pid",replyValueKey:"userId",deleteRequest:Be,deleteParams:null}}}),watch:{id:function(t){this.initInfo(),this.getDetail(),this.getCommentList(),this.getActivityList()},labelList:function(t,e){e&&t&&this.$emit("on-handle",{type:"change-label",value:t,index:this.detailIndex,section:this.detailSection})},addDescriptionTextarea:function(t){this.$refs.sideView.isEditClose=!!(t&&t.length>0)}},mounted:function(){},beforeDestroy:function(){},methods:{viewAfterEnter:function(){this.id&&(this.getDetail(),this.getCommentList(),this.getActivityList())},initInfo:function(){this.taskData=null,this.subTaskDoneNum=0,this.addDescriptionShow=!1,this.priorityVisible=!1,this.addSubtasks=!0,this.nameVinput=!1,this.addDescriptionTextarea="",this.addComments=!1,this.activityList=[],this.fileList=[],this.replyList=[]},getDetail:function(){var t=this;this.loading=!0;var e=this.isTrash?x:_;e({taskId:this.id}).then((function(e){var a=e.data||{};if(a.startTime&&(a.startTime=a.startTime.split(" ")[0]),a.stopTime&&(a.stopTime=a.stopTime.split(" ")[0]),a.checked=5==a.status,a.childTask){var i,s=Object(r["a"])(a.childTask);try{for(s.s();!(i=s.n()).done;){var n=i.value;5==n.status?(n.checked=!0,t.subTaskDoneNum++):n.checked=!1}}catch(o){s.e(o)}finally{s.f()}}t.fileList=a.file||[],t.taskData=a,t.loading=!1})).catch((function(e){t.loading=!1,e&&3007==e.code?t.canShowDetail=!1:t.closeBtn()}))},getActivityList:function(){var t=this;I({taskId:this.id}).then((function(e){t.activityList=e.data})).catch((function(){}))},getCommentList:function(){var t=this;Re({typeId:this.id,type:1}).then((function(e){t.replyList=e.data})).catch((function(){}))},completeMainTask:function(){var t=this,e=!this.taskData.checked;this.taskData.checked=e,Object(o["nb"])({taskId:this.id,status:this.taskData.checked?5:1}).then((function(a){t.$emit("on-handle",{type:"title-check",value:e,index:t.detailIndex,section:t.detailSection})})).catch((function(){t.taskData.checked=!t.taskData.checked}))},editTaskName:function(){this.getPermission("setTaskTitle")&&(this.nameVinput=!0,this.taskDataName=this.taskData.name)},editTaskDescription:function(){this.getPermission("setTaskDescription")&&(this.addDescriptionShow=!0,this.addDescriptionTextarea=this.taskData.description)},getPermission:function(t){if(!this.workId)return!0;var e=this.taskData&&this.taskData.authList&&this.taskData.authList.project||{},a=!!e[t];return this.isDisabled?["restoreTask","cleanTask"].includes(t)&&a:a},closeBtn:function(){this.$emit("close")},priorityBtn:function(t,e){var a=this;this.taskData.priority=t.id,Object(o["mb"])({taskId:this.id,priority:t.id}).then((function(e){a.$emit("on-handle",{type:"change-priority",value:t,index:a.detailIndex,section:a.detailSection}),a.priorityVisible=!1})).catch((function(){a.$message.error("编辑失败"),a.taskData.priority=e}))},moreDelete:function(){var t=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"is-particulars"}).then((function(){Object(o["gb"])(t.id).then((function(e){t.$message.success("删除成功"),t.$emit("on-handle",{type:"delete",index:t.detailIndex,section:t.detailSection}),t.$emit("close")})).catch((function(){}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},moreArchive:function(){var t=this;this.$confirm("此操作将归档该任务, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"is-particulars"}).then((function(){Ve(t.id).then((function(e){t.$message.success("操作成功"),t.$emit("on-handle",{type:"delete",index:t.detailIndex,section:t.detailSection}),t.$emit("close")})).catch((function(){}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},httpRequest:function(t){var e=this;this.$wkUploadFile.upload({file:t.file,params:{batchId:this.taskData.batchId}}).then((function(t){t.res;e.getDetail(),e.$message.success("上传成功")})).catch((function(){}))},accessoryDeleteFun:function(t,e){this.fileList.splice(t,1)},subtasksCheckbox:function(t,e){var a=this;e?(this.$set(t,"checked",!0),this.subTaskDoneNum++):(this.$set(t,"checked",!1),this.subTaskDoneNum--),Object(o["fb"])({taskId:t.taskId,status:e?5:1}).then((function(t){a.$emit("on-handle",{type:"change-sub-task",value:{subdonecount:a.subTaskDoneNum,allcount:a.taskData.childTask.length},index:a.detailIndex,section:a.detailSection})})).catch((function(){a.$message.error("子任务标记失败"),e?(a.$set(t,"checked",!1),a.subTaskDoneNum--):(a.$set(t,"checked",!0),a.subTaskDoneNum++)}))},editOwnerList:function(t,e){var a=this;Object(o["lb"])({taskId:this.id,ownerUserId:t.map((function(t){return t.userId})).join(",")}).then((function(e){a.taskData.ownerUserList=t})).catch((function(){}))},deleteOwnerList:function(t,e){var a=this;Object(o["kb"])({taskId:this.id,userId:t.userId}).then((function(t){a.taskData.ownerUserList.splice(e,1)})).catch((function(){}))},mainUserChange:function(t,e){var a=e.length>0?e[0]:null;this.submiteMainUser(a)},submiteMainUser:function(t){var e=this;Object(o["jb"])({taskId:this.id,userId:t?t.userId:""}).then((function(a){t?e.$set(e.taskData,"mainUser",t):e.$set(e.taskData,"mainUser",null),e.$emit("on-handle",{type:"change-main-user",value:t,index:e.detailIndex,section:e.detailSection})})).catch((function(){}))},submiteTaskName:function(t){var e=this;Object(o["pb"])({name:t,taskId:this.id}).then((function(a){e.nameVinput=!1,e.$emit("on-handle",{type:"change-name",value:t,index:e.detailIndex,section:e.detailSection}),e.taskData.name=t})).catch((function(){}))},deleteTime:function(t){this.taskData[t]="",this.timeChange(t)},timeChange:function(t){var e=this,a={taskId:this.id,startTime:this.taskData.startTime||"",stopTime:this.taskData.stopTime||""};a[t]=this.taskData[t]||"",a.startTime||a.stopTime?Object(o["ob"])(a).then((function(a){"stopTime"==t&&e.$emit("on-handle",{type:"change-stop-time",value:e.taskData[t],index:e.detailIndex,section:e.detailSection})})).catch((function(){})):this.$message.error("开始和结束时间必须至少有一个不能为空")},submiteDescription:function(){var t=this;Object(o["hb"])({taskId:this.id,description:this.addDescriptionTextarea}).then((function(e){t.addDescriptionShow=!1,t.$set(t.taskData,"description",t.addDescriptionTextarea),t.addDescriptionTextarea=""})).catch((function(){}))},handleReply:function(t){var e=this;t&&(this.commentsLoading=!0,Ee(Object(n["a"])({content:Ne()(t)},this.commentListProps.addParams)).then((function(t){t.data.childCommentList=[],t.data.user={userId:e.userInfo.id,realname:e.userInfo.realname,img:e.userInfo.img},e.$refs.f_reply.commentsTextarea="",e.replyList.push(t.data),e.$emit("on-handle",{type:"change-comments",value:"add",index:e.detailIndex,section:e.detailSection}),e.commentsLoading=!1})).catch((function(){e.commentsLoading=!1})))},deleteComment:function(t){this.replyList.splice(t,1)},discussDelete:function(t,e,a){var i=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"is-particulars"}).then((function(){Be({commentId:t.commentId}).then((function(t){e.splice(a,1),i.$emit("on-handle",{type:"change-comments",value:"delete",index:i.detailIndex,section:i.detailSection})})).catch((function(){}))})).catch((function(){i.$message({type:"info",message:"已取消删除"})}))},deleteSubTask:function(t){var e=this;this.$confirm("此操作将删除该任务, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"is-particulars"}).then((function(){Object(o["db"])(t.taskId).then((function(a){var i=e.taskData.childTask;for(var s in i)if(i[s].taskId==t.taskId){i.splice(s,1);break}t.checked&&e.subTaskDoneNum--,e.$emit("on-handle",{type:"change-sub-task",value:{subdonecount:e.subTaskDoneNum,allcount:e.taskData.childTask.length},index:e.detailIndex,section:e.detailSection}),e.$message.success("子任务删除成功")})).catch((function(){e.$message.error("子任务删除失败")}))})).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},editSubTask:function(t){this.subTaskID=t.taskId;var e=this.taskData.childTask;for(var a in e)e[a].taskId==t.taskId?this.$set(e[a],"showEdit",!0):this.$set(e[a],"showEdit",!1)},handleSubTasksBlock:function(t,e){"edit"==t.type?this.$set(e,"showEdit",!1):"add"==t.type?(this.addSubtasks=!0,t.result,this.$emit("on-handle",{type:"change-sub-task",value:{subdonecount:this.subTaskDoneNum,allcount:this.taskData.childTask.length},index:this.detailIndex,section:this.detailSection})):"cancel"==t.type&&(e?this.$set(e,"showEdit",!1):this.addSubtasks=!0)},deleteTimeTop:function(){var t=this;Object(o["ob"])({taskId:this.id,stopTime:""}).then((function(e){t.$set(t.taskData,"stopTime",""),t.$emit("on-handle",{type:"stop-time",index:t.detailIndex,section:t.detailSection})})).catch((function(){}))},activateTask:function(){var t=this;this.loading=!0,Pe(this.taskData.taskId).then((function(e){t.loading=!1,t.$emit("on-handle",{type:"activate-task",index:t.detailIndex,section:t.detailSection}),t.closeBtn()})).catch((function(){t.loading=!1}))},recoverTask:function(){var t=this;this.loading=!0,qe(this.taskData.taskId).then((function(e){t.loading=!1,t.$message.success("恢复成功"),t.$emit("on-handle",{type:"recover-task",index:t.detailIndex,section:t.detailSection}),t.closeBtn()})).catch((function(){t.loading=!1}))},thoroughDeleteTask:function(){var t=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0,Me(t.taskData.taskId).then((function(e){t.loading=!1,t.$emit("on-handle",{type:"thorough-delete-task",index:t.detailIndex,section:t.detailSection}),t.closeBtn()})).catch((function(){t.loading=!1}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},morkDropdownClick:function(t){this.moreDelete()},hideView:function(){this.$emit("close"),this.$emit("hide-view")},closeOtherReply:function(t){!t&&this.$refs.comment_list&&this.$refs.comment_list.closeReply()},handleSubTask:function(t){"update"===t.type?this.editSubTask(t.data):"delete"===t.type&&this.deleteSubTask(t.data)}}},La=ja,Sa=(a("3b70"),Object(m["a"])(La,$e,Ae,!1,null,"6fb70618",null)),Oa=Sa.exports,$a={components:{TaskQuickAdd:Oe,TaskDetail:Oa,TaskCreate:Ie},directives:{},mixins:[fe],props:{workId:[String,Number],permission:{type:Object,default:function(){return{}}},conditionData:{type:Object,default:function(){return{userIds:[],timeId:[],tagIds:[]}}}},data:function(){return{loading:!1,createTaskListShow:!1,createSubTaskClassId:"hidden",taskListName:"",editTaskListName:"",taskList:[],taskID:"",detailIndex:-1,detailSection:-1,taskDetailShow:!1,taskCreateShow:!1,createAction:{type:"save"}}},computed:{showMoreBtn:function(){return this.permission.updateTaskClass&&this.isBoardShow||this.permission.saveTask||this.permission.archiveTask||this.permission.deleteTaskClass&&this.isBoardShow},orderTaskClassDisabled:function(){return!1},orderTaskDisabled:function(){return!1},tableNameField:function(){return{board:"boardName",user:"realname"}[this.showType||"board"]},tableField:function(){return{board:"projectBoardId",user:"userId"}[this.showType||"board"]},isBoardShow:function(){return"board"==this.showType}},watch:{workId:function(){},conditionData:function(){this.getList()}},created:function(){var t=this;this.debouncedCheckboxChange=Object(K["throttle"])(500,(function(e,a,i){t.checkboxChange(e,a,i)})),this.getList(),this.$bus.$on("work-task-import",(function(e,a,i){t.getList()}))},mounted:function(){document.getElementById("project-container").addEventListener("click",this.taskShowHandle,!1)},beforeDestroy:function(){this.$bus.$off("work-task-import")},methods:{getList:function(){var t={workId:this.workId};this.conditionData&&(t.mainUserId=this.conditionData.userIds,t.stopTimeType=this.conditionData.timeId,t.labelId=this.conditionData.tagIds,t.taskName=this.conditionData.search)},getListRest:function(){},moveEndParentTask:function(t){document.dispatchEvent(new MouseEvent("mouseup")),t&&t.oldIndex!=t.newIndex&&Object(g["c"])({workId:this.workId,classIds:this.taskList.map((function(t){return t.classId}))}).then((function(t){})).catch((function(){}))},moveParentTask:function(t){if(0==t.draggedContext.futureIndex&&-1==this.taskList[0].classId)return!1},moveEndSonTask:function(t){if(document.dispatchEvent(new MouseEvent("mouseup")),t){var e=t.from.id,a=t.to.id;if(e==a&&t.oldIndex==t.newIndex)return;var i=this.taskList.filter((function(t){return t.classId==e}))[0],s=i.list;this.updateTaskListCheckNum(i);var n=this.taskList.filter((function(t){return t.classId==a}))[0],r=n.list;this.updateTaskListCheckNum(n);var o={};o=e==a?{toList:r.map((function(t){return t.taskId})),toId:a}:{fromList:s.map((function(t){return t.taskId})),fromId:e,toList:r.map((function(t){return t.taskId})),toId:a},Object(g["d"])(o).then((function(t){})).catch((function(){}))}},updateTaskListCheckNum:function(t){t.checkedNum=t.list.filter((function(t){return t.checked})).length},changeListCompleteOrder:function(t,e,a){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=null;if(t.checked){var n=e.list[a];n.taskId!=t.taskId&&(a=null);for(var r=e.list.length-1;r>=0;r--){var o=e.list[r];if(null===a&&t.taskId==o.taskId&&(a=r),o.checked||(s=r),null!==a&&null!==s)break}s<a&&(s=null)}else{var l=e.list[a];l.taskId!=t.taskId&&(a=null);for(var c=e.list.length-1;c>=0;c--){var d=e.list[c];if(null===a&&t.taskId==d.taskId&&(a=c),null!==a)break}s=0}null!=s&&s>=0&&s!=a&&(e.list.splice(a,1),e.list.splice(s,0,t),i&&Object(g["d"])({toList:e.list.map((function(t){return t.taskId})),toId:e.classId}).then((function(t){})).catch((function(){})))},delectTaskListClick:function(t,e){var a=this;this.$confirm("您确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.taskList.splice(e,1)})).catch((function(){a.$message({type:"info",message:"已取消删除"})}))},renameTaskListClick:function(t,e){var a=this;this.editTaskListName=t[this.tableNameField],t.taskHandleShow=!1,t.renameShow=!0,this.$nextTick((function(){a.$refs.text[0].focus()}))},renameTaskListSubmit:function(t,e){this.taskList[e][this.tableNameField]=this.editTaskListName,t.renameShow=!1,this.editTaskListName=""},createTaskListSave:function(t){this.taskList.push({boardName:t||"未命名列",eventId:this.eventId,statusList:[],sorting:this.taskList.length}),this.createTaskListShow=!1,this.taskListName=""},addSubTaskSuc:function(){this.createSubTaskClassId="hidden",this.getList()},createSubTaskClick:function(t){this.createAction={type:"save",params:{workId:this.workId,classId:t.classId}},this.taskCreateShow=!0},showDetailView:function(t,e,a){this.taskID=t.taskId,this.detailIndex=a,this.detailSection=e,this.taskDetailShow=!0},detailHandle:function(t){if(0==t.index||t.index)if("title-check"==t.type){var e=this.taskList[t.section];this.$set(e.list[t.index],"checked",t.value),t.value?e.checkedNum++:e.checkedNum--,this.$set(e,"checkedNum",e.checkedNum)}else if("delete"==t.type)this.taskList[t.section].list.splice(t.index,1);else if("change-stop-time"==t.type){var a=new Date(t.value).getTime()/1e3+86399;a>(new Date).getTime()/1e3?this.taskList[t.section].list[t.index].isEnd=!1:this.taskList[t.section].list[t.index].isEnd=!0,this.taskList[t.section].list[t.index].stopTime=t.value}else if("change-priority"==t.type)this.taskList[t.section].list[t.index].priority=t.value.id;else if("change-name"==t.type)this.taskList[t.section].list[t.index].name=t.value;else if("change-comments"==t.type){var i=this.taskList[t.section].list[t.index].commentCount;"add"==t.value?this.taskList[t.section].list[t.index].commentCount=i+1:this.taskList[t.section].list[t.index].commentCount=i-1}else"change-sub-task"==t.type?(this.taskList[t.section].list[t.index].childWCCount=t.value.subdonecount,this.taskList[t.section].list[t.index].childAllCount=t.value.allcount):"change-main-user"==t.type?this.taskList[t.section].list[t.index].mainUser=t.value:"change-label"==t.type&&(this.taskList[t.section].list[t.index].labelList=t.value)},closeBtn:function(){this.taskDetailShow=!1},taskShowHandle:function(t){if(this.$refs.particulars&&!this.$refs.particulars.$el.contains(t.target)){for(var e=!0,a=document.getElementsByClassName("board-item"),i=0;i<a.length;i++){var s=a[i];if(s.contains(t.target)){e=!1;break}}this.taskDetailShow=!e}}}},Aa={name:"BoardList",components:{DraggableItem:b,ItemDetail:v["default"]},mixins:[$a],inject:["rootTabs"],props:{itemType:String,list:{type:Array,default:function(){return[]}},search:String,iterationId:String},data:function(){return{loading:!1,taskList:[],draging:!1,taskId:"",detailIndex:-1,taskDetailShow:!1,filterList:[],cacheClickedInfo:new Map}},watch:{"rootTabs.currentName":function(t){t===this.itemType&&this.firstLoad()}},mounted:function(){this.firstLoad()},methods:{firstLoad:function(){this.clearCache(),this.clearFilterCondition(),this.getData()},clearCache:function(){this.cacheClickedInfo.clear()},clearFilterCondition:function(){this.filterList=[]},getFilterParams:function(){var t,e={},a=Object(r["a"])(this.filterList);try{for(a.s();!(t=a.n()).done;){var i,s=t.value,n=[],o=Object(r["a"])(s.list);try{for(o.s();!(i=o.n()).done;){var l=i.value;l.checked&&n.push(l.id)}}catch(c){o.e(c)}finally{o.f()}e[s.field]=n}}catch(c){a.e(c)}finally{a.f()}return e},getData:function(t,e){var a=this;this.loading=!0,e&&this.clearFilterCondition(),t&&t.length&&(this.filterList=t||[]);var i=Object(n["a"])({projectId:this.$route.params.id,taskType:u["e"][this.itemType],search:this.search},this.getFilterParams());this.iterationId&&(i.belongIterationId=this.iterationId,i.type=u["e"][this.itemType]);var s=this.iterationId?o["B"]:o["y"];s(i).then((function(t){var e=t.data;e.forEach((function(t){var e=[];t.statusList.forEach((function(t){(t.taskVOList||[]).forEach((function(t){t.statusName=t.boardStatusName,t.clicked=!1,e.push(t)}))})),t.children=e})),a.taskList=e,a.loading=!1})).catch((function(){a.loading=!1}))},dragstart:function(t,e){this.draging=!0,t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("dadaItem",JSON.stringify(e))},dragend:function(){this.draging=!1,this.clearCache()},targetDragDrop:function(t,e){var a=JSON.parse(t.dataTransfer.getData("dadaItem"));return this.setTaskStatus({statusId:e.statusId,taskId:a.taskId}),!1},setTaskStatus:function(t){var e=this;this.loading=!0,Object(o["r"])(t).then((function(t){e.$message.success("操作成功"),e.getData()})).catch((function(){e.loading=!1}))},targetDragenter:function(t,e){this.$set(e,"hover",!0)},targetDragleave:function(t,e){this.$set(e,"hover",!1)},targetDragover:function(t){t.preventDefault()},handleUpdateList:function(){this.getData()},enterDetail:function(t,e,a,i){if(this.cacheClickedInfo.has(a)){var s=this.cacheClickedInfo.get(a);e[s].clicked=!1}this.cacheClickedInfo.set(a,i),t.clicked=!0,this.taskId=t.taskId,this.detailIndex=this.getObjIndex(e,"taskId",t.taskId),this.taskDetailShow=!0},getObjIndex:function(t,e,a){for(var i=0;i<t.length;i++){var s=t[i];if(s[e]===a)return i}return null}}},Fa=Aa,Ua=(a("7ba3"),Object(m["a"])(Fa,i,s,!1,null,"7bdf7ec4",null));e["a"]=Ua.exports},cdfe:function(t,e,a){},ce25:function(t,e,a){},ce63:function(t,e,a){},d099:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"pm-project"},["main"==t.defaultVal?a("div",[a("flexbox",{staticClass:"crm-workbench__hd"},[a("div",{staticClass:"title"},[t._v("项目概况")])]),t._v(" "),t.projectDetail?a("div",{staticClass:"project__body"},[a("flexbox",{staticClass:"section",attrs:{align:"stretch"}},[a("draggable",{staticClass:"left",attrs:{group:{name:"sort"},options:{forceFallback:!1,handle:".filter-handle"}},model:{value:t.sortLeft,callback:function(e){t.sortLeft=e},expression:"sortLeft"}},[t._l(t.sortLeft,(function(e,i){return[1===e.isHidden?a("div",{key:i,staticStyle:{display:"none"}}):a(e.component,{key:i,tag:"component",staticClass:"left-content component-item",attrs:{detail:t.projectDetail}})]}))],2),t._v(" "),a("draggable",{staticClass:"right",attrs:{group:{name:"sort"},options:{forceFallback:!1,handle:".filter-handle"}},model:{value:t.sortRight,callback:function(e){t.sortRight=e},expression:"sortRight"}},[t._l(t.sortRight,(function(e,i){return[1===e.isHidden?a("div",{key:i,staticStyle:{display:"none"}}):a(e.component,{key:i,tag:"component",staticClass:"right-content component-item",attrs:{detail:t.projectDetail},on:{change:t.getChangeInfo}})]}))],2)],1)],1):t._e()],1):t.defaultVal?a("iteration-detail",{attrs:{"iteration-id":t.iterationDetail.taskId},on:{change:t.getChangeInfo}}):t._e()],1)},s=[],n=a("5530"),r=(a("ac1f"),a("5319"),a("a535")),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("project-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[a("template",{slot:"title-left"},[t._v("项目公告")]),t._v(" "),t.editNoticeAuth?a("el-button",{staticStyle:{"font-size":"14px"},attrs:{slot:"title-right",type:"primary-text",icon:"el-icon-plus"},on:{click:t.createNotice},slot:"title-right"},[t._v("\n    新建公告\n  ")]):t._e(),t._v(" "),a("div",{directives:[{name:"empty",rawName:"v-empty",value:!t.listData.length,expression:"!listData.length"}],staticClass:"content rc-cont"},[t.listData.length?a("div",{staticClass:"content_body"},[a("div",{staticClass:"body_top"},[a("div",{staticClass:"header"},[a("xr-avatar",{attrs:{id:t.listData[0].createUserId,src:t.listData[0].createUserImg,name:t.listData[0].createUser,size:32}}),t._v(" "),a("div",{staticClass:"name"},[a("h2",[t._v(t._s(t.listData[0].createUser))]),t._v(" "),a("p",[t._v("发布与"+t._s(t.listData[0].createTime))])])],1),t._v(" "),t.editInputShow?t.editInputShow?a("el-input",{ref:"edit",staticClass:"body-bottom",attrs:{type:"textarea",rows:8},on:{blur:function(e){t.editNotice("hidden")}},model:{value:t.inputEditText,callback:function(e){t.inputEditText=e},expression:"inputEditText"}}):t._e():a("div",{staticClass:"body-bottom",on:{click:function(e){t.editNoticeAuth&&t.editNotice("show")}}},[t._v("\n          "+t._s(t.listData[0].content)+"\n        ")])],1),t._v(" "),t.$auth("projectAnnouncement","PM")?a("el-button",{staticStyle:{"font-size":"14px"},attrs:{type:"primary-text"},on:{click:t.checkNotice}},[t._v("\n        查看全部公告\n      ")]):t._e()],1):t._e()]),t._v(" "),t.createVisible?a("create-notice-dialog",{attrs:{visible:t.createVisible,"project-id":t.projectId},on:{onSubmit:t.getData,close:function(e){t.createVisible=!1}}}):t._e()],2)},l=[],c=(a("14d9"),a("dc1b")),d=a("9346"),u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"project-card card",class:[{"is-close":!t.isUnfold}]},[a("flexbox",{staticClass:"card-title"},[a("div",{staticClass:"card-title-center text-one-ellipsis"},[t._t("title-left")],2),t._v(" "),a("div",{staticClass:"card-title-right"},[t._t("title-right")],2)]),t._v(" "),t.isUnfold?[a("flexbox",{staticClass:"filter-bar"},[t.workbench?a("flexbox",{staticClass:"left"},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.workbench.avatarData.realname,placement:"top"}},[a("span",{staticClass:"filter-tag text-one-line",staticStyle:{"max-width":"200px"}},[t._v(t._s(t.workbench.avatarData.realname))])]),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.fixedToday?"今天":t.workbench.$refs.timeTypeSelect.typeShowValue,placement:"top"}},[a("span",{staticClass:"filter-tag text-one-line",staticStyle:{"max-width":"80px"}},[t._v(t._s(t.fixedToday?"今天":t.workbench.$refs.timeTypeSelect.typeShowValue))])]),t._v(" "),t._t("filter-left")],2):t._e(),t._v(" "),a("div",{staticClass:"right"},[t._t("filter-right")],2)],1),t._v(" "),t._t("default")]:t._e()],2)},h=[],p={name:"ProjectCard",components:{},inject:{workbench:{default:""}},props:{icon:String,move:{type:Boolean,default:!0},fixedToday:{type:String,default:""}},data:function(){return{isUnfold:!0}},computed:{},watch:{},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{handleUpdateUnfold:function(){this.isUnfold=!this.isUnfold,this.$emit("unfold-change",this.isUnfold)}}},m=p,f=(a("7e33"),a("2877")),b=Object(f["a"])(m,u,h,!1,null,"91d3b3de",null),v=b.exports,g={components:{ProjectCard:v}},k=a("ed08"),y={name:"Announcement",components:{createNoticeDialog:d["a"]},mixins:[g],props:{},data:function(){return{loading:!1,list:!1,listData:[],createVisible:!1,editInputShow:!1,inputEditText:""}},computed:{projectId:function(){return this.$route.params.id},editNoticeAuth:function(){return this.$auth("projectAnnouncement.editAnnouncement","PM")}},watch:{editInputShow:{handler:function(t){var e=this;t&&this.$nextTick((function(){e.inputEditText=Object(k["r"])(e.listData[0].content)||"",e.$refs.edit.focus()}))}}},created:function(){this.getData()},methods:{getData:function(){var t=this;this.loading=!0,Object(c["c"])({projectId:this.projectId}).then((function(e){t.listData=e.data,t.loading=!1})).catch((function(){t.loading=!1}))},createNotice:function(){this.createVisible=!0},editNotice:function(t){var e=this;"show"==t?this.editInputShow=!0:(this.loading=!0,Object(c["d"])({projectId:this.listData[0].projectId,projectAnnouncementId:this.listData[0].projectAnnouncementId,content:this.inputEditText}).then((function(t){e.$message.success("操作成功"),e.editInputShow=!1,e.loading=!1,e.getData()})).catch((function(){e.editInputShow=!1,e.loading=!1})))},checkNotice:function(){this.$router.push({name:"projectNotice",params:{id:this.projectId}})}}},C=y,w=(a("8696"),Object(f["a"])(C,o,l,!1,null,"2d20b878",null)),T=w.exports,_=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("project-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[a("template",{slot:"title-left"},[a("div",{staticClass:"title"},[a("span",{staticClass:"name"},[t._v("项目迭代")]),t._v(" "),a("i",{staticClass:"line"}),t._v(" "),a("span",{staticClass:"mark"},[t._v("共"+t._s(t.iterationList.length||"0")+"个迭代内容")])])]),t._v(" "),a("el-button",{staticStyle:{"font-size":"14px"},attrs:{slot:"title-right",type:"primary-text"},on:{click:t.check},slot:"title-right"},[t._v("\n    查看更多\n  ")]),t._v(" "),a("div",{directives:[{name:"empty",rawName:"v-empty",value:!t.iterationList.length,expression:"!iterationList.length"}],staticClass:"content rc-cont"},[a("div",{staticClass:"box"},t._l(t.iterationList,(function(e,i){return a("div",{key:i,staticClass:"content-item",on:{click:function(a){t.enterIteration(e)}}},[a("h2",{staticClass:"title"},[t._v(t._s(e.name))]),t._v(" "),a("div",{staticClass:"item-content"},[a("p",[t._v(t._s(t._f("filterTimestampToFormatTime")(e.startTime,"YYYY-MM-DD"))),a("span",[t._v(t._s(e.startTime&&e.stopTime?"至":"--"))]),t._v(t._s(t._f("filterTimestampToFormatTime")(e.stopTime,"YYYY-MM-DD")))]),t._v(" "),a("div",{staticClass:"tag"},[a("el-tag",{attrs:{"disable-transitions":"",type:"info"}},[t._v(t._s(e.list?e.list.length:"0")+"个事项")]),t._v(" "),a("status-tag",{staticClass:"tag-content",attrs:{type:e.status}}),t._v(" "),a("xr-avatar",{staticClass:"tag-content",attrs:{id:e.mainUserId,trigger:"hover",src:e.mainUserImg,name:e.mainUserName,size:24}})],1)])])})))])],2)},x=[],I=(a("4de4"),a("d3b7"),a("d81d"),a("1658")),D=a("1557"),j={name:"Iteration",components:{StatusTag:D["a"]},mixins:[g],props:{detail:Object},data:function(){return{loading:!1,num:10,list:[{title:"09月份CRM升级内容",time:"2022-08-15至2022-09-15",matter:"3",status:"进行中"},{title:"2022商业汇演方案2",time:"2022-08-15至2022-09-15",matter:"3",status:"未开始"},{title:"09月份CRM升级内容",time:"2022-08-15至2022-09-15",matter:"3",status:"进行中"},{title:"2022商业汇演方案2",time:"2022-08-15至2022-09-15",matter:"3",status:"未开始"}],iterationList:[]}},computed:{projectId:function(){return this.$route.params.id}},watch:{},created:function(){this.getIterationsList()},mounted:function(){},methods:{getIterationsList:function(){var t=this,e={type:0,pageType:0,projectId:this.projectId,name:""};Object(I["T"])(e).then((function(e){var a,i=null===(a=e.data.list)||void 0===a?void 0:a.filter((function(t){return 3!==t.status}));t.iterationList=(i||[]).map((function(e,a){return t.getAllItem(e.taskId,a),e}))})).catch((function(){}))},getAllItem:function(t,e){var a=this,i={belongIterationId:t,pageType:0};Object(I["S"])(i).then((function(t){a.$set(a.iterationList[e],"list",t.data.list||[])})).catch((function(){}))},enterIteration:function(t){this.$router.push({name:"projectTeam",params:{id:this.projectId},query:{type:"iteration-detail",taskId:t.taskId}})},check:function(){this.$router.push({name:"projectTeam",params:{id:this.projectId},query:{type:"Iterations"}})}}},L=j,S=(a("a03b"),Object(f["a"])(L,_,x,!1,null,"6ea7f267",null)),O=S.exports,$=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("project-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[a("template",{slot:"title-left"},[t._v("项目基本信息")]),t._v(" "),a("div",{staticClass:"content"},[t.detail?a("div",{staticClass:"content-body"},t._l(t.info,(function(e,i){return a("div",{key:i,staticClass:"body-item"},[a("h2",{staticClass:"title"},[t._v(t._s(e.title))]),t._v(" "),"text"==e.type?a("p",{staticClass:"item-content"},[t._v(t._s(t.detail[e.name]))]):t._e(),t._v(" "),"time"==e.type?a("p",{staticClass:"item-content"},[t._v(t._s(t._f("filterTimestampToFormatTime")(t.detail.startTime,"YYYY-MM-DD"))),a("span",[t._v(t._s(t.detail.startTime&&t.detail.stopTime?"至":"--"))]),t._v(t._s(t._f("filterTimestampToFormatTime")(t.detail.stopTime,"YYYY-MM-DD")))]):t._e(),t._v(" "),"tag"==e.type?a("status-tag",{attrs:{type:t.detail.status}}):t._e(),t._v(" "),"theProgress"==e.type?a("div",[a("flexbox",[a("flexbox-item",{staticStyle:{display:"flex","align-items":"center"}},[a("el-progress",{staticStyle:{width:"80%"},attrs:{percentage:Math.round(t.detail.theProgress)||0,"show-text":!1}}),t._v(" "),a("span",{staticClass:"text",staticStyle:{"padding-left":"8px"}},[t._v(t._s(Math.round(t.detail.theProgress)||0)+"%")])],1)],1)],1):t._e(),t._v(" "),"adminAvatar"==e.type?a("flexbox",{attrs:{align:"center",justify:"flex-start"}},[a("div",{staticClass:"member"},t._l(t.adminList,(function(e,i){return a("span",{key:i,staticStyle:{"flex-shrink":"0"}},[t._v("\n              "+t._s(e.realname)+"\n              "),i<t.adminList.length-1?a("i",[t._v("，")]):t._e()])})))]):t._e(),t._v(" "),"avatar"==e.type?a("flexbox",{attrs:{align:"center",justify:"flex-start"}},[a("div",{staticClass:"member"},t._l(t.detail.projectOwnerRoleList,(function(e,i){return a("span",{key:i,staticStyle:{"flex-shrink":"0"}},[t._v("\n              "+t._s(e.realname)+"\n              "),i<t.detail.projectOwnerRoleList.length-1?a("i",[t._v("，")]):t._e()])})))]):t._e()],1)}))):t._e()])],2)},A=[],F=(a("159b"),{name:"Information",components:{StatusTag:D["a"]},mixins:[g],props:{detail:Object},data:function(){return{loading:!1,info:[{title:"项目名称",name:"name",type:"text"},{title:"项目周期",name:"2022-08-15至2022-09-15",type:"time"},{title:"管理员",name:"",type:"adminAvatar"},{title:"项目进度",name:"这是一个要升级的项目",type:"theProgress"},{title:"项目成员",name:"",type:"avatar"},{title:"项目描述",name:"description",type:"text"}],adminList:[]}},computed:{},created:function(){this.getAdminList()},methods:{getAdminList:function(){var t=[];this.detail.projectOwnerRoleList.forEach((function(e){e.adminRoles.forEach((function(a){1==a.label&&t.push(e)}))})),this.adminList=t}}}),U=F,N=(a("7714"),Object(f["a"])(U,$,A,!1,null,"3799ab9e",null)),V=N.exports,P=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("project-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[a("template",{slot:"title-left"},[t._v("分配给我的")]),t._v(" "),a("el-button",{staticStyle:{"font-size":"14px"},attrs:{slot:"title-right",type:"primary-text"},on:{click:t.check},slot:"title-right"},[t._v("\n    查看更多\n  ")]),t._v(" "),a("div",{directives:[{name:"empty",rawName:"v-empty",value:!t.list.length,expression:"!list.length"}],staticClass:"content rc-cont"},[a("div",{staticClass:"box"},t._l(t.list,(function(e,i){return a("item",{key:i,staticStyle:{cursor:"pointer"},attrs:{item:e},nativeOn:{click:function(a){t.enterDetail(e,t.list)}}})})))]),t._v(" "),t.taskDetailShow?a("item-detail",{ref:"particulars",attrs:{id:t.taskId,"detail-index":t.detailIndex,"no-listener-class":["el-table__body"]},on:{"update-list":t.handleUpdateList,close:function(e){t.taskDetailShow=!1}}}):t._e()],2)},E=[],B=a("b966"),R=a("e605"),M=a("2f62"),q={name:"Responsible",components:{Item:B["a"],ItemDetail:R["default"]},mixins:[g],props:{detail:Object},data:function(){return{loading:!1,list:[],taskId:"",detailIndex:-1,taskDetailShow:!1}},computed:Object(n["a"])({projectId:function(){return this.$route.params.id}},Object(M["b"])(["userInfo"])),watch:{},created:function(){this.getList()},methods:{getList:function(){var t=this,e={type:1==this.detail.type?3:"",pageType:0,projectId:this.projectId,mainUserId:this.userInfo.userId};this.loading=!0,Object(I["R"])(e).then((function(e){var a=e.data.list.filter((function(t){return 3!==t.status}));t.list=a,t.loading=!1})).catch((function(){t.loading=!1}))},check:function(){this.$router.push({name:"projectTeam",params:{id:this.projectId},query:{type:"All"}})},enterDetail:function(t,e){this.taskId=t.taskId,this.detailIndex=this.getObjIndex(e,"taskId",t.taskId),this.taskDetailShow=!0},getObjIndex:function(t,e,a){for(var i=0;i<t.length;i++){var s=t[i];if(s[e]===a)return i}return null},handleUpdateList:function(){this.getList()}}},W=q,H=(a("560f"),Object(f["a"])(W,P,E,!1,null,"fa9e2fc2",null)),Y=H.exports,z=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("project-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[a("template",{slot:"title-left"},[a("div",{staticClass:"title"},[a("span",{staticClass:"name"},[t._v("工作项趋势")]),t._v(" "),a("i",{staticClass:"line"}),t._v(" "),a("span",{staticClass:"mark"},[t._v("2周内已完成的工作项")])])]),t._v(" "),a("div",{staticClass:"chart-card content trend"},[a("div",{ref:"chart",staticClass:"chart"})])],2)},G=[],Q=a("313e"),J=a("a347"),K=a.n(J),X={name:"Trend",components:{},mixins:[g],props:{},data:function(){return{loading:!1,charts:[],dataTime:[],dataNum:[],chartOption:{color:["#0052CC"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"},textStyle:{color:"#42526E"}},legend:{orient:"vertical",x:"center",y:"top",icon:"roundRect",itemWidth:16,itemHeight:8,data:["工作项数量"],textStyle:{color:"#42526E",fontWeight:700}},grid:{top:"40px",left:"0",right:"0",bottom:"16px",containLabel:!0},xAxis:{type:"category",boundaryGap:["20%","20%"],axisTick:{alignWithLabel:!0},axisLabel:{color:"#6B778C",fontWeight:K.a.axisLabelFontWeight,interval:0,formatter:function(t){return Q["a"].formatTime("MM-dd",new Date(t))}},axisLine:{lineStyle:{color:K.a.axisLineColor}}},yAxis:{type:"value",min:0,interval:1,axisTick:{show:!0},axisLine:{show:!0,lineStyle:{color:K.a.axisLineColor}},axisLabel:{color:"#6B778C",fontWeight:K.a.axisLabelFontWeight},splitLine:{lineStyle:{color:K.a.axisLineColor}}},series:[{name:"工作项数量",type:"line",smooth:!0,areaStyle:{color:new Q["b"].LinearGradient(0,0,0,1,[{offset:0,color:"rgba(193, 199, 208, 0.2)"}])},itemStyle:{normal:{color:"#0052cc",lineStyle:{width:2,color:"#0052cc"}}}}]}}},computed:{projectId:function(){return this.$route.params.id}},watch:{},created:function(){this.getTrendChart()},mounted:function(){},beforeDestroy:function(){},methods:{getTrendChart:function(){var t=this;Object(I["i"])({projectId:this.projectId}).then((function(e){var a=[],i=[];e.data.projectTaskNumVOEnd.forEach((function(t){a.push(t.updateTime),i.push(t.num)})),t.dataTime=a,t.dataNum=i,t.initChart()})).catch((function(){}))},initChart:function(){this.charts=[];var t=this.$refs.chart,e=Q["c"](t),a=Object(k["r"])(this.chartOption);a.xAxis.data=this.dataTime,a.series[0].data=this.dataNum,e.setOption(a,!0),this.charts.push(e),window.addEventListener("resize",this.resizeCallback)},resizeCallback:function(){this.charts.forEach((function(t){t.resize()}))}}},Z=X,tt=(a("8862"),Object(f["a"])(Z,z,G,!1,null,"3538b7d0",null)),et=tt.exports,at=a("f202"),it=a("b76a"),st=a.n(it),nt={name:"ProjectOverviewIndex",components:{Announcement:T,draggable:st.a,Information:V,Responsible:Y,Trend:et,IterationDetail:at["a"]},data:function(){return{loading:!1,projectDetail:null,sortLeft:[],sortRight:[],iterationDetail:"",defaultVal:"main"}},computed:Object(n["a"])({projectId:function(){return this.$route.params.id}},Object(M["b"])(["projectAuth"])),watch:{projectAuth:{handler:function(t){t.loaded&&(this.$auth("projectDescription.viewDescription","PM")||this.$router.replace({name:"participate"}))},immediate:!0,deep:!0}},created:function(){this.getDetail()},methods:{getDetail:function(){var t=this;this.loading=!0,Object(r["r"])({projectId:this.projectId}).then((function(e){t.projectDetail=e.data||{},t.getModelSort(),t.loading=!1})).catch((function(){t.loading=!1}))},getModelSort:function(){1===this.projectDetail.type?(this.sortLeft=[{component:T},{component:V}],this.sortRight=[{component:et},{component:Y}]):(this.sortLeft=[{component:T},{component:V}],this.sortRight=[{component:O},{component:Y}])},getChangeInfo:function(t){this.defaultVal=t.type,"iteration-detail"==t.type&&(this.iterationDetail=t.row)}}},rt=nt,ot=(a("e470"),Object(f["a"])(rt,i,s,!1,null,"c87976e4",null));e["default"]=ot.exports},d6bf:function(t,e,a){},d75b:function(t,e,a){},d86b:function(t,e,a){var i=a("d039");t.exports=i((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}}))},dc1b:function(t,e,a){"use strict";a.d(e,"c",(function(){return s})),a.d(e,"a",(function(){return n})),a.d(e,"d",(function(){return r})),a.d(e,"b",(function(){return o}));var i=a("b775");function s(t){return Object(i["a"])({url:"projectAnnouncement/getProjectAnnouncement",method:"post",data:t,headers:{"Content-Type":"application/json;charset=utf-8;"}})}function n(t){return Object(i["a"])({url:"projectAnnouncement/addProjectAnnouncement",method:"post",headers:{"Content-Type":"application/json;charset=utf-8;"},data:t})}function r(t){return Object(i["a"])({url:"projectAnnouncement/setProjectAnnouncement",method:"post",headers:{"Content-Type":"application/json;charset=utf-8;"},data:t})}function o(t){return Object(i["a"])({url:"projectAnnouncement/delProjectAnnouncement",method:"post",headers:{"Content-Type":"application/json;charset=utf-8;"},data:t})}},df8a:function(t,e,a){"use strict";a("834f")},e001:function(t,e,a){},e04a:function(t,e,a){"use strict";a.d(e,"h",(function(){return s})),a.d(e,"k",(function(){return n})),a.d(e,"j",(function(){return r})),a.d(e,"i",(function(){return o})),a.d(e,"g",(function(){return l})),a.d(e,"d",(function(){return c})),a.d(e,"e",(function(){return d})),a.d(e,"f",(function(){return u})),a.d(e,"b",(function(){return h})),a.d(e,"c",(function(){return p})),a.d(e,"l",(function(){return m})),a.d(e,"a",(function(){return f})),a.d(e,"m",(function(){return b}));var i=a("b775");function s(t){return Object(i["a"])({url:"projectStatus/add",method:"post",headers:{"Content-Type":"application/json;charset=utf-8;"},data:t})}function n(t){return Object(i["a"])({url:"projectStatus/update",method:"post",headers:{"Content-Type":"application/json;charset=utf-8;"},data:t})}function r(t){return Object(i["a"])({url:"projectStatus/queryProjectStatusList",method:"post",headers:{"Content-Type":"application/json;charset=utf-8;"},data:t})}function o(t){return Object(i["a"])({url:"projectStatus/delete",method:"post",data:t})}function l(t){return Object(i["a"])({url:"projectEvent/queryEventList",method:"post",data:t})}function c(t){return Object(i["a"])({url:"projectEventStatus/add",method:"post",headers:{"Content-Type":"application/json;charset=utf-8;"},data:t})}function d(t){return Object(i["a"])({url:"projectEventStatus/remove",method:"post",data:t})}function u(t){return Object(i["a"])({url:"projectEventStatus/applicationSchemeStatusList",method:"post",data:t})}function h(t){return Object(i["a"])({url:"projectEventStatus/list",method:"post",data:t})}function p(t){return Object(i["a"])({url:"projectEventStatus/transferStatus",method:"post",headers:{"Content-Type":"application/json;charset=utf-8;"},data:t})}function m(t){return Object(i["a"])({url:"projectEventStatus/updateInitStatus",method:"post",data:t})}function f(t){return Object(i["a"])({url:"projectEventStatus/giveUpApplicationScheme",method:"post",data:t})}function b(t){return Object(i["a"])({url:"projectEventStatus/updateSorting",method:"post",headers:{"Content-Type":"application/json;charset=utf-8;"},data:t})}},e07a:function(t,e,a){"use strict";a("bfee")},e17e:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var i=a("b775");function s(t){return Object(i["a"])({url:"adminUser/queryDeptUserList/".concat(t),method:"post"})}},e1a3:function(t,e,a){},e274:function(t,e,a){"use strict";a("9732")},e470:function(t,e,a){"use strict";a("e001")},e605:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("slide-view",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"},{name:"empty",rawName:"v-empty",value:!t.canShowDetail,expression:"!canShowDetail"}],ref:"sideView",staticClass:"d-view",attrs:{"no-listener-class":t.noListenerClass,"body-style":{padding:0,height:"100%"},"xs-empty-icon":"nopermission","xs-empty-text":"暂无权限"},on:{afterEnter:t.viewAfterEnter,close:t.hideView}},[i("div",{ref:"crmDetailMain",staticClass:"detail-main no-padding"},[t.taskData?i("flexbox",{staticClass:"d-container",attrs:{direction:"column",align:"stretch"}},[i("wk-detail-header",{staticClass:"detail-header",attrs:{subtitle:t.subTitle,"page-list":t.pageList,"icon-class":"wk wk-icon-task-line",dropdowns:t.handleAuthOperations},on:{command:t.headerRightClick}},[i("div",{staticClass:"icon-name",attrs:{slot:"title"},slot:"title"},[i("img",{staticClass:"item-pic",attrs:{src:t.getIconClass(t.taskData)}}),t._v(" "),t.showEditTitle&&t.editAuth?i("wk-edit-wrap",{staticClass:"edit-wrap",on:{save:t.saveItemTitle,cancel:function(e){t.showEditTitle=!1}}},[i("el-input",{attrs:{maxlength:"100","show-word-limit":""},model:{value:t.taskData.name,callback:function(e){t.$set(t.taskData,"name",e)},expression:"taskData.name"}})],1):i("el-tooltip",{attrs:{disabled:!t.title,content:t.title,effect:"dark",placement:"top-start"}},[i("span",{staticClass:"wk-detail-header-title",on:{click:function(e){t.showEditTitle=!0}}},[t._v(t._s(t.title))])])],1)]),t._v(" "),t.labelList?i("div",{staticClass:"label"},[i("tag-view",{staticClass:"tag-view",attrs:{value:t.tagLabelList,"max-length":1/0,wrap:"wrap"}},[i("div",{staticClass:"add-tag"},[i("tag-index",{attrs:{placement:"bottom-start","task-data":t.taskData}},[t.editAuth?i("el-button",{attrs:{slot:"editIndex",type:"icon",size:"small",icon:"wk wk-icon-label-solid"},slot:"editIndex"}):t._e()],1)],1)])],1):t._e(),t._v(" "),t.editAuth?i("wk-quick-create-bar",{attrs:{list:t.activityHandle},on:{command:t.quickCreateClick}}):t._e(),t._v(" "),i("div",{staticClass:"main"},[i("div",{staticClass:"main__left left-padding",style:{height:t.calcHeight+"px"}},[t.descShow||t.childShow||t.relationShow||t.fileShow?i("div",{staticStyle:{"margin-bottom":"32px"}},[t.descShow&&t.editAuth?i("div",{staticClass:"section is-header"},[i("div",{staticClass:"section__bd description",staticStyle:{"margin-top":"0",cursor:"auto"}},[t.editDesc?[i("tinymce",{ref:"editor",staticClass:"rich-txt",attrs:{height:200,init:{menubar:!1,toolbar_sticky:!0,statusbar:!1,contextmenu:"",content_style:"p { margin: 5px 0; line-height: 1.5;}",plugins:"paste",toolbar:"paste",paste_data_images:!0,automatic_uploads:t.autoUpload}},model:{value:t.addDescriptionTextarea,callback:function(e){t.addDescriptionTextarea=e},expression:"addDescriptionTextarea"}}),t._v(" "),i("div",{staticClass:"save-cancel"},[i("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:t.submiteDescription,expression:"submiteDescription"}],attrs:{type:"primary"}},[t._v("保存")]),t._v(" "),i("el-button",{nativeOn:{click:function(e){return t.cancelEditDesc(e)}}},[t._v("取消")])],1)]:[i("div",{staticClass:"html-wrap"},[i("div",{ref:"descWrap",class:["desc-box",t.expand?"full-content-style":"part-content-style"],domProps:{innerHTML:t._s(t.addDescriptionTextarea)},on:{click:t.previewImg}}),t._v(" "),320===t.htmlHeght?[t.expand?t._e():i("div",{staticClass:"desc-mask"}),t._v(" "),i("div",{staticClass:"toggle-btn",on:{click:function(e){t.expand=!t.expand}}},[i("i",{staticClass:"el-icon-arrow-down el-icon--right arrow",style:{transform:t.expand?"rotate(180deg)":"none"}}),t._v("\n                        "+t._s(t.expand?"收起描述":"展开描述")+"\n                      ")])]:t._e()],2)]],2)]):t._e(),t._v(" "),t.childShow?i("div",{staticClass:"section"},[i("div",{staticClass:"section__hd"},[i("span",[t._v("子工作项")]),t._v(" "),t.editAuth?i("span",{staticClass:"line"}):t._e(),t._v(" "),t.editAuth?i("i",{staticClass:"wk wk-l-plus section-add",staticStyle:{float:"right"},on:{click:function(e){t.addSubtasks=!1}}}):t._e()]),t._v(" "),i("div",{staticClass:"section__bd"},[t.taskData.taskId?i("div",[0===t.childTask.length&&t.addSubtasks?t._e():i("div",{staticClass:"sub-task-all"},[t._l(t.childTask,(function(e,s){return i("div",{key:s,staticClass:"sub-task"},[e.showEdit?i("sub-work-item",{attrs:{name:e.name,"sub-id":e.taskId,index:s},on:{save:t.handleSave,close:function(a){t.handleCloseSub(e)}}}):i("flexbox",{class:{"is-checked-background":e.checked},staticStyle:{padding:"14px"}},[i("div",{on:{click:function(t){t.stopPropagation()}}},[i("el-checkbox",{attrs:{disabled:!t.getPermission("setChildTaskStatus")},on:{change:function(a){t.subtasksCheckbox(e,a)}},model:{value:e.checked,callback:function(a){t.$set(e,"checked",a)},expression:"item.checked"}})],1),t._v(" "),i("img",{staticClass:"item-img",attrs:{src:a("02fe"),alt:""}}),t._v(" "),i("span",{staticClass:"sub-num"},[t._v("#"+t._s(e.num))]),t._v(" "),i("div",{staticClass:"sub-task__bd text-one-line",class:{"is-checked":e.checked}},[t._v("\n                          "+t._s(e.name)+"\n                        ")]),t._v(" "),e.stopTime?i("div",{staticClass:"bg-color task-bg-color",staticStyle:{"margin-left":"8px"}},[t._v(t._s(t._f("moment")(e.stopTime,"YYYY-MM-DD"))+" 截止")]):t._e(),t._v(" "),e.mainUser?i("xr-avatar",{staticClass:"user-img",attrs:{name:e.mainUser.realname,size:25,src:e.mainUser.img}}):t._e(),t._v(" "),i("div",{staticClass:"edit-del-dropdown"},[t.editAuth?i("el-dropdown",{attrs:{"hide-on-click":!1},on:{command:t.handleSubTask}},[i("span",{staticClass:"el-dropdown-link"},[i("i",{staticClass:"el-icon-more",staticStyle:{cursor:"pointer"}})]),t._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:{type:"update",data:e}}},[t.getPermission("updateChildTask")?i("span",[t._v("\n                                  编辑\n                                ")]):t._e()]),t._v(" "),i("el-dropdown-item",{attrs:{command:{type:"delete",data:e}}},[t.getPermission("deleteChildTask")?i("span",[t._v("\n                                  删除\n                                ")]):t._e()])],1)],1):t._e()],1)],1)],1)})),t._v(" "),t.addSubtasks?t._e():i("div",[i("sub-work-item",{on:{save:t.handleSave,close:function(e){t.addSubtasks=!0,t.console.log("4444")}}})],1)],2)]):t._e()])]):t._e(),t._v(" "),t.fileShow?i("div",{staticClass:"section"},[i("div",{staticClass:"section__hd "},[i("span",[t._v("附件")]),t._v(" "),t.editAuth?i("span",{staticClass:"line"}):t._e(),t._v(" "),t.getPermission("uploadTaskFile")?i("el-upload",{ref:"fileUpload",staticClass:"upload-file",staticStyle:{float:"right"},attrs:{"http-request":t.httpRequest,action:"https://jsonplaceholder.typicode.com/posts/",multiple:"","list-type":"picture"}},[t.editAuth?i("i",{staticClass:"wk wk-l-plus section-add",staticStyle:{float:"right"}}):t._e()]):t._e()],1),t._v(" "),i("div",{staticStyle:{"margin-top":"6px"}},[i("file-cell",{attrs:{"file-list":t.fileList,"module-id":t.id,"show-delete":t.getPermission("deleteTaskFile"),"is-exposed":!0},on:{delete:t.accessoryDeleteFun}})],1)]):t._e()]):t._e(),t._v(" "),i("div",{staticClass:"margin-top-base "},[i("div",{staticStyle:{"font-size":"18px","font-weight":"600",color:"#172b4d"}},[t._v("活动日志")]),t._v(" "),i("div",{staticClass:"activity-title"},[t._v("\n              显示：\n              "),t._l(t.tabs,(function(e,a){return i("el-button",{key:a,attrs:{type:e.value===t.tabValue?"selected":""},on:{click:function(a){t.tabValue=e.value}}},[t._v(t._s(e.label))])}))],2),t._v(" "),"comment"===t.tabValue?i("flexbox",{directives:[{name:"loading",rawName:"v-loading",value:t.commentsLoading,expression:"commentsLoading"}],staticClass:"comment-cells",attrs:{direction:"column",align:"stretch"}},[t.replyList&&t.replyList.length>0?i("comment-list",{ref:"comment_list",attrs:{props:t.commentListProps,list:t.replyList,"show-control":t.editAuth},on:{delete:t.deleteComment,"close-other-reply":function(e){t.$refs.f_reply.toggleFocus(!0)},"query-comment":t.getCommentList}}):t._e(),t._v(" "),i("flexbox",{staticClass:"reply-comment-wrap",attrs:{align:"stretch"}},[i("xr-avatar",{staticClass:"user-img",attrs:{name:t.userInfo.realname,size:32,src:t.userInfo.img}}),t._v(" "),i("reply-comment",{ref:"f_reply",on:{toggle:t.closeOtherReply,reply:t.handleReply}})],1)],1):"activity"===t.tabValue||"hours"===t.tabValue?i("div",{staticClass:"activity-cells"},[i("activity-list",{attrs:{list:t.activityList,"hours-list":t.hoursList,type:t.tabValue}})],1):t._e()],1)]),t._v(" "),i("div",{staticClass:"main__right right-padding",style:{height:t.calcHeight+"px"}},[i("el-dropdown",{staticClass:"dropdown-status-btn",attrs:{disabled:!t.getPermission("setTaskStatus")},on:{command:t.setItemStatus}},[i("div",[i("el-button",{style:{"background-color":t.statusColor.bgColor,color:t.statusColor.color}},[t._v("\n                "+t._s(t.taskData.boardStatusName||"未开始")+"\n                "),i("i",{staticClass:"el-icon-arrow-down el-icon--right"})])],1),t._v(" "),i("el-dropdown-menu",{staticClass:"dropdown-menu",style:{padding:0===t.allStatusList.length?"0px":"auto"},attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.allStatusList,(function(t,e){return i("el-dropdown-item",{key:e,attrs:{command:t.id}},[i("span",{staticStyle:{padding:"5px"}},[i("status-tag",{attrs:{type:t.statusType,"status-name":t.statusName}})],1)])})))],1),t._v(" "),i("wk-head-section",{attrs:{label:"基础信息"}},[i("div",{staticClass:"detail-form"},t._l(t.detailList,(function(e,a){return i("wk-section-item",{key:a,attrs:{label:e.label}},["belongIterationName"===e.field?i("flexbox",{staticClass:"head-btn"},[t.showSearchIteration?i("el-autocomplete",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:t.editChangeSave,expression:"editChangeSave"}],staticStyle:{width:"100%"},attrs:{"fetch-suggestions":t.querySearchAsync,placeholder:"请输入迭代名称"},on:{select:t.handleSelect},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.item;return["btn"==a.type?i("div",{staticStyle:{color:"#0052cc"}},[t._v(t._s(a.name))]):i("div",{staticClass:"name"},[t._v(t._s(a.name))])]}}]),model:{value:t.itemName,callback:function(e){t.itemName=e},expression:"itemName"}}):i("div",{staticClass:"head-btn__bd",on:{click:function(a){t.editOpen(e.field)}}},[t.taskData.belongIterationName?i("span",[t._v(t._s(t.taskData.belongIterationName))]):i("span",{staticClass:"head-btn__text",staticStyle:{"padding-left":"0"}},[t._v("点击更改所属迭代")])])],1):"item"==e.formType?i("div",{staticClass:"head-btn text-one-line"},[t.editingObj[e.field]?i("el-select",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:t.editChangeSave,expression:"editChangeSave"}],staticStyle:{width:"100%"},attrs:{filterable:"",remote:"",clearable:"","remote-method":t.getRelatedDemandData,loading:t.relatedDemandLoading},on:{focus:function(e){t.getRelatedDemandData("")},change:t.relatedDemandChange},model:{value:t.taskData[e.field],callback:function(a){t.$set(t.taskData,e.field,a)},expression:"taskData[item.field]"}},t._l(t.relatedDemandOptions,(function(t){return i("el-option",{key:t.taskId,attrs:{label:t.name,value:t.taskId}})}))):i("div",{staticClass:"head-btn__bd",on:{click:function(a){t.editOpen(e.field)}}},[i("span",{staticClass:"head-btn__text",staticStyle:{"padding-left":"0"}},[t._v(t._s(t.taskData.relatedDemandName||"点击更改关联需求"))])])],1):"wrongType"==e.formType?i("div",{staticClass:"head-btn text-one-line"},[t.editingObj[e.field]?i("el-select",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:t.editChangeSave,expression:"editChangeSave"}],staticStyle:{width:"100%"},attrs:{clearable:""},on:{change:t.wrongTypeChange},model:{value:t.taskData[e.field],callback:function(a){t.$set(t.taskData,e.field,a)},expression:"taskData[item.field]"}},t._l(t.wrongTypes,(function(t){return i("el-option",{key:t.key,attrs:{label:t.label,value:t.key}})}))):i("div",{staticClass:"head-btn__bd",on:{click:function(a){t.editOpen(e.field)}}},[i("span",{staticClass:"head-btn__text",staticStyle:{"padding-left":"0"}},[t._v(t._s(t.taskData.wrongType?t.wrongTypes.find((function(e){return e.key==t.taskData.wrongType})).label:"点击更改缺陷"))])])],1):t._e(),t._v(" "),"projectOwnerRoleList"===e.field?i("flexbox",{staticClass:"head-btn"},[i("div",{staticClass:"head-btn__bd",staticStyle:{"padding-top":"3px","white-space":"normal"}},[i("wk-user-select",{staticStyle:{width:"100%"},attrs:{disabled:!t.editAuth,request:t.ownerListRequest,params:t.ownerListParams,props:{isList:!!t.ownerListRequest}},on:{change:t.taskUserChange,"visible-change":t.setTaskUser},model:{value:t.projectOwnerRoleList,callback:function(e){t.projectOwnerRoleList=e},expression:"projectOwnerRoleList"}},[i("flexbox",{staticClass:"head-btn",attrs:{slot:"reference"},slot:"reference"},[t.projectOwnerRoleList.length?t.projectOwnerRoleList.length?i("div",{staticStyle:{display:"flex"},on:{click:function(t){t.stopPropagation()}}},[t._l(t.ownerUserShowList,(function(e,a){return i("span",{key:a,class:["owner-list",{"owner-list-fold":t.projectOwnerRoleList.length<5}]},[i("xr-avatar",{staticClass:"user-img",attrs:{id:e.userId,name:e.realname,size:24,src:e.img}})],1)})),t._v(" "),t.projectOwnerRoleList.length>5?i("el-dropdown",{attrs:{trigger:"click","hide-on-click":!1}},[i("el-button",{staticClass:"dropdown-btn owner-list-button"},[t._v("\n                              +"+t._s(t.projectOwnerRoleList.length-5)+"\n                            ")]),t._v(" "),i("el-dropdown-menu",{staticClass:"owner-list-dropdown",attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.ownerUserHideList,(function(e,a){return i("el-dropdown-item",{key:a,staticClass:"owner-list-dropdown-list"},[i("xr-avatar",{staticClass:"owner-list-dropdown-img",staticStyle:{"margin-right":"10px"},attrs:{id:e.userId,name:e.realname,size:24,src:e.img}}),t._v(" "),i("p",{staticClass:"owner-list-dropdown-text"},[t._v(t._s(e.realname)+" ")])],1)})))],1):t._e()],2):t._e():i("span",{staticClass:"head-btn__text",staticStyle:{"padding-left":"0"}},[t._v("\n                          "+t._s(t.editAuth?"点击选择团队成员":"--")+"\n                        ")])])],1)],1)]):"priority"===e.field?i("flexbox",{nativeOn:{click:function(e){t.priorityVisible=!0}}},[i("el-dropdown",{staticClass:"priority-box",attrs:{disabled:!t.getPermission("priority")},on:{command:t.changePriority}},[i("div",{staticClass:"priority-wrap"},[i("img",{staticClass:"priority-icon",attrs:{src:t.handlePriorityIcon(t.taskData.priority),alt:""}}),t._v("\n                      "+t._s(["无","低","中","高"][t.taskData.priority])+"\n                    ")]),t._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.priorityList,(function(e,a){return i("el-dropdown-item",{key:a,attrs:{command:e.key}},[i("div",{staticClass:"priority-wrap"},[i("img",{staticClass:"priority-icon",attrs:{src:e.icon,alt:""}}),t._v(t._s(e.label)+"\n                        ")])])})))],1)],1):"estimatedManHours"===e.field?i("flexbox",{staticClass:"head-btn"},[i("span",{staticClass:"head-btn__bd"},[t.showEditWorkTime?i("wk-edit-wrap",{staticClass:"edit-wrap",on:{save:t.handleWorkTime,cancel:function(e){t.showEditWorkTime=!1}}},[i("el-input",{model:{value:t.taskData.estimatedManHours,callback:function(e){t.$set(t.taskData,"estimatedManHours",e)},expression:"taskData.estimatedManHours"}})],1):i("span",{on:{click:function(e){t.editAuth&&(t.showEditWorkTime=!0)}}},[t.taskData.estimatedManHours?i("span",[t._v(t._s(t.taskData.estimatedManHours)+"小时")]):i("span",{staticClass:"head-btn__text",staticStyle:{"padding-left":"0"}},[t._v(t._s(t.editAuth?"点击更改预估工时":"--"))])])],1)]):"progress"===e.field?i("flexbox",{staticClass:"head-btn"},[i("span",{staticClass:"head-btn__bd"},[i("div",{staticClass:"progress-wrap"},[i("el-progress",{attrs:{type:"circle","show-text":!1,width:28,"stroke-width":4,percentage:Number(t.taskData.progress||0)}}),t._v(" "),t.editProgress?i("wk-edit-wrap",{staticClass:"edit-wrap",staticStyle:{"margin-left":"5px"},on:{save:t.hideProgress,cancel:function(e){t.editProgress=!1}}},[i("el-input",{model:{value:t.taskData.progress,callback:function(e){t.$set(t.taskData,"progress",e)},expression:"taskData.progress"}})],1):i("span",{staticStyle:{"margin-left":"5px"},on:{click:function(e){t.editAuth&&(t.editProgress=!0)}}},[t._v("已完成"+t._s(t.taskData.progress||0)+"%")])],1)])]):"taskTimeList"===e.field?i("flexbox",{staticClass:"head-btn"},[i("span",{staticClass:"head-btn__bd"},[i("div",{staticClass:"record-wrap",on:{click:function(e){t.editAuth&&(t.workTimeShow=!0)}}},[i("div",{staticClass:"record-desc"},[i("span",[t._v("已记录"+t._s(t.workTimeRecord.actualHour||0)+"小时")]),t._v(" "),i("span",[t._v("剩余"+t._s(t.workTimeRecord.surplusHours||0)+"小时")])]),t._v(" "),i("el-progress",{attrs:{percentage:t.recordPercentage||0,"show-text":!1,color:"#409eff"}})],1)])]):"createUserName"===e.field?i("flexbox",{staticClass:"head-btn"},[i("span",{staticClass:"head-btn__bd",staticStyle:{"padding-top":"3px"}},[i("xr-avatar",{key:t.taskData.createUserId,attrs:{id:t.taskData.createUserId,size:26,name:t.taskData.createUserName,src:t.taskData.createUserImg}})],1)]):["updateTime","createTime"].includes(e.field)?i("flexbox",{staticClass:"head-btn"},[i("span",{staticClass:"head-btn__bd"},[t._v(t._s(t._f("moment")(t.taskData[e.field]||"--","YYYY年MM月DD日")))])]):"mainUser"===e.field?i("wk-user-select",{staticStyle:{width:"100%","margin-left":"8px"},attrs:{disabled:!t.editAuth,value:t.taskData.mainUserId,request:t.ownerListRequest,params:t.ownerListParams,props:{isList:!!t.ownerListRequest},radio:""},on:{change:t.mainUserChange}},[i("flexbox",{staticClass:"head-btn",attrs:{slot:"reference"},slot:"reference"},[t.taskData.mainUserId?i("xr-avatar",{staticClass:"user-img handle-user",attrs:{id:t.taskData.mainUserId,disabled:"",name:t.taskData.mainUserName,size:26,src:t.taskData.mainUserImg}}):i("span",{staticClass:"head-btn__text",staticStyle:{"padding-left":"0"}},[t._v("\n                      "+t._s(t.editAuth?"点击选择处理人":"--")+"\n                    ")]),t._v(" "),i("div",{staticClass:"head-btn__bd"},[t.taskData.mainUserId?i("div",{staticClass:"head-btn__bd--name",staticStyle:{"font-size":"14px"}},[t._v("\n                        "+t._s(t.taskData.mainUserName)+"\n                      ")]):t._e()]),t._v(" "),i("i",{directives:[{name:"show",rawName:"v-show",value:t.taskData.mainUserId&&t.editAuth,expression:"taskData.mainUserId && editAuth"}],staticClass:"el-icon-close head-btn__close",on:{click:function(e){e.stopPropagation(),t.submiteMainUser(null)}}})],1)],1):["startTime","stopTime"].includes(e.field)?i("flexbox",{staticClass:"head-btn"},[t.taskData[e.field]?t._e():i("span",{staticClass:"head-btn__text"},[t._v("\n                    "+t._s(t.editAuth?"startTime"==e.field?"点击选择开始时间":"点击选择截止时间":"--")+"\n                  ")]),t._v(" "),i("el-date-picker",{attrs:{disabled:!t.getPermission("setTaskTime",e.field),clearable:!1,"picker-options":"startTime"==e.field?t.startTimeOptions:t.stopTimeOptions,type:"date","value-format":"yyyy-MM-dd"},on:{change:function(a){t.timeChange(e.field)}},model:{value:t.taskData[e.field],callback:function(a){t.$set(t.taskData,e.field,a)},expression:"taskData[item.field]"}}),t._v(" "),i("div",{staticClass:"head-btn__bd"},[t.taskData[e.field]?i("div",{staticClass:"head-btn__bd--title",staticStyle:{"font-size":"14px"}},[t._v(t._s(t._f("moment")(t.taskData[e.field],"YYYY年MM月DD日")))]):t._e()]),t._v(" "),t.editAuth?i("i",{directives:[{name:"show",rawName:"v-show",value:t.taskData[e.field],expression:"taskData[item.field]"}],staticClass:"el-icon-close head-btn__close",on:{click:function(a){t.deleteTime(e.field)}}}):t._e()],1):t._e()],1)})))])],1)])],1):t._e()],1),t._v(" "),i("create-work-time",{attrs:{visible:t.workTimeShow,"task-data":t.taskData,"item-type":t.itemType,"rest-hours":t.workTimeRecord.surplusHours},on:{"update:visible":function(e){t.workTimeShow=e},"save-success":t.handleRefresh,close:function(e){t.workTimeShow=!1}}})],1)},s=[],n=a("2909"),r=a("b85c"),o=a("5530"),l=(a("a9e3"),a("b0c0"),a("99af"),a("4de4"),a("d3b7"),a("caad"),a("d81d"),a("14d9"),a("fb6a"),a("a4d3"),a("e01a"),a("2532"),a("159b"),a("7db0"),a("3ca3"),a("ddb0"),a("a434"),a("a535")),c=a("1658"),d=a("e04a"),u=a("130f"),h=a("da37"),p=a("8256"),m=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"create-box"},[t.subId?i("el-checkbox",{staticClass:"checked",attrs:{disabled:!0},model:{value:t.checked,callback:function(e){t.checked=e},expression:"checked"}}):t._e(),t._v(" "),i("img",{staticClass:"item-img",attrs:{src:a("02fe"),alt:""}}),t._v(" "),i("el-input",{ref:"subInput",staticClass:"input",attrs:{placeholder:"子工作项标题"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),t._v(" "),i("div",{staticClass:"btn-group"},[i("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:t.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[t._v("保存")]),t._v(" "),i("el-button",{nativeOn:{click:function(e){return t.handleClose(e)}}},[t._v("取消")])],1)],1)},f=[],b={name:"SubWorkItem",components:{},props:{name:String,index:Number,subId:[String,Number]},data:function(){return{checked:!1,title:""}},computed:{},watch:{},created:function(){this.name&&(this.title=this.name)},mounted:function(){this.$refs.subInput.focus()},methods:{handleClose:function(){this.$emit("close")},handleConfirm:function(){this.$emit("save",{type:this.name?"edit":"add",name:this.title,subId:this.subId,index:this.index}),this.name||(this.title="")}}},v=b,g=(a("1019"),a("2877")),k=Object(g["a"])(v,m,f,!1,null,"9cb5f662",null),y=k.exports,C=a("0f6f"),w=a("787c"),T=a("88c0"),_=a("5feb"),x=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-popover",{attrs:{placement:t.placement,width:t.popoverWidth,trigger:"click"},model:{value:t.tagShow,callback:function(e){t.tagShow=e},expression:"tagShow"}},[0==t.tagContent?a("div",{staticClass:"tag-popover-box"},[a("div",{staticClass:"tag-top"},[a("span",[t._v("选择标签")]),t._v(" "),a("span",{staticClass:"el-icon-close rt cursor-pointer",on:{click:function(e){t.tagShow=!1}}})]),t._v(" "),a("el-input",{attrs:{placeholder:"搜索标签","prefix-icon":"el-icon-search",size:"small"},model:{value:t.tagSearch,callback:function(e){t.tagSearch=e},expression:"tagSearch"}}),t._v(" "),a("div",{staticClass:"tag-content"},t._l(t.showTagList,(function(e,i){return a("div",{key:i,staticClass:"tag-list",on:{click:function(a){t.tagSelectClick(e,i)}}},[a("i",{staticClass:"wukong wukong-black-label",style:{color:e.color}}),t._v(" "),a("span",{staticClass:"item-label"},[t._v(t._s(e.name))]),t._v(" "),e.check?a("span",{staticClass:"el-icon-check rt"}):t._e()])}))),t._v(" "),a("div",{staticClass:"tag-footer"},[a("div",[a("el-button",{staticClass:"footer-row",attrs:{type:"text"},on:{click:t.createTagClick}},[t._v("+ 创建标签")])],1),t._v(" "),a("div",[a("el-button",{staticClass:"footer-row",attrs:{type:"text"},on:{click:t.managementTag}},[t._v("+ 管理标签")])],1)])],1):1==t.tagContent||3==t.tagContent?a("new-tag",{attrs:{"new-tag-title":t.newTagTitle,"new-tag-input":t.newTagInput,"bg-color-props":t.bgColorProps},on:{changeColor:t.changeColor,close:t.tagClose,tagCreateSubmit:t.tagCreateSubmit,tagCancel:t.tagCancel,back:t.back}}):2==t.tagContent?a("editTag",{attrs:{"edit-tag-list":t.tagList},on:{back:t.back,close:t.tagClose,editBtn:t.editTagClick,deleteBtn:t.deleteBtn}}):t._e(),t._v(" "),a("span",{attrs:{slot:"reference"},on:{click:t.referenceFun},slot:"reference"},[t._t("editIndex")],2)],1)},I=[],D=(a("a15b"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"new-tag-dialog"},[a("flexbox",{staticClass:"tag-dialog-header"},[a("div",{staticClass:"tag-dialog-header__text"},[a("span",{staticClass:"el-icon-arrow-left",on:{click:t.back}}),t._v("\n      "+t._s(t.newTagTitle)+"\n    ")]),t._v(" "),a("i",{staticClass:"el-icon-close icon-close",on:{click:t.close}})]),t._v(" "),a("div",{staticClass:"search"},[a("el-input",{attrs:{maxlength:10,placeholder:"输入标签名，最多十个字符"},model:{value:t.input,callback:function(e){t.input="string"===typeof e?e.trim():e},expression:"input"}}),t._v(" "),a("span",{staticClass:"checked-color",style:{background:t.showBgColor}})],1),t._v(" "),a("div",{staticClass:"color-box"},t._l(t.colorList,(function(e,i){return a("span",{key:i,style:{background:e},on:{click:function(a){t.changeColor(e)}}})}))),t._v(" "),a("div",{staticClass:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:t.tagCreateSubmit,expression:"tagCreateSubmit"}],attrs:{type:"primary"}},[t._v("保存")]),t._v(" "),a("el-button",{on:{click:t.tagCancel}},[t._v("取消")])],1)],1)}),j=[],L={props:{newTagTitle:String,newTagInput:String,bgColorProps:String},data:function(){return{colorList:["#0052CC","#00A3BF","#DE350B","#5243AA","#00875A","#FF991F","#091E42"],input:this.newTagInput,showBgColor:""}},watch:{bgColorProps:function(t){this.showBgColor=t||"#0052CC"}},mounted:function(){this.showBgColor=this.bgColorProps||"#0052CC"},methods:{back:function(){this.$emit("back")},close:function(){this.$emit("close")},changeColor:function(t){this.$emit("changeColor",t)},tagCreateSubmit:function(){this.input?this.$emit("tagCreateSubmit",this.input,this.showBgColor):this.$message.error("请输入标签名")},tagCancel:function(){this.$emit("tagCancel")}}},S=L,O=(a("432b"),Object(g["a"])(S,D,j,!1,null,"51135a51",null)),$=O.exports,A=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"edit-tag-dialog"},[a("flexbox",{staticClass:"tag-dialog-header"},[a("div",{staticClass:"tag-dialog-header__text"},[a("span",{staticClass:"el-icon-arrow-left",on:{click:t.back}}),t._v("\n      标签管理\n    ")]),t._v(" "),a("i",{staticClass:"el-icon-close icon-close",on:{click:t.close}})]),t._v(" "),a("div",{staticClass:"search"},[a("el-input",{attrs:{maxlength:10,placeholder:"输入标签名，最多十个字符"},model:{value:t.searchInput,callback:function(e){t.searchInput=e},expression:"searchInput"}})],1),t._v(" "),a("div",{staticClass:"content"},t._l(t.list,(function(e,i){return a("div",{key:i,staticClass:"tag-list"},[a("span",{staticClass:"tag-name",style:{background:e.color?e.color:"#ccc"}},[t._v("\n        "+t._s(e.name.length>10?e.name.substring(0,10)+"...":e.name)+"\n      ")]),t._v(" "),a("div",{staticClass:"rt"},[a("span",{staticClass:"el-icon-edit",on:{click:function(a){t.editBtn(e)}}}),t._v(" "),a("span",{staticClass:"el-icon-delete",on:{click:function(a){t.deleteBtn(e)}}})])])})))],1)},F=[],U={props:{editTagList:Array},data:function(){return{searchInput:""}},computed:{list:function(){var t=this;return this.editTagList.filter((function(e){return e.name.indexOf(t.searchInput)>-1}))}},watch:{},methods:{back:function(){this.$emit("back")},close:function(){this.$emit("close")},deleteBtn:function(t){this.$emit("deleteBtn",t)},editBtn:function(t){this.$emit("editBtn",t)}}},N=U,V=(a("50cf"),Object(g["a"])(N,A,F,!1,null,"24572cac",null)),P=V.exports,E={components:{NewTag:$,EditTag:P},props:{taskData:{type:Object,default:function(){return{}}},placement:String},data:function(){return{tagShow:!1,tagContent:0,tagSearch:"",tagList:[],newTagType:"create",newTagInput:"",bgColorProps:"",editTagId:""}},computed:{showTagList:function(){for(var t=[],e=0;e<this.tagList.length;e++){var a=this.tagList[e];a.name.indexOf(this.tagSearch)>-1&&t.push(a)}return t},popoverWidth:function(){return 1==this.tagContent?330:2==this.tagContent?400:220},newTagTitle:function(){return"create"===this.newTagType?"创建新标签":"编辑标签"}},watch:{},mounted:function(){},methods:{createTagClick:function(){this.newTagType="create",this.newTagInput="",this.tagContent=1},editTagClick:function(t){this.editTagId=t.labelId,this.newTagType="update",this.tagContent=1,this.bgColorProps=t.color,this.newTagInput=t.name},managementTag:function(){this.tagContent=2},tagSelectClick:function(t,e){var a=this;if(this.$listeners.change)t.check=!t.check,this.$emit("change",this.tagList.filter((function(t){return t.check})));else{this.tagList[e].check=!t.check;var i=this.tagList.filter((function(t){return t.check}));Object(c["J"])({taskId:this.taskData.taskId,ids:i.map((function(t){return t.labelId})).join(",")}).then((function(e){if(t.check){var i=[];a.tagList.forEach((function(t){t.check&&(t.labelName=t.name,i.push(t))})),a.taskData.labelTaskList=i}else a.updateDetailList(t,"delete")})).catch((function(){t.check=!0}))}},updateDetailList:function(t,e){if(this.taskData&&this.taskData.labelTaskList){for(var a=-1,i=0;i<this.taskData.labelTaskList.length;i++){var s=this.taskData.labelTaskList[i];if(s.labelId==t.labelId){a=i;break}}a>=0&&("delete"==e?this.taskData.labelTaskList.splice(a,1):this.taskData.labelTaskList.splice(a,1,t))}},changeColor:function(t){this.bgColorProps=t},tagClose:function(){this.tagShow=!1},tagCreateSubmit:function(t,e){var a=this;"create"==this.newTagType?Object(c["a"])({name:t,color:e}).then((function(t){a.getTagList(),a.back(),a.$message.success("创建成功")})):Object(c["M"])({name:t,labelId:this.editTagId,color:e}).then((function(i){var s,n=Object(r["a"])(a.tagList);try{for(n.s();!(s=n.n()).done;){var o=s.value;o.labelId==a.editTagId&&(o.name=t,o.color=e,o.labelName=o.name,a.updateDetailList(o,"update"))}}catch(l){n.e(l)}finally{n.f()}a.tagContent=2}))},tagCancel:function(){"create"==this.newTagType?(this.tagClose(),this.$message.info("已取消创建")):this.tagContent=2},back:function(){1==this.tagContent?this.tagContent="create"==this.newTagType?0:2:2==this.tagContent&&(this.tagContent=0)},deleteBtn:function(t){var e=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"is-particulars"}).then((function(){Object(c["f"])({labelId:t.labelId}).then((function(a){for(var i in e.tagList)if(e.tagList[i].labelId==t.labelId){e.tagList.splice(i,1);break}e.$message({type:"success",message:"删除成功!"}),e.tagShow=!0})).catch((function(){e.tagShow=!0}))})).catch((function(){e.$message({type:"info",message:"已取消删除"}),e.tagShow=!0}))},getTagList:function(){var t=this;Object(c["w"])({name:""}).then((function(e){var a=e.data||[],i=[];t.tagList.length>0?i=t.tagList.filter((function(t){return t.check})).map((function(t){return t.labelId})):t.taskData&&t.taskData.labelTaskList&&(i=t.taskData.labelTaskList.map((function(t){return t.labelId})));var s,n=Object(r["a"])(a);try{for(n.s();!(s=n.n()).done;){var o=s.value;o.check=i.includes(o.labelId)}}catch(l){n.e(l)}finally{n.f()}t.tagList=a})).catch((function(){}))},referenceFun:function(){this.tagContent=0,this.tagList&&!this.tagList.length&&this.getTagList()}}},B=E,R=(a("5a4a"),Object(g["a"])(B,x,I,!1,null,"b0bb533a",null)),M=R.exports,q=a("02c0"),W=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{},[t.dialogVisible?a("el-dialog",{ref:"wkDialog",attrs:{"append-to-body":!0,"close-on-click-modal":!1,visible:t.dialogVisible,title:"添加工时",width:"800px","custom-class":"no-padding-dialog"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.handleClose}},[a("div",{staticClass:"main"},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"150px"}},t._l(t.fieldList,(function(e,i){return a("el-form-item",{key:i,style:{width:e.width},attrs:{label:e.label,prop:e.field}},["item"==e.type?a("el-autocomplete",{staticStyle:{width:"100%"},attrs:{disabled:e.disable,"fetch-suggestions":t.querySearchAsync,placeholder:e.placeholder},on:{select:t.handleSelect},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.item;return[a("div",{staticClass:"name"},[t._v(t._s(i.name))])]}}]),model:{value:t.itemName,callback:function(e){t.itemName=e},expression:"itemName"}}):"user"==e.type?a("wk-user-select",{staticStyle:{width:"100%"},attrs:{disabled:e.disable,props:t.userSelectProps,radio:""},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}}):"date"==e.type?a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"yyyy-MM-dd HH:mm",placeholder:e.placeholder},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}}):"textarea"==e.type?a("el-input",{attrs:{type:"textarea",placeholder:e.placeholder},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}}):"time"==e.type?a("el-input",{staticClass:"input-with-select",attrs:{placeholder:e.placeholder},on:{change:function(a){t.handleChange(a,e.field)}},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}},[a("el-button",{attrs:{slot:"append",type:"text"},slot:"append"},[t._v("小时")])],1):t._e()],1)}))),t._v(" "),a("div",{staticClass:"btn-wrap",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:t.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[t._v("保存")]),t._v(" "),a("el-button",{nativeOn:{click:function(e){return t.handleClose(e)}}},[t._v("取消")])],1)],1)]):t._e()],1)},H=[],Y=a("5c0a"),z=a("9dba"),G=a("2f62"),Q={name:"CreateWorkTime",components:{WkUserSelect:Y["a"]},mixins:[z["a"]],props:{visible:{type:Boolean,required:!0,default:!1},taskData:{type:Object,default:function(){return{}}},itemType:String,restHours:[String,Number]},data:function(){return{dialogVisible:!1,loading:!1,fieldList:[{type:"time",label:"实际投入时长",field:"actualHour",placeholder:"0",width:"48%"},{type:"time",label:"剩余工时",field:"surplusHours",placeholder:"0",width:"48%"}],ruleForm:{taskId:"",actualHour:"",surplusHours:""},rules:{actualHour:[{required:!0,message:"请输入实际投入时长",trigger:"blur"}]},selectedUserIds:[],selectUserList:[],currentItem:"",itemName:""}},computed:Object(o["a"])(Object(o["a"])({},Object(G["b"])(["userInfo"])),{},{userSelectProps:function(){return{request:l["u"],params:{projectId:this.$route.params.id},isList:!0}}}),watch:{visible:{handler:function(t){t&&this.taskData.taskId&&(this.itemName=this.taskData.name,this.ruleForm.taskId=this.taskData.taskId,this.fieldList[1].placeholder=this.restHours,this.ruleForm.actualHour="",this.ruleForm.surplusHours=""),this.dialogVisible=t},immediate:!0}},methods:{handleClose:function(){this.dialogVisible=!1,this.$emit("update:visible",!1),this.$emit("close")},handleChange:function(t,e){"actualHour"==e&&(!this.restHours||t>=this.restHours?this.fieldList[1].placeholder=0:this.fieldList[1].placeholder=this.restHours-t)},querySearchAsync:function(t,e){var a=this;if(t){var i={name:t,projectId:this.$route.params.id,type:"",pageType:0};Object(c["R"])(i).then((function(i){var s=i.data.list,n=t?s.filter(a.createStateFilter(t)):s;e(n)})).catch((function(){e([])}))}else e([])},createStateFilter:function(t){return function(e){return 0===e.name.toLowerCase().indexOf(t.toLowerCase())}},handleSelect:function(t){this.currentItem=t,this.itemName=t.name},handleConfirm:function(){var t=this;this.$refs.ruleForm.validate((function(e){if(e){t.loading=!0;var a=Object(o["a"])({companyId:t.userInfo.companyId},t.ruleForm);a.surplusHours=a.surplusHours||t.fieldList[1].placeholder,Object(c["b"])(a).then((function(e){t.$message.success("操作成功"),t.$emit("save-success"),t.loading=!1})).catch((function(){t.loading=!1}))}}))}}},J=Q,K=(a("2796"),Object(g["a"])(J,W,H,!1,null,"070ca48c",null)),X=K.exports,Z=a("1557"),tt=a("deea"),et=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"comment-list"},t._l(t.list,(function(e,i){return a("div",{key:i,staticClass:"comment-list-item"},[a("div",{staticClass:"parent-reply reply"},[a("div",{staticClass:"user-info"},[a("xr-avatar",{staticClass:"user-img",attrs:{id:e.user.userId,name:e.user.realname,size:32,src:e.user.img,disabled:!1}}),t._v(" "),a("div",{staticClass:"user-info__bd"},[a("span",{staticClass:"user"},[t._v(t._s(e.user.realname))]),t._v(" "),a("span",{staticClass:"time"},[t._v("\n            "+t._s(t._f("formatTime")(e.createTime))+"\n          ")])])],1),t._v(" "),a("div",{staticClass:"content"},[t._v(t._s(e.content))]),t._v(" "),a("div",{staticClass:"control"},[a("el-button",{staticClass:"reply-btn",attrs:{type:"text"},on:{click:function(e){t.handleToReply(i)}}},[a("i",{staticClass:"wk wk-icon-message-line"}),t._v("\n          回复\n        ")]),t._v(" "),a("el-button",{staticClass:"delete-btn",attrs:{type:"text"},on:{click:function(a){t.handleToDelete(e,i)}}},[a("i",{staticClass:"wk wk-icon-bin"}),t._v("\n          删除\n        ")])],1),t._v(" "),t.replyIndex===String(i)?a("reply-comment",{on:{reply:function(a){t.handleReply(a,e)},close:function(e){t.replyIndex=null}}}):t._e()],1),t._v(" "),e.childCommentList&&e.childCommentList.length>0?t._l(e.childCommentList,(function(e,s){return a("div",{key:s,staticClass:"child-reply-list"},[a("div",{staticClass:"child-reply reply"},[a("div",{staticClass:"user-info"},[a("xr-avatar",{staticClass:"user-img",attrs:{id:e.user.userId,name:e.user.realname,size:34,src:e.user.img,disabled:!1}}),t._v(" "),a("div",{staticClass:"user-info__bd"},[a("span",[t._v("\n                "+t._s(e.user.realname)+"\n              ")]),t._v(" "),a("span",{staticClass:"time"},[t._v("\n                "+t._s(e.createTime)+"\n              ")])])],1),t._v(" "),a("div",{staticClass:"child-content"},[a("span",[t._v("\n              回复 @"+t._s(e.replyUser.realname)+"：\n            ")]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(e.content))])]),t._v(" "),a("div",{staticClass:"control"},[a("el-button",{staticClass:"reply-btn",attrs:{type:"text"},on:{click:function(e){t.handleToReply(i,s)}}},[a("i",{staticClass:"wk wk-icon-message-line"}),t._v("\n              回复\n            ")]),t._v(" "),a("el-button",{staticClass:"delete-btn",attrs:{type:"text"},on:{click:function(a){t.handleToDelete(e,i,s)}}},[a("i",{staticClass:"wk wk-icon-bin"}),t._v("\n              删除\n            ")])],1),t._v(" "),t.replyIndex===i+"-"+s?a("reply-comment",{directives:[{name:"loading",rawName:"v-loading",value:t.commentLoading,expression:"commentLoading"}],on:{reply:function(a){t.handleReply(a,e)},close:function(e){t.replyIndex=null}}}):t._e()],1)])})):t._e()],2)})))},at=[],it=a("74fc"),st=a("5e38"),nt=a.n(st),rt=a("8ed6"),ot=a("ed08"),lt={addRequest:null,addParams:null,replyKey:"pid",replyValueKey:"userId",deleteRequest:null,deleteParams:null},ct={name:"CommentList",components:{ReplyComment:it["a"]},filters:{formatTime:function(t){return Object(ot["g"])(t)}},props:{props:{type:Object,default:function(){return{}}},list:{type:Array,required:!0},showControl:{type:Boolean,default:!0}},data:function(){return{replyIndex:null,commentLoading:!1}},computed:Object(o["a"])(Object(o["a"])({},Object(G["b"])(["userInfo"])),{},{config:function(){return Object(rt["a"])(Object(o["a"])({},lt),this.props||{})}}),methods:{handleToReply:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a="".concat(t).concat(null!==e?"-"+e:"");this.$emit("close-other-reply"),a!==this.replyIndex&&(this.replyIndex=a)},closeReply:function(){this.replyIndex=null},handleReply:function(t,e){var a=this,i={content:nt()(t)},s=null,n=this.replyIndex.split("-"),r=this.list[n[0]];n[1]&&(s=r.childCommentList[n[1]]),r&&(i.mainId=r.commentId,i[this.config.replyKey]=this.getReplyValue(r,this.config.replyValueKey)),s&&(i[this.config.replyKey]=this.getReplyValue(s,this.config.replyValueKey)),this.config.addRequest(Object(o["a"])(Object(o["a"])({},i),this.config.addParams||{})).then((function(t){t.data.user={userId:a.userInfo.userId,realname:a.userInfo.realname,img:a.userInfo.img},t.data.replyUser=s?s.user:r.user,a.list[n[0]].childCommentList.push(t.data),a.replyIndex=null,a.commentLoading=!1})).catch((function(){a.commentLoading=!1}))},getReplyValue:function(t,e){if(e.indexOf(".")<0)return t[e];for(var a=e.split("."),i=t,s=0;s<a.length;s++)if(i=i[a[s]],void 0===i)return"";return i},handleToDelete:function(t,e){var a=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.config.deleteRequest(Object(o["a"])({commentId:t.commentId},a.config.deleteParams||{})).then((function(t){a.$message({type:"success",message:"删除成功!"}),i>=0?a.list[e].childCommentList.splice(i,1):a.$emit("delete",e)}))})).catch((function(){a.$message({type:"info",message:"已取消删除"})}))}}},dt=ct,ut=(a("2a91"),Object(g["a"])(dt,et,at,!1,null,"763147b0",null)),ht=ut.exports,pt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"comment-list"},t._l("activity"===t.type?t.list:t.hoursList,(function(e,i){return a("div",{key:i,staticClass:"comment-list-item"},[a("div",{staticClass:"parent-reply reply"},[a("div",{staticClass:"user-info"},[a("xr-avatar",{staticClass:"user-img",attrs:{id:e.userId,name:e.realname,size:32,src:e.img,disabled:!1}}),t._v(" "),a("div",{staticClass:"user-info__bd"},[a("span",{staticClass:"user"},[t._v(t._s(e.realname))]),t._v(" "),a("span",{staticClass:"time"},[t._v("\n            "+t._s(e.createTime)+"\n          ")])])],1),t._v(" "),a("div",{staticClass:"content"},[t._v(t._s(e.content))])])])})))},mt=[],ft={name:"CommentList",components:{},filters:{},props:{list:{type:Array,required:!0},hoursList:{type:Array,default:function(){return[]}},type:{type:String,required:!0}},data:function(){return{}},methods:{}},bt=ft,vt=(a("86906"),Object(g["a"])(bt,pt,mt,!1,null,"10a136fa",null)),gt=vt.exports,kt=a("c1df"),yt=a.n(kt),Ct=a("6651"),wt={name:"ItemDetail",components:{SlideView:u["a"],WkDetailHeader:h["a"],Tinymce:p["a"],TagIndex:M,SubWorkItem:y,FileCell:tt["a"],WkUserSelect:Y["a"],CommentList:ht,ActivityList:gt,ReplyComment:it["a"],WkHeadSection:C["a"],WkSectionItem:w["a"],WkEditWrap:T["a"],TagView:_["a"],WkQuickCreateBar:q["a"],CreateWorkTime:X,StatusTag:Z["a"]},props:{id:[String,Number],detailIndex:Number,detailSection:Number,noListenerClass:{type:Array,default:function(){return["el-table__body"]}},pageList:Array,projectAuth:{type:Object,default:function(){return null}}},data:function(){var t=this;return{loading:null,projectDetail:null,canShowDetail:!0,ownerUserUnfold:!1,showSearchIteration:!1,currentItem:"",itemName:"",priorityVisible:!1,priorityList:Ct["f"],startTimeOptions:{disabledDate:function(e){return!(!t.taskData||!t.taskData.stopTime)&&yt()(e).isAfter(t.taskData.stopTime)}},stopTimeOptions:{disabledDate:function(e){return!(!t.taskData||!t.taskData.startTime)&&yt()(e).isBefore(t.taskData.startTime)}},addSubtasks:!0,addDescriptionShow:!1,expand:!1,autoUpload:!1,addDescriptionTextarea:"",htmlHeght:0,subTaskDoneNum:0,allData:{},commentsLoading:!1,subTaskID:null,taskData:null,activityList:[],hoursList:[],fileList:[],replyList:[],tabValue:"comment",showEditTitle:!1,descShow:!1,editDesc:!1,childShow:!1,wikiShow:!1,fileShow:!1,workTimeShow:!1,editProgress:!1,childTask:[],handleOperations:[{command:"delete",name:"删除",icon:""}],showEditWorkTime:!1,workTimeRecord:{},itemType:"",allStatusList:[],calcHeight:600,relatedDemandLoading:!1,relatedDemandOptions:[],wrongTypes:[{label:"功能缺陷",key:1},{label:"UI界面问题",key:2},{label:"易用性问题",key:3},{label:"安全问题",key:4},{label:"性能问题",key:5},{label:"代码错误",key:6}],editingObj:{relatedDemandId:!1,wrongType:!1},projectOwnerRoleList:[]}},computed:Object(o["a"])(Object(o["a"])({},Object(G["b"])(["userInfo"])),{},{isWorkbench:function(){return"workbench"===this.$route.name},projectId:function(){var t;return null===(t=this.taskData)||void 0===t?void 0:t.projectId},priority:function(){return this.getPriorityColor(this.taskData.priority)},title:function(){return this.taskData.name},subTitle:function(){return"".concat(this.taskData.createUserName,"创建于").concat(this.taskData.createTime)},isAgileProject:function(){var t;return 2==(null===(t=this.taskData)||void 0===t?void 0:t.projectType)},activityHandle:function(){var t=[{command:"desc",icon:"wk wk-icon-edit-des",label:"编辑描述",auth:"oa.taskExamine"},{command:"child",icon:"wk wk-icon-add-sub",label:"添加子工作项",auth:"crm.contacts.save"},{command:"file",icon:"wk wk-icon-file",label:"上传附件",auth:"crm.contacts.save"},{command:"worktime",icon:"wk wk-icon-time",label:"添加工时",auth:"crm.contacts.save"}];return this.isAgileProject?t:t.filter((function(t){return["desc","relation","file"].includes(t.command)}))},detailList:function(){var t,e=[{label:"所属迭代",formType:"follow",field:"belongIterationName"},{label:"关联需求",formType:"item",field:"relatedDemandId"},{label:"缺陷类型",formType:"wrongType",field:"wrongType"},{label:"处理人",formType:"priority",field:"mainUser"},{label:"优先级",formType:"priority",field:"priority"},{label:"创建者",formType:"createUser",field:"createUserName"},{label:"开始时间",formType:"date",field:"startTime"},{label:"截止时间",formType:"date",field:"stopTime"},{label:"团队成员",formType:"memeber",field:"projectOwnerRoleList"},{label:"进度",formType:"progress",field:"progress"},{label:"预估工时",formType:"futureTime",field:"estimatedManHours"},{label:"工时记录",formType:"timeRecord",field:"taskTimeList"},{label:"更新时间",formType:"date",field:"updateTime"},{label:"创建时间",formType:"date",field:"createTime"}];return this.isAgileProject?4===(null===(t=this.taskData)||void 0===t?void 0:t.type)?e:e.filter((function(t){return!["item","wrongType"].includes(t.formType)})):e.filter((function(t){return!["item","wrongType","follow","progress","futureTime","timeRecord"].includes(t.formType)}))},statusColor:function(){return["",{color:"#0052CC",bgColor:"#DEEBFF"},{color:"#EC8205",bgColor:"#FFEACF"},{color:"#006644",bgColor:"#E3FCEF"}][this.taskData.status]},recordPercentage:function(){return this.workTimeRecord.actualHour/(this.workTimeRecord.actualHour+this.workTimeRecord.surplusHours)*100},ownerListRequest:function(){return this.projectId?l["u"]:null},ownerListParams:function(){return{projectId:this.projectId}},labelList:function(){return this.taskData?this.taskData.labelTaskList||[]:null},tagLabelList:function(){return(this.labelList||[]).map((function(t){return{name:t.name,value:t.color?t.color:"#ccc"}}))},relatedData:function(){var t=0;for(var e in this.allData)t+=this.allData[e].length;return t},commentListProps:function(){return{addRequest:c["E"],addParams:{typeId:this.taskData?this.taskData.taskId:"",type:"1"},replyKey:"pid",replyValueKey:"userId",deleteRequest:c["d"],deleteParams:null}},editAuth:function(){var t,e;return this.isWorkbench?(null===(t=this.projectAuth)||void 0===t||null===(e=t.coordination)||void 0===e?void 0:e.editMatters)||!1:this.$auth("coordination.editMatters","PM")},delAuth:function(){var t,e;return this.isWorkbench?(null===(t=this.projectAuth)||void 0===t||null===(e=t.coordination)||void 0===e?void 0:e.deletMatters)||!1:this.$auth("coordination.deletMatters","PM")},handleAuthOperations:function(){return this.delAuth?this.handleOperations:[]},tabs:function(){var t=[{label:"评论",value:"comment"},{label:"活动",value:"activity"}];return this.projectDetail&&2==this.projectDetail.type&&t.push({label:"工时日志",value:"hours"}),t},ownerUserShowList:function(){var t=this.projectDetail.projectOwnerRoleList||[];return t.length>0?t.slice(0,5):t},ownerUserHideList:function(){var t=this.projectDetail.projectOwnerRoleList||[];return t.length>0?t.slice(5):t}}),watch:{id:function(t){this.initInfo(),this.getDetail(),this.getCommentList(),this.getActivityList()},tabValue:function(){this.getActivityList()}},mounted:function(){var t=this;this.calcHeight=document.documentElement.clientHeight-165,window.onresize=function(){t.calcHeight=document.documentElement.clientHeight-165}},beforeDestroy:function(){},methods:{getProjectDetail:function(){var t=this;this.loading=!0,Object(l["r"])({projectId:this.projectId?this.projectId:this.$route.params.id,taskId:this.id}).then((function(e){t.projectDetail=e.data||{},t.projectOwnerRoleList=e.data.projectOwnerRoleList.map((function(t){return t.userId}))||[],t.loading=!1})).catch((function(){t.loading=!1}))},viewAfterEnter:function(){this.id&&(this.getDetail(),this.getCommentList(),this.getActivityList())},handleUpdateParentList:function(){this.$emit("update-list")},initInfo:function(){this.taskData=null,this.itemType="",this.subTaskDoneNum=0,this.addDescriptionShow=!1,this.priorityVisible=!1,this.addSubtasks=!0,this.addDescriptionTextarea="",this.allData={business:[],contacts:[],contract:[],customer:[],receivables:[]},this.activityList=[],this.fileList=[],this.replyList=[]},getDetail:function(){var t=this;this.loading=!0,Object(c["Q"])({taskId:this.id}).then((function(e){var a,i=e.data||{};i.checked=3==i.status,null!==(a=i.childTaskList)&&void 0!==a&&a.length&&(t.childTask=i.childTaskList.map((function(t){return 3==t.status?t.checked=!0:t.checked=!1,t})),t.childShow=!0),t.fileList=i.file||[],t.fileList.length&&(t.fileShow=!0),i.description&&(t.descShow=!0);var s,n=0,o=i.taskTimeList,l=Object(r["a"])(o);try{for(l.s();!(s=l.n()).done;){var c=s.value;n+=c.actualHour}}catch(d){l.e(d)}finally{l.f()}t.workTimeRecord={actualHour:n,surplusHours:o.length?o[o.length-1].surplusHours:0},t.itemType=["Require","Task","Defects"][i.type-2],t.allData={business:(i.businessList||[]).map((function(t){return t.id&&(t.businessId=t.id),t})),contacts:(i.contactsList||[]).map((function(t){return t.id&&(t.contactsId=t.id),t})),contract:(i.contractList||[]).map((function(t){return t.id&&(t.contractId=t.id),t})),customer:(i.customerList||[]).map((function(t){return t.id&&(t.customerId=t.id),t})),receivables:(i.receivablesList||[]).map((function(t){return t.id&&(t.receivablesId=t.id,t.name=t.customerName),t}))},t.taskData=i,i.relatedDemandId&&(t.relatedDemandOptions=[{name:i.relatedDemandName,taskId:i.relatedDemandId}]),t.getAllStatus(),t.getProjectDetail(),t.loading=!1,t.$nextTick((function(){t.autoUpload=!0})),i.description&&t.updateDescHeight(i.description)})).catch((function(e){t.loading=!1,e&&3007==e.code?t.canShowDetail=!1:t.closeBtn()}))},updateDescHeight:function(t){var e=this;this.$nextTick((function(){e.addDescriptionTextarea=t,setTimeout((function(){var a;t.includes("<img")?document.querySelectorAll(".desc-box img").forEach((function(t){t.onload=function(){e.htmlHeght=e.$refs.descWrap.offsetHeight}})):e.htmlHeght=null===(a=e.$refs.descWrap)||void 0===a?void 0:a.offsetHeight}),0)}))},saveItemTitle:function(){var t=this;this.showEditTitle=!1;var e={name:this.taskData.name,taskId:this.taskData.taskId};Object(c["H"])(e).then((function(e){t.$message.success("操作成功"),t.handleUpdateParentList()})).catch((function(){}))},getAllStatus:function(){var t=this,e={eventId:this.taskData.eventId,projectId:this.projectId};Object(d["b"])(e).then((function(e){t.allStatusList=e.data||[]}))},handleCloseSub:function(t){this.$set(t,"showEdit",!1)},hideProgress:function(){var t=this;this.editProgress=!1;var e={taskId:this.taskData.taskId,progress:this.taskData.progress};Object(c["Z"])(e).then((function(){t.$message.success("操作成功"),t.handleUpdateParentList(),t.getActivityList()})).catch((function(){t.$message.success("操作失败")}))},getRelatedDemandData:function(t){var e=this,a={name:t,projectId:this.projectId,pageType:0,type:2};this.relatedDemandLoading=!0,Object(c["R"])(a).then((function(t){var a=t.data.list||[];if(e.taskData.relatedDemandId){var i=a.find((function(t){return t.taskId===e.taskData.relatedDemandId}));i||a.push({name:e.taskData.relatedDemandName,taskId:e.taskData.relatedDemandId})}e.relatedDemandOptions=a,e.relatedDemandLoading=!1})).catch((function(){e.relatedDemandLoading=!1}))},handleSave:function(t){var e=this,a={companyId:this.userInfo.companyId,type:Ct["e"][this.itemType],projectId:this.projectId,name:t.name,pid:this.taskData.taskId};"edit"==t.type&&(a.taskId=t.subId);var i={add:c["ab"],edit:c["qb"]}[t.type];i(a).then((function(a){var i="edit"==t.type?"编辑子工作项成功":"添加子工作项成功";"edit"==t.type&&(e.childTask[t.index].showEdit=!1),e.$message.success(i),e.getChildTask()})).catch((function(){}))},getChildTask:function(){var t=this,e={taskId:this.id,pageType:0,type:3};Object(c["S"])(e).then((function(e){t.childTask=(e.data.list||[]).map((function(e){return 3==e.status?(e.checked=!0,t.subTaskDoneNum++):e.checked=!1,e})),t.childTask.length&&(t.childShow=!0)})).catch((function(){}))},handlePriorityIcon:function(t){return Object(Ct["c"])(t)},querySearchAsync:function(t,e){var a=this,i=this.taskData.belongIterationName?[{type:"btn",name:"移出迭代"}]:[];if(t){var s={name:t,projectId:this.projectId,type:0,pageType:0};Object(c["T"])(s).then((function(s){var r=s.data.list,o=t?r.filter(a.createStateFilter(t)):r;e([].concat(i,Object(n["a"])(o)))})).catch((function(){e([].concat(i))}))}else e([].concat(i))},createStateFilter:function(t){return function(e){return 0===e.name.toLowerCase().indexOf(t.toLowerCase())}},handleSelect:function(t){var e=this;if("btn"==t.type){var a={taskIds:[this.taskData.taskId],belongIterationId:""};Object(c["D"])(a).then((function(t){e.currentItem="",e.itemName="",e.taskData.belongIterationName="",e.showSearchIteration=!1,e.getDetail(),e.handleUpdateParentList()})).catch((function(){}))}else{var i={taskIds:[this.taskData.taskId],belongIterationId:t.taskId};Object(c["D"])(i).then((function(a){e.currentItem=t,e.itemName=t.name,e.taskData.belongIterationName=t.name,e.showSearchIteration=!1,e.getDetail(),e.handleUpdateParentList()})).catch((function(){}))}},handleWorkTime:function(){var t=this;this.showEditWorkTime=!1;var e={taskId:this.taskData.taskId,estimatedManHours:this.taskData.estimatedManHours};Object(c["X"])(e).then((function(){t.$message.success("操作成功"),t.handleUpdateParentList(),t.getActivityList()})).catch((function(){t.$message.success("操作失败")}))},handleRefresh:function(){this.workTimeShow=!1,this.getDetail(),this.getActivityList()},headerRightClick:function(t){var e=this;"delete"==t&&this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t={taskId:e.id};Object(c["N"])(t).then((function(t){e.$message({type:"success",message:"删除成功"}),e.hideView(),e.handleUpdateParentList()})).catch((function(){}))})).catch((function(){}))},quickCreateClick:function(t){var e=this;switch(t){case"desc":this.addDescriptionShow=!0,this.addDescriptionTextarea=this.taskData.description,this.descShow=!0,this.editDesc=!0;break;case"child":this.childShow=!0,this.$nextTick((function(){e.addSubtasks=!1}));break;case"wiki":this.wikiShow=!0;break;case"file":this.fileShow=!0,this.$nextTick((function(){e.$refs.fileUpload&&e.$refs.fileUpload.$refs["upload-inner"].$refs.input.click()}));break;case"worktime":this.workTimeShow=!0;break}},getIconClass:function(t){var e=t.pid?"sub":t.type;return{2:a("a123"),3:a("94dd"),4:a("6894")}[e]},getActivityList:function(){var t=this,e={taskId:this.id,type:1},a={taskId:this.id,type:2};this.loading=!0,Promise.all([Object(c["u"])(e),Object(c["u"])(a)]).then((function(e){t.activityList=e[0].data,t.hoursList=e[1].data,t.loading=!1})).catch((function(){t.loading=!1}))},getCommentList:function(){var t=this;Object(c["v"])({type:1,taskId:this.id}).then((function(e){t.replyList=e.data})).catch((function(){}))},setItemStatus:function(t){var e=this,a={statusId:t,taskId:this.id};Object(c["r"])(a).then((function(t){e.$message.success("设置成功"),e.getDetail(),e.handleUpdateParentList(),e.getActivityList})).catch((function(){}))},getPermission:function(t){return!!this.editAuth},closeBtn:function(){this.$emit("close")},changePriority:function(t){var e=this;Object(c["Y"])({taskId:this.id,priority:t}).then((function(a){e.taskData.priority=t,e.priorityVisible=!1,e.handleUpdateParentList(),e.getActivityList()})).catch((function(){e.$message.error("编辑失败")}))},httpRequest:function(t){var e=this;this.$wkUploadFile.upload({file:t.file,params:{batchId:this.taskData.batchId}}).then((function(t){var a=t.res;e.getDetail(),e.$message.success("上传成功"),e.refreshLog({taskIds:e.taskData.taskId,operationType:1,fileName:a.data.name})})).catch((function(){}))},accessoryDeleteFun:function(t,e){this.fileList.splice(t,1),this.refreshLog({taskIds:this.taskData.taskId,operationType:3,fileName:e.name})},refreshLog:function(t){var e=this;Object(c["L"])(t).then((function(t){e.getActivityList()})).catch((function(){}))},subtasksCheckbox:function(t,e){var a=this;e?(this.$set(t,"checked",!0),this.subTaskDoneNum++):(this.$set(t,"checked",!1),this.subTaskDoneNum--),Object(c["t"])({taskId:t.taskId,status:e?3:1}).then((function(t){a.$emit("on-handle",{type:"change-sub-task",value:{subdonecount:a.subTaskDoneNum,allcount:a.childTask.length},index:a.detailIndex,section:a.detailSection})})).catch((function(){a.$message.error("子任务标记失败"),e?(a.$set(t,"checked",!1),a.subTaskDoneNum--):(a.$set(t,"checked",!0),a.subTaskDoneNum++)}))},mainUserChange:function(t,e){var a=e.length>0?e[0]:null;this.submiteMainUser(a)},taskUserChange:function(t,e){this.projectOwnerRoleList=t,this.projectDetail.projectOwnerRoleList=e},setTaskUser:function(){Object(c["C"])({projectId:this.projectId?this.projectId:this.$route.params.id,taskId:this.id,userIds:this.projectOwnerRoleList}).then((function(t){})).catch((function(){}))},submiteMainUser:function(t){var e=this;Object(c["F"])({taskId:this.id,mainUserId:t?t.userId:""}).then((function(t){e.getDetail(),e.handleUpdateParentList(),e.getActivityList()})).catch((function(){}))},deleteTime:function(t){this.taskData[t]="",this.timeChange(t,!0)},timeChange:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i={taskId:this.id,startTime:"startTime"==t&&a?"":this.taskData.startTime||"",stopTime:"endTime"==t&&a?"":this.taskData.stopTime||""};Object(c["I"])(i).then((function(){e.$message.success("操作成功"),e.getDetail(),e.handleUpdateParentList(),e.getActivityList()}))},previewImg:function(t){var e=t.target,a=e.tagName,i=e.src;if("IMG"===a){var s=i.split("/");this.$wkPreviewFile.preview({index:0,data:[{url:i,name:s[s.length-1]}]})}},submiteDescription:function(){var t=this;Object(c["G"])({taskId:this.id,description:this.addDescriptionTextarea}).then((function(e){t.addDescriptionShow=!1,t.editDesc=!1,t.$set(t.taskData,"description",t.addDescriptionTextarea),t.updateDescHeight(t.addDescriptionTextarea),t.handleUpdateParentList(),t.$message.success("保存成功")})).catch((function(){}))},cancelEditDesc:function(){this.addDescriptionTextarea=this.taskData.description},relatedDemandChange:function(){var t=this;Object(c["s"])({taskIds:[this.id],relatedDemandId:this.taskData.relatedDemandId}).then((function(e){if(t.taskData.relatedDemandId){var a=t.relatedDemandOptions.find((function(e){return e.taskId===t.taskData.relatedDemandId}));t.$set(t.taskData,"relatedDemandId",a.taskId),t.$set(t.taskData,"relatedDemandName",a.name)}else t.$set(t.taskData,"relatedDemandId",""),t.$set(t.taskData,"relatedDemandName","");t.handleUpdateParentList()})).catch((function(){}))},wrongTypeChange:function(){var t=this;Object(c["bb"])({projectId:this.projectId,taskId:this.id,wrongType:this.taskData.wrongType}).then((function(e){t.handleUpdateParentList(),t.getActivityList()})).catch((function(){}))},editChangeSave:function(){for(var t in this.editingObj)this.editingObj[t]=!1;this.showSearchIteration=!1},editOpen:function(t){var e=this;this.editAuth&&this.$nextTick((function(){"belongIterationName"===t?e.showSearchIteration=!0:e.editingObj[t]=!0}))},handleReply:function(t){var e=this;t&&(this.commentsLoading=!0,Object(c["E"])(Object(o["a"])({content:nt()(t)},this.commentListProps.addParams)).then((function(t){e.getCommentList(),e.$refs.f_reply.commentsTextarea="",e.commentsLoading=!1})).catch((function(){e.commentsLoading=!1})))},deleteComment:function(t){this.replyList.splice(t,1)},deleteSubTask:function(t){var e=this;this.$confirm("此操作将删除该任务, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"is-particulars"}).then((function(){Object(c["N"])(t).then((function(a){var i=e.childTask;for(var s in i)if(i[s].taskId==t.taskId){i.splice(s,1);break}t.checked&&e.subTaskDoneNum--,e.$message.success("子工作项删除成功")})).catch((function(){e.$message.error("子工作项删除失败")}))})).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},editSubTask:function(t){this.subTaskID=t.taskId;var e=this.childTask;for(var a in e)e[a].taskId==t.taskId?this.$set(e[a],"showEdit",!0):this.$set(e[a],"showEdit",!1)},hideView:function(){this.$emit("close"),this.$emit("hide-view")},closeOtherReply:function(t){!t&&this.$refs.comment_list&&this.$refs.comment_list.closeReply()},handleSubTask:function(t){"update"===t.type?this.editSubTask(t.data):"delete"===t.type&&this.deleteSubTask(t.data)}}},Tt=wt,_t=(a("4213"),Object(g["a"])(Tt,i,s,!1,null,"0336944d",null));e["default"]=_t.exports},e85f:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{},[t.dialogVisible?a("el-dialog",{ref:"wkDialog",attrs:{"append-to-body":!0,"close-on-click-modal":!1,visible:t.dialogVisible,title:t.title,width:"400px","custom-class":"no-padding-dialog"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.handleClose}},[a("div",{staticClass:"main"},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"130px"}},t._l(t.fieldList,(function(e,i){return a("el-form-item",{key:i,style:{width:e.width},attrs:{label:e.label,prop:e.field}},["date"==e.type?a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:e.placeholder},model:{value:t.ruleForm[e.field],callback:function(a){t.$set(t.ruleForm,e.field,a)},expression:"ruleForm[item.field]"}}):t._e()],1)}))),t._v(" "),a("div",{staticClass:"btn-wrap",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:t.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[t._v("保存")]),t._v(" "),a("el-button",{nativeOn:{click:function(e){return t.handleClose(e)}}},[t._v("取消")])],1)],1)]):t._e()],1)},s=[],n=a("5530"),r=(a("a9e3"),a("1658")),o=a("9dba"),l=a("2f62"),c={name:"CreateIteration",components:{},mixins:[o["a"]],props:{visible:{type:Boolean,required:!0,default:!1},detailData:{type:Object,default:function(){return{}}},flowType:[String,Number]},data:function(){return{dialogVisible:!1,loading:!1,fieldList:[{type:"date",label:"迭代开始时间",field:"startTime",placeholder:"请选择迭代开始时间",width:"100%"},{type:"date",label:"迭代结束时间",field:"stopTime",placeholder:"请选择迭代结束时间",width:"100%"}],ruleForm:{startTime:"",stopTime:""},rules:{startTime:[{required:!0,message:"请选择迭代开始时间",trigger:"change"}],stopTime:[{required:!0,message:"请选择迭代结束时间",trigger:"change"}]}}},computed:Object(n["a"])(Object(n["a"])({},Object(l["b"])(["userInfo"])),{},{title:function(){return{start:"开始迭代",finish:"结束迭代"}[this.flowType]}}),watch:{visible:{handler:function(t){t&&(this.ruleForm={startTime:this.detailData.startTime,stopTime:this.detailData.stopTime}),this.dialogVisible=t},immediate:!0}},methods:{handleClose:function(){this.dialogVisible=!1,this.$emit("update:visible",!1),this.$emit("close")},handleConfirm:function(){var t=this;this.$refs.ruleForm.validate((function(e){if(e){t.loading=!0;var a=Object(n["a"])(Object(n["a"])({},t.ruleForm),{},{taskId:t.detailData.taskId}),i={start:r["K"],finish:r["h"]}[t.flowType];i(a).then((function(e){t.$message.success("迭代成功"),t.$emit("save-success",{type:"flow"}),t.loading=!1})).catch((function(){t.loading=!1}))}}))}}},d=c,u=(a("806b"),a("2877")),h=Object(u["a"])(d,i,s,!1,null,"842c6b8e",null);e["a"]=h.exports},e926:function(t,e,a){},eb71:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"normal-list"},[a("el-table",{staticStyle:{width:"100%"},attrs:{id:"crm-table","row-height":t.rowHeight,data:t.list,height:t.tableHeight,"cell-class-name":t.cellClassName,"row-key":"taskId","use-virtual":"","highlight-current-row":""},on:{"row-click":t.handleRowClick,"header-dragend":t.handleHeaderDragend}},[t._l(t.fieldList,(function(e,i){return a("el-table-column",{key:i,attrs:{fixed:1===e.isLock,prop:e.prop,label:e.label,width:e.width,"min-width":e.minWidth,"class-name":e.width>60?"column":"","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(i){var s=i.row;return["num"==e.prop?[t._v("#"+t._s(s[e.prop]))]:"name"==e.prop?a("span",{staticClass:"icon-name"},["Iterations"!=t.itemType?a("img",{staticClass:"item-img",attrs:{src:t.getIconClass(s),alt:""}}):t._e(),t._v(" "),a("span",{staticClass:"item-title can-visit--underline"},[t._v(t._s(s[e.prop]))])]):"status"==e.prop&&"Iterations"==t.itemType?a("status-tag",{staticStyle:{"margin-right":"8px"},attrs:{"status-name":s.boardStatusName,type:s.status}}):"status"==e.prop&&"Iterations"!=t.itemType?a("el-dropdown",{staticClass:"priority-box",attrs:{placement:t.placement,disabled:t.getDisabledAuth(s.taskAuth)},on:{command:function(e){t.setItemStatus(e,s.taskId)}},nativeOn:{click:function(e){t.handleDropdown(e,s.type-1)}}},[a("flexbox",[a("status-tag",{staticClass:"cell-tag",attrs:{"status-name":s.boardStatusName,type:s.status}}),t._v(" "),a("i",{staticClass:"wk wk-icon-caret-bottom bottom-icon"})],1),t._v(" "),a("el-dropdown-menu",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"dropdown-menu",staticStyle:{padding:"4px 0",overflow:"auto"},style:{padding:0===t.allStatusList.length?"0px":"auto"},attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.allStatusList,(function(t,e){return a("el-dropdown-item",{key:e,staticStyle:{padding:"0 10px"},attrs:{command:t.id}},[a("div",{staticClass:"dorp-item"},[a("status-tag",{attrs:{"is-drop":!0,type:t.statusType,"status-name":t.statusName}})],1)])})))],1):"mainUserName"==e.prop&&"Iterations"!=t.itemType?a("span",{staticClass:"icon-name"},[a("wk-user-select",{staticStyle:{width:"100%"},attrs:{disabled:t.getDisabledAuth(s.taskAuth),value:s.mainUserId||"",request:t.ownerListRequest,params:{projectId:s.projectId},props:{isList:!0},radio:""},on:{change:function(e){t.mainUserChange(arguments,s.taskId)}}},[a("flexbox",{staticClass:"head-btn",attrs:{slot:"reference"},slot:"reference"},[s.mainUserId?t._e():a("span",{staticClass:"head-btn__text"},[t._v("\n                "+t._s(t.getDisabledAuth(s.taskAuth)?"":"未指定")+"\n              ")]),t._v(" "),a("div",{staticClass:"head-btn__bd"},[s.mainUserId?a("div",{staticClass:"head-btn__bd--name",staticStyle:{"font-size":"14px"}},[t._v("\n                  "+t._s(s.mainUserName)+"\n                ")]):t._e()]),t._v(" "),a("i",{staticClass:"wk wk-icon-caret-bottom bottom-icon"})])],1)],1):"priority"==e.prop&&"Iterations"==t.itemType?a("span",{staticClass:"icon-name"},["Iterations"!=t.itemType?a("img",{staticClass:"item-img",attrs:{src:t.getPriorityPic(s[e.prop]),alt:""}}):t._e(),t._v(" "),a("span",[t._v(t._s(t.getPriority(s[e.prop])))])]):"priority"==e.prop&&"Iterations"!=t.itemType?a("span",{staticClass:"icon-name"},[a("el-dropdown",{staticClass:"priority-box",attrs:{placement:"bottom-start",disabled:t.getDisabledAuth(s.taskAuth)},on:{command:function(e){t.changePriority(e,s.taskId)}}},[a("div",{staticClass:"priority-wrap"},[a("img",{staticClass:"priority-icon",attrs:{src:t.getPriorityPic(s[e.prop]),alt:""}}),t._v(" "),a("span",{staticStyle:{"padding-right":"8px"}},[t._v(t._s(t.getPriority(s[e.prop])))]),t._v(" "),a("i",{staticClass:"wk wk-icon-caret-bottom bottom-icon"})]),t._v(" "),a("el-dropdown-menu",{staticStyle:{"min-width":"100px",padding:"4px 0"},attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.priorityList,(function(e,i){return a("el-dropdown-item",{key:i,staticStyle:{padding:"0 10px"},attrs:{command:e.key}},[a("div",{staticClass:"priority-wrap"},[a("img",{staticClass:"priority-icon",attrs:{src:e.icon,alt:""}}),t._v(t._s(e.label)+"\n                ")])])})))],1)],1):"belongProjectName"==e.prop?a("flexbox",[a("flexbox",{staticClass:"icon-box",attrs:{align:"center",justify:"center"}},[a("i",{staticClass:"icon",class:s.projectIcon})]),t._v(" "),a("span",{staticClass:"project-name text"},[t._v("\n            "+t._s(s[e.prop])+"\n            "),2==s.projectType?a("span",{staticClass:"agile-sign"},[t._v("敏捷")]):1==s.projectType?a("span",{staticClass:"ordinary-sign"},[t._v("普通")]):t._e()])],1):"belongIterationProgress"==e.prop?a("span",[t._v(t._s(Math.round(s[e.prop])||0)+"%")]):"projectAdminRoleList"==e.prop?a("span",[t._v(t._s(t.getAdminList(s[e.prop])))]):"stopTime"==e.prop&&"Iterations"==t.itemType&&s.stopTime?a("el-tag",{staticClass:"project-tag",class:[3==s.status?"is-common":t.getOverTimeStatus(s.stopTime)],attrs:{"disable-transitions":""}},[t._v("\n          "+t._s(t.formatTime(s.stopTime))+"\n        ")]):"stopTime"==e.prop&&"Iterations"!=t.itemType?a("div",{staticClass:"stop-time"},[s.stopTime?t._e():a("span",{staticClass:"head-btn__text"},[t._v("\n            "+t._s(t.getDisabledAuth(s.taskAuth)?"":"未选择")+"\n          ")]),t._v(" "),a("el-date-picker",{attrs:{disabled:t.getDisabledAuth(s.taskAuth),clearable:!1,type:"date","value-format":"yyyy-MM-dd"},on:{change:function(e){t.timeChange(s.stopTime,s.taskId)}},model:{value:s.stopTime,callback:function(e){t.$set(s,"stopTime",e)},expression:"row.stopTime"}}),t._v(" "),s.stopTime?a("el-tag",{staticClass:"project-tag",class:[3==s.status?"is-common":t.getOverTimeStatus(s.stopTime)],attrs:{"disable-transitions":""}},[t._v("\n            "+t._s(t.formatTime(s.stopTime))+"\n          ")]):t._e(),t._v(" "),a("i",{staticClass:"wk wk-icon-caret-bottom bottom-icon"})],1):a("span",[t._v(t._s(s[e.prop]))])]}}])})})),t._v(" "),a("el-table-column")],2)],1)},s=[],n=(a("a15b"),a("d81d"),a("b0c0"),a("1658")),r=a("e04a"),o=a("a535"),l=a("1557"),c=a("5c0a"),d=a("6651"),u=a("b85c"),h=(a("a9e3"),a("4de4"),a("d3b7"),a("caad"),a("14d9"),a("159b"),a("99af"),a("7a1a")),p={components:{StatusTag:l["a"]},props:{tableHeight:Number,rowHeight:Number,projectDetail:Object},data:function(){return{fieldList:[],iterationsList:[{prop:"num",label:"引用ID",width:"70",isLock:1},{prop:"name",label:"迭代名称",width:"220",isLock:1},{prop:"startTime",label:"开始时间",minWidth:"160"},{prop:"stopTime",label:"结束时间",minWidth:"160"},{prop:"status",label:"状态",minWidth:"100"},{prop:"belongIterationProgress",label:"进度"},{prop:"mainUserName",label:"负责人"}],moduleMap:{All:0,Iterations:1,Require:2,Task:3,Defects:4}}},computed:{isAgility:function(){var t;return 2===(null===(t=this.projectDetail)||void 0===t?void 0:t.type)},editAuth:function(){return this.$auth("coordination.editMatters","PM")},isWorkbench:function(){return"workbench"===this.$route.name}},created:function(){this.getField(),this.debouncePostWidthChange=Object(h["debounce"])(500,this.postWidthChange)},mounted:function(){},methods:{getField:function(){var t=this,e={projectId:this.$route.params.id,moduleType:this.moduleMap[this.itemType]};Object(n["P"])(e).then((function(e){var a,i=[],s=Object(u["a"])(e.data||[]);try{for(s.s();!(a=s.n()).done;){var n=a.value,r=n.fieldName,o=n.name,l=n.width;if(3===t.projectDetail.type||"belongProjectName"!==r){var c={prop:r,label:o,width:l};["num","name"].includes(r)&&(c.isLock=1),i.push(c)}}}catch(d){s.e(d)}finally{s.f()}t.fieldList=t.isAgility?i:i.filter((function(t){return!["belongIterationName"].includes(t.prop)}))})).catch((function(){}))},handleHeaderDragend:function(t,e,a,i){this.debouncePostWidthChange(t,a)},postWidthChange:function(t,e){if(e.property){var a;this.fieldList.forEach((function(a){e.property===a.prop&&(a.width=t)}));var i={projectId:this.$route.params.id||0,schemeId:(null===(a=this.projectDetail)||void 0===a?void 0:a.schemeId)||0,moduleType:this.moduleMap[this.itemType],fieldSorts:this.fieldList.map((function(t){return{fieldName:t.prop,name:t.label,width:t.width}}))};Object(n["O"])(i).then((function(t){})).catch((function(){}))}},getList:function(){this.$emit("get-list")},cellClassName:function(t){var e=t.row,a=t.column;t.rowIndex,t.columnIndex;return"name"===a.property?"can-visit--underline":["priority","status","mainUserName","stopTime"].includes(a.property)&&!this.getDisabledAuth(e.taskAuth)&&"Iterations"!=this.itemType?"td-hover":""},handleRowClick:function(t,e,a){"name"==e.property?this.isWorkbench&&"Iterations"===this.$route.query.tab?window.open("".concat(location.origin+location.pathname,"#/project/subs/team/").concat(t.projectId,"?tab=Iterations&type=iteration-detail&taskId=").concat(t.taskId)):this.$emit("handle",{type:"detail",row:t}):"status"==e.property&&this.getStatusList(t)},getDisabledAuth:function(t){return 3===this.projectDetail.type?!t.coordination.editMatters:!this.editAuth}}},m=a("c1df"),f=a.n(m),b={name:"TableList",components:{StatusTag:l["a"],WkUserSelect:c["a"]},mixins:[p],props:{itemType:String,list:{type:Array,default:function(){return[]}}},data:function(){return{loading:!1,priorityList:d["f"],allStatusList:[],placement:"bottom-start"}},computed:{ownerListRequest:function(){return o["u"]}},methods:{getPriority:function(t){return Object(d["a"])(t)},getPriorityPic:function(t){return Object(d["c"])(t)},getAdminList:function(t){return(t||[]).map((function(t){return t.realname})).join()},fomartTime:function(t){return t?f()(t).format("YYYY-MM-DD"):"--"},getIconClass:function(t){return Object(d["b"])(t)},getOverTimeStatus:function(t){var e=this.handleTime(t);return"今天"===e||"明天"===e?"is-near":this.$moment(t).isBefore(this.$moment())?"is-over":"is-common"},formatTime:function(t){if(!t)return null;var e=this.handleTime(t);return(e||this.getTime(t))+"截止"},getTime:function(t){var e=this.$moment().isSame(t,"year");return e?this.$moment(t).format("M月D日"):this.$moment(t).format("YYYY年M月D日")},handleTime:function(t){var e=this.$moment(t).format("YYYY-MM-DD").split("-"),a=new Date,i=[a.getFullYear(),a.getMonth()+1,a.getDate()],s=new Date(a.setTime(a.getTime()+864e5)),n=[s.getFullYear(),s.getMonth()+1,s.getDate()],r=new Date(a.setTime(a.getTime()-1728e5)),o=[r.getFullYear(),r.getMonth()+1,r.getDate()];return i[0]==e[0]&&i[1]==e[1]&&i[2]==e[2]?"今天":n[0]==e[0]&&n[1]==e[1]&&n[2]==e[2]?"明天":o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2]&&"昨天"},timeChange:function(t,e){var a=this,i={taskId:e,stopTime:t||""};Object(n["I"])(i).then((function(){a.$message.success("操作成功"),a.$emit("get-list")})).catch((function(){a.$message.error("编辑失败")}))},changePriority:function(t,e){var a=this;Object(n["Y"])({taskId:e,priority:t}).then((function(t){a.$message.success("操作成功"),a.$emit("get-list")})).catch((function(){a.$message.error("编辑失败")}))},setItemStatus:function(t,e){var a=this,i={statusId:t,taskId:e};Object(n["r"])(i).then((function(t){a.$message.success("设置成功"),a.$emit("get-list")})).catch((function(){a.$message.error("编辑失败")}))},handleDropdown:function(t){var e=document.body.clientHeight,a=t.clientY,i=e-a;this.placement=i>417?"bottom-start":"top-start"},getStatusList:function(t){var e=this,a={projectId:t.projectId,eventId:t.type-1};Object(r["b"])(a).then((function(t){e.allStatusList=t.data||[],e.allStatusList.length||e.$message.error("当前无可选的状态")})).catch((function(){}))},mainUserChange:function(t,e){var a=t[1].length>0?t[1][0]:null;this.submiteMainUser(a,e)},submiteMainUser:function(t,e){var a=this;Object(n["F"])({taskId:e,mainUserId:t?t.userId:""}).then((function(t){a.$message.success("设置成功"),a.$emit("get-list"),"workbench"===a.$route.name&&a.$bus.emit("update-workbench-num")})).catch((function(){}))}}},v=b,g=(a("25f6"),a("2877")),k=Object(g["a"])(v,i,s,!1,null,"5008b6a8",null);e["a"]=k.exports},ed7b:function(t,e,a){"use strict";a("48be")},edcf:function(t,e,a){},ef49:function(t,e,a){"use strict";a("365a")},f183:function(t,e,a){var i=a("23e7"),s=a("e330"),n=a("d012"),r=a("861d"),o=a("1a2d"),l=a("9bf2").f,c=a("241c"),d=a("057f"),u=a("4fad"),h=a("90e3"),p=a("bb2f"),m=!1,f=h("meta"),b=0,v=function(t){l(t,f,{value:{objectID:"O"+b++,weakData:{}}})},g=function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,f)){if(!u(t))return"F";if(!e)return"E";v(t)}return t[f].objectID},k=function(t,e){if(!o(t,f)){if(!u(t))return!0;if(!e)return!1;v(t)}return t[f].weakData},y=function(t){return p&&m&&u(t)&&!o(t,f)&&v(t),t},C=function(){w.enable=function(){},m=!0;var t=c.f,e=s([].splice),a={};a[f]=1,t(a).length&&(c.f=function(a){for(var i=t(a),s=0,n=i.length;s<n;s++)if(i[s]===f){e(i,s,1);break}return i},i({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:d.f}))},w=t.exports={enable:C,fastKey:g,getWeakData:k,onFreeze:y};n[f]=!0},f202:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"iteration-detail"},[a("div",{staticClass:"i-detail-head"},[a("div",{staticClass:"i-left"},[a("i",{staticClass:"wk wk-icon-circle-left back-pre",on:{click:t.backIterationList}}),t._v(" "),a("span",{staticClass:"i-title"},[t._v(t._s(t.newCurrentData.name))]),t._v(" "),a("span",{staticClass:"divider"}),t._v(" "),t._l(t.tabList,(function(e,i){return a("span",{key:i,staticClass:"tab-item",class:{iactive:t.menuIndex==i},on:{click:function(a){t.handleClick(e,i)}}},[t._v("\n        "+t._s(e.name)+"\n      ")])}))],2),t._v(" "),a("div",{staticClass:"i-right"},[a("status-tag",{staticClass:"status-btn",attrs:{type:t.newCurrentData.status}}),t._v(" "),a("el-tooltip",{attrs:{effect:"dark",placement:"top",content:"未规划进迭代并且未完成的事项"}},[a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",staticStyle:{"margin-right":"8px"},attrs:{"data-type":"4","data-id":"9"}})]),t._v(" "),3!=t.newCurrentData.status&&t.btnTxt&&t.$auth("coordination.editIteration","PM")?a("el-button",{attrs:{type:"primary"},on:{click:t.handleIteration}},[t._v("\n        "+t._s(t.btnTxt)+"\n      ")]):t._e(),t._v(" "),t.dropdownsAuth&&t.dropdownsAuth.length>0?a("el-dropdown",{staticStyle:{"margin-left":"8px"},attrs:{trigger:"click"},on:{command:t.dropdownCommand}},[a("el-button",{staticClass:"dropdown-btn",attrs:{icon:"el-icon-more"}}),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.dropdownsAuth,(function(e,i){return a("el-dropdown-item",{key:i,attrs:{icon:e.icon,command:e.command}},[t._v("\n            "+t._s(e.name)+"\n          ")])})))],1):t._e()],1)]),t._v(" "),a(t.tabName,{ref:t.tabName,tag:"component",attrs:{"project-detail":t.projectDetail,"iteration-id":t.iterationId},on:{refresh:t.handleRefresh}}),t._v(" "),t.createVisible?a("create-iteration",{attrs:{visible:t.createVisible,"detail-data":t.newCurrentData,type:"edit","item-type":t.itemType},on:{"update:visible":function(e){t.createVisible=e},"save-success":t.handleRefresh,close:function(e){t.createVisible=!1}}}):t._e(),t._v(" "),t.iterationVisible?a("iteration-flow",{attrs:{visible:t.iterationVisible,"detail-data":t.newCurrentData,"flow-type":t.flowType},on:{"update:visible":function(e){t.iterationVisible=e},"save-success":t.handleRefresh,close:function(e){t.iterationVisible=!1}}}):t._e()],1)},s=[],n=(a("a9e3"),a("4de4"),a("d3b7"),a("14d9"),a("1658")),r=a("1557"),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"iteration-item"},[a("div",{staticClass:"filter-wrapper"},[a("wk-table-header",{attrs:{search:t.search,tabs:t.btnList,props:t.tableHeaderProps.props,"filter-header-props":t.tableHeaderProps.filterHeaderProps},on:{"update:search":function(e){t.search=e},"tabs-change":t.sceneSelect,"event-change":t.tableHeaderHandle}},[a("el-button",{staticClass:"filter-button",attrs:{type:"subtle",icon:"wk wk-screening"},on:{click:function(e){t.filterShow=!0}}},[t._v("\n        高级筛选\n      ")]),t._v(" "),a("el-select",{staticStyle:{"margin-left":"12px"},attrs:{placeholder:"请选择"},on:{change:t.selectChanged},model:{value:t.layout,callback:function(e){t.layout=e},expression:"layout"}},[a("el-option-group",t._l(t.showList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}},[t._v("\n            "+t._s(e.label)+"\n          ")])}))),t._v(" "),t.showBoardSet?a("el-option-group",t._l(t.boardSetList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}},[a("i",{class:e.icon,staticStyle:{"margin-right":"5px"}}),t._v(t._s(e.label)+"\n          ")])}))):t._e()],1),t._v(" "),t.createAuth?[a("el-popover",{attrs:{placement:"bottom",width:"160",trigger:"click","popper-class":"no-padding-popover"}},[a("div",{staticClass:"drop-wrap is-small"},[a("div",{staticClass:"drop-wrap__section"},[a("div",{staticClass:"drop-wrap__content"},t._l(t.quickAddList,(function(e,i){return a("flexbox",{key:i,staticClass:"drop-cell is-small",nativeOn:{click:function(a){t.handleCreate(e)}}},[a("div",{staticClass:"drop-cell__bd"},[t._v(t._s(e.label))])])})))])]),t._v(" "),a("el-button",{staticClass:"common-create-btn",attrs:{slot:"reference",type:"primary"},slot:"reference"},[t._v("新建")])],1)]:t._e()],2)],1),t._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],class:{"common-list-body":"table"!==t.viewType}},["table"==t.viewType?a("table-list",{attrs:{list:t.list,"table-height":t.tableHeight,"row-height":t.rowHeight,"item-type":t.itemType,"project-detail":t.projectDetail,"iteration-id":t.iterationId},on:{"get-list":t.refreshList,handle:t.handleProcess}}):"board"==t.viewType?a("board-list",{ref:"board",attrs:{search:t.search,list:t.list,"item-type":t.itemType,"iteration-id":t.iterationId}}):t._e()],1),t._v(" "),"table"==t.viewType?a("div",{staticClass:"p-contianer"},[a("el-pagination",{staticClass:"p-bar",attrs:{"current-page":t.currentPage,"page-sizes":t.pageSizes,"page-size":t.pageSize,total:t.total,"pager-count":5,layout:"prev, pager, next, sizes, total, jumper"},on:{"update:pageSize":function(e){t.pageSize=e},"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1):t._e(),t._v(" "),t.taskDetailShow?a("item-detail",{ref:"particulars",attrs:{id:t.taskId,"detail-index":t.detailIndex,"no-listener-class":["el-table__body"]},on:{"update-list":t.handleUpdateList,close:function(e){t.taskDetailShow=!1}}}):t._e(),t._v(" "),t.panelSettingShow?a("panel-setting",{attrs:{"item-type":t.itemType,visible:t.panelSettingShow},on:{"update:visible":function(e){t.panelSettingShow=e},update:t.udpatePanelShow}}):t._e(),t._v(" "),t.filterShow?a("list-filter",{attrs:{"list-type":"itemDetail",list:t.filterData},on:{change:t.handleChange,"close-filter":function(e){t.filterShow=!1}}}):t._e(),t._v(" "),t.createItemVisible?a("create-item",{attrs:{visible:t.createItemVisible,"item-type":t.createType,"iteration-id":t.iterationId,"is-agility":t.isAgility},on:{"update:visible":function(e){t.createItemVisible=e},"save-success":t.handleRefresh,close:function(e){t.createItemVisible=!1}}}):t._e(),t._v(" "),t.showPopover?a("crm-relative",{attrs:{radio:!1,visible:t.showPopover,"crm-type":"item"},on:{"update:visible":function(e){t.showPopover=e},close:function(e){t.showPopover=!1},changeCheckout:t.selectItemInfos}}):t._e()],1)},l=[],c=a("b85c"),d=a("5530"),u=(a("ac1f"),a("841c"),a("159b"),a("b0c0"),a("caad"),a("d81d"),a("5d2e")),h=a("e605"),p=a("5577"),m=a("a693"),f=a("9a4b"),b=a("eb71"),v=a("cb01"),g=a("1bd2"),k=a("2f62"),y=a("e297"),C=a.n(y),w=a("6651"),T={name:"IterationItem",components:{WkTableHeader:u["a"],ItemDetail:h["default"],ListFilter:p["a"],CreateItem:m["a"],CrmRelative:f["default"],TableList:b["a"],BoardList:v["a"],PanelSetting:g["a"]},provide:function(){return{iterationId:this.iterationId,rootTabs:{}}},props:{iterationId:[String,Number]},data:function(){return{loading:!1,search:"",layout:"1",itemType:"All",viewType:"table",boardSetList:[{label:"看板视图设置",value:"4"}],sceneLayout:"",btnList:[{label:"全部",value:""},{label:"需求",value:"2"},{label:"任务",value:"3"},{label:"缺陷",value:"4"}],tableHeaderProps:{props:{showFilterView:!1,showExportFields:!1},filterHeaderProps:{maxTabCount:4,tabSetShow:!1,searchPlaceholder:"搜索标题或ID"}},quickAddList:[{type:"relative",label:"关联现有事项"},{type:"Require",label:"需求"},{type:"Task",label:"任务"},{type:"Defects",label:"缺陷"}],list:[],fieldList:[{prop:"num",label:"ID",width:"60",isLock:1},{prop:"name",label:"标题",minWidth:"440",isLock:1},{prop:"priority",label:"优先级",minWidth:"100"},{prop:"status",label:"状态",minWidth:"110"},{prop:"mainUserName",label:"处理人",minWidth:"100"},{prop:"createUserName",label:"创建人",minWidth:"100"},{prop:"belongIterationName",label:"所属迭代",minWidth:"160"},{prop:"stopTime",label:"截止日期",minWidth:"160"},{prop:"createTime",label:"创建日期",minWidth:"160"}],tableHeight:200,rowHeight:44,currentPage:1,pageSize:C.a.get("crmPageSizes")||15,pageSizes:[15,30,60,100],total:0,taskId:"",detailIndex:-1,taskDetailShow:!1,panelSettingShow:!1,filterShow:!1,filterData:[],createItemVisible:!1,createType:"",showPopover:!1}},computed:Object(d["a"])(Object(d["a"])({},Object(k["b"])(["projectDetail"])),{},{createAuth:function(){return this.$auth("coordination.editIteration","PM")},isAgility:function(){var t;return 2===(null===(t=this.projectDetail)||void 0===t?void 0:t.type)},showList:function(){var t=[{label:"平铺视图",value:"1"}];return this.sceneLayout&&t.push({label:"看板视图",value:"3"}),t},showBoardSet:function(){return"3"==this.layout}}),watch:{itemType:{handler:function(t){"Defects"===t||"Task"===t||"Require"===t?(this.viewType="board",this.layout="3"):(this.viewType="table",this.layout="1")}}},mounted:function(){var t=this;window.onresize=function(){t.updateTableHeight()},this.firstLoad()},methods:{firstLoad:function(){this.clearFilterCondition(),this.getList()},refreshList:function(){this.getList()},clearFilterCondition:function(){this.search="",this.filterData=[]},getList:function(){var t=this;this.loading=!0;var e={belongIterationId:this.iterationId,type:this.sceneLayout,projectId:this.$route.params.id,name:this.search,page:this.currentPage,limit:this.pageSize};if(this.filterData&&this.filterData.length&&this.filterData&&this.filterData.length){var a,i=Object(c["a"])(this.filterData);try{for(i.s();!(a=i.n()).done;){var s,r=a.value,o=[],l=Object(c["a"])(r.list);try{for(l.s();!(s=l.n()).done;){var d=s.value;d.checked&&o.push(d.id)}}catch(u){l.e(u)}finally{l.f()}e[r.field]=o}}catch(u){i.e(u)}finally{i.f()}}Object(n["S"])(e).then((function(e){t.list=e.data.list,e.data.totalRow&&Math.ceil(e.data.totalRow/t.pageSize)<t.currentPage&&t.currentPage>1?(t.currentPage=t.currentPage-1,t.getList()):(t.total=e.data.totalRow,t.loading=!1),t.$nextTick((function(){document.querySelector(".el-table__body-wrapper").scrollTop=1})),t.updateTableHeight()})).catch((function(){t.loading=!1}))},updateTableHeight:function(){var t=this,e=document.documentElement.clientHeight;this.$nextTick((function(){var a=t.getTableHead(),i=e-a.$el.clientHeight-275,s=t.rowHeight*t.list.length+41;t.tableHeight=s>i?i:0===t.list.length?200:s,t.tableHeight}))},getTableHead:function(){var t=null;return this.$children.forEach((function(e){e.$options&&"WkTableHeader"===e.$options.name&&(t=e)})),t},tableHeaderHandle:function(t,e){"search"==t&&(this.search=e,this.getList())},sceneSelect:function(t){t.value?this.itemType={2:"Require",3:"Task",4:"Defects"}[t.value]:(this.viewType="table",this.layout="1",this.itemType="All"),this.sceneLayout=t.value,this.updateListOrBoard()},updateListOrBoard:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];"table"==this.viewType?e?this.firstLoad():this.getList():"board"==this.viewType&&(e&&(this.search=""),this.$nextTick((function(){t.$refs.board.getData("",e)})))},handleCreate:function(t){"relative"==t.type?(this.createType=t.type,this.showPopover=!0):["Require","Task","Defects"].includes(t.type)&&(this.createType=t.type,this.createItemVisible=!0)},selectItemInfos:function(t){var e=this,a=t.data,i=void 0===a?[]:a;if(i.length){var s={taskIds:i.map((function(t){return t.taskId})),belongIterationId:this.iterationId};Object(n["D"])(s).then((function(t){e.$message.success("操作成功"),e.getList()})).catch((function(){}))}},handleRefresh:function(){"relative"==this.createType?this.showPopover=!0:(this.createItemVisible=!1,this.updateListOrBoard())},cellClassName:function(t){t.row;var e=t.column;t.rowIndex,t.columnIndex;return"name"===e.property?"can-visit--underline":""},handleRowClick:function(t,e,a){"name"==e.property&&(this.taskId=t.taskId,this.detailIndex=this.getObjIndex(this.list,"taskId",t.taskId),this.taskDetailShow=!0)},getObjIndex:function(t,e,a){for(var i=0;i<t.length;i++){var s=t[i];if(s[e]===a)return i}return null},handleChange:function(t){this.filterData=t,this.getList()},handleUpdateList:function(){this.getList()},handleSizeChange:function(t){C.a.set("crmPageSizes",t),this.pageSize=t,this.getList()},handleCurrentChange:function(t){this.currentPage=t,this.getList()},getPriority:function(t){return Object(w["a"])(t)},getIconClass:function(t){return Object(w["b"])(t)},getPriorityPic:function(t){return Object(w["c"])(t)},getOverTimeStatus:function(t){var e=this.handleTime(t);return"今天"===e||"明天"===e?"is-near":this.$moment(t).isBefore(this.$moment())?"is-over":"is-common"},formatTime:function(t){if(!t)return null;var e=this.handleTime(t);if(e)return e;var a=this.$moment().isSame(t,"year");return a?this.$moment(t).format("M月D日"):this.$moment(t).format("YYYY年M月D日")},handleTime:function(t){var e=this.$moment(t).format("YYYY-MM-DD").split("-"),a=new Date,i=[a.getFullYear(),a.getMonth()+1,a.getDate()],s=new Date(a.setTime(a.getTime()+864e5)),n=[s.getFullYear(),s.getMonth()+1,s.getDate()],r=new Date(a.setTime(a.getTime()-1728e5)),o=[r.getFullYear(),r.getMonth()+1,r.getDate()];return i[0]==e[0]&&i[1]==e[1]&&i[2]==e[2]?"今天":n[0]==e[0]&&n[1]==e[1]&&n[2]==e[2]?"明天":o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2]&&"昨天"},selectChanged:function(t){"4"==t?(this.layout=this.showIndex,this.panelSettingShow=!0):(this.viewType={1:"table",3:"board"}[t],this.layout=t,this.showIndex=t,this.changeViewList())},changeViewList:function(){"table"==this.viewType&&this.getList()},handleProcess:function(t){var e=t.type,a=t.row;"detail"==e&&(1==a.type||(this.taskId=a.taskId,this.detailIndex=this.getObjIndex(this.list,"taskId",a.taskId),this.taskDetailShow=!0))},udpatePanelShow:function(){this.$refs.board.getData(),this.panelSettingShow=!1}}},_=T,x=(a("9821"),a("2877")),I=Object(x["a"])(_,o,l,!1,null,"26b13f1b",null),D=I.exports,j=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"o-wrap"},[a("div",{staticClass:"o-right"},[t._m(0),t._v(" "),t.taskTrend&&t.taskTrend.projectTaskNumVOEnd?a("div",{ref:"trendChart",staticClass:"chart"}):t._e(),t._v(" "),t.taskTrend&&!t.taskTrend.projectTaskNumVOEnd?a("div",{staticClass:"tips"},[t.detail.startTime&&t.detail.stopTime?1==t.detail.status?a("span",[t._v("迭代未开始，暂无数据")]):t._e():a("span",[t._v("迭代周期未设置，暂无数据")])]):t._e(),t._v(" "),t._m(1),t._v(" "),t.taskBurnout?a("div",{ref:"chart",staticClass:"chart"}):t._e(),t._v(" "),t.taskBurnout?t._e():a("div",{staticClass:"tips"},[t.detail.startTime&&t.detail.stopTime?1==t.detail.status?a("span",[t._v("迭代未开始，暂无数据")]):t._e():a("span",[t._v("迭代周期未设置，暂无数据")])]),t._v(" "),t._m(2),t._v(" "),a("div",{ref:"barChart",staticClass:"chart"}),t._v(" "),a("div",{staticStyle:{"min-height":"240px","margin-bottom":"48px"}},[t._m(3),t._v(" "),t.list?a("div",{directives:[{name:"empty",rawName:"v-empty",value:t.list,expression:"list"}],staticClass:"rc-cont",staticStyle:{"padding-right":"10%"}},t._l(t.list,(function(e,i){return a("flexbox",{key:i,staticClass:"ha-cont",attrs:{align:"stretch",justify:"flex-start"}},[a("div",{staticClass:"ha-week"},[t._v(t._s(t._f("filterTimestampToFormatTime")(e.createTime,"MM-DD dddd")))]),t._v(" "),a("div",{staticClass:"ha-circle"}),t._v(" "),a("div",{staticClass:"ha-time"},[t._v(t._s(t._f("filterTimestampToFormatTime")(e.createTime,"HH:mm")))]),t._v(" "),e?a("xr-avatar",{staticClass:"ha-img",attrs:{id:e.logId,name:e.realname,size:32,src:e.img,disabled:!1}}):t._e(),t._v(" "),e.user?a("div",{staticClass:"ha-name"},[t._v(t._s(e.user.realname))]):t._e(),t._v(" "),a("div",{staticClass:"ha-content"},[a("p",[t._v(t._s(e.content))])]),t._v(" "),a("div",{staticClass:"ha-line"})],1)}))):t._e()])]),t._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"o-left"},[a("div",{staticClass:"title"},[a("span",{staticClass:"name"},[t._v("迭代信息")]),t._v(" "),a("el-button",{staticStyle:{padding:"0","background-color":"#fff"},attrs:{icon:"el-icon-edit",disabled:!t.$auth("coordination.editIteration","PM")},on:{click:t.editIteration}})],1),t._v(" "),a("div",{staticClass:"info"},t._l(t.infoList,(function(e,i){return a("div",{key:i,staticClass:"infoItem"},[a("span",[t._v(t._s(e.title))]),t._v(" "),"status"==e.type?a("div",[a("status-tag",{attrs:{type:t.detail.status}})],1):"progress"==e.type?a("div",{staticStyle:{flex:"1","text-align":"right"}},[a("div",{staticClass:"progress"},[a("div",{staticClass:"strip"},[t.computeNum(3)?a("span",{staticStyle:{"background-color":"#36b37e"},style:{width:t.computeNum(3)}}):t._e(),t._v(" "),t.computeNum(2)?a("span",{staticStyle:{"background-color":"#ffab00"},style:{width:t.computeNum(2)}}):t._e(),t._v(" "),t.computeNum(1)?a("span",{staticStyle:{"background-color":"#0052cc"},style:{width:t.computeNum(1)}}):t._e()]),t._v(" "),a("span",{staticClass:"text"},[t._v("\n              "+t._s(Math.round(100*(t.matterList.filter((function(t){return 3==t.status})).length||0)/t.matterList.length)||0)+"%\n            ")])])]):"director"==e.type?a("div",[t._v("\n          "+t._s(t.detail.mainUserName)+"\n          ")]):"member"==e.type?a("div",[a("flexbox",{staticClass:"participant-bd",attrs:{align:"center",justify:"flex-end",wrap:"wrap"}},[t._l(t.ownerUserShowList,(function(e,i){return a("span",{key:i,class:["owner-list",{"owner-list-fold":t.projectDetail.projectOwnerRoleList.length<5}]},[a("xr-avatar",{staticClass:"user-img",attrs:{id:e.userId,name:e.realname,size:24,src:e.img}})],1)})),t._v(" "),t.projectDetail.projectOwnerRoleList.length>5?a("el-dropdown",{attrs:{trigger:"click","hide-on-click":!1}},[a("el-button",{staticClass:"dropdown-btn owner-list-button"},[t._v("\n                +"+t._s(t.projectDetail.projectOwnerRoleList.length-5)+"\n              ")]),t._v(" "),a("el-dropdown-menu",{staticClass:"owner-list-dropdown",attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.ownerUserHideList,(function(e,i){return a("el-dropdown-item",{key:i,staticClass:"owner-list-dropdown-list"},[a("xr-avatar",{staticClass:"owner-list-dropdown-img",staticStyle:{"margin-right":"10px"},attrs:{id:e.userId,name:e.realname,size:24,src:e.img}}),t._v(" "),a("p",{staticClass:"owner-list-dropdown-text"},[t._v(t._s(e.realname)+" ")])],1)})))],1):t._e()],2)],1):a("div",[t._v("\n          "+t._s(t.time)+"\n        ")])])}))),t._v(" "),a("div",{staticClass:"title"},[a("span",{staticClass:"name"},[t._v("总事项数")]),t._v(" "),a("span",[t._v(t._s(t.matterList.length||0))])]),t._v(" "),a("div",{staticClass:"info"},t._l(t.statusList,(function(e,i){return a("div",{key:i,staticClass:"infoItem"},[a("span",[a("i",{class:e.icon,style:{color:e.color}}),t._v(" "),a("span",[t._v(t._s(e.title))])]),t._v(" "),a("span",[t._v(t._s(t.matterList.filter((function(t){return t.status==e.status})).length||0))])])}))),t._v(" "),t._m(4),t._v(" "),a("div",{staticClass:"target"},[a("span",[t._v(t._s(t.detail.target||"--"))])])]),t._v(" "),t.editIterationVisible?a("create-iteration",{attrs:{visible:t.editIterationVisible,"detail-data":t.detail,type:"edit"},on:{"update:visible":function(e){t.editIterationVisible=e},"save-success":t.handleRefresh,close:function(e){t.editIterationVisible=!1}}}):t._e()],1)},L=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"title"},[a("span",{staticClass:"name"},[t._v("事项状态趋势")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"title"},[a("span",{staticClass:"name"},[t._v("燃尽图")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"title"},[a("span",{staticClass:"name"},[t._v("\n        事项分布\n        "),a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",staticStyle:{"margin-right":"8px"},attrs:{"data-type":"4","data-id":"9"}})])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"title"},[a("span",{staticClass:"name",staticStyle:{"margin-top":"48px"}},[t._v("活动日志")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"title"},[a("span",{staticClass:"name"},[t._v("迭代目标")])])}],S=(a("fb6a"),a("3ca3"),a("ddb0"),a("5868")),O=a("313e"),$=a("a347"),A=a.n($),F=a("ed08"),U={components:{},props:{},data:function(){return{charts:[],trendOption:{tooltip:{trigger:"axis"},legend:{orient:"vertical",align:"left",x:"right",y:"top",icon:"roundRect",itemWidth:12,itemHeight:8,data:["已完成","进行中","未开始"]},grid:{top:"8px",left:"0",right:"80px",bottom:"24px",containLabel:!0},xAxis:{type:"category",boundaryGap:["20%","20%"],axisTick:{alignWithLabel:!0},axisLabel:{color:A.a.colorBlack,fontWeight:A.a.axisLabelFontWeight,minInterval:1,formatter:function(t){return O["a"].formatTime("MM-dd",new Date(t))}},axisLine:{lineStyle:{color:A.a.axisLineColor}}},yAxis:{type:"value",minInterval:1},series:[{name:"已完成",type:"line",data:[0,2,3,4,2,1,2],itemStyle:{color:"#36B37E"}},{name:"进行中",type:"line",data:[2,2,3,3,2,4,2],itemStyle:{color:"#FFAB00"}},{name:"未开始",type:"line",data:[0,0,1,3,5,4,2],itemStyle:{color:"#0065FF"}}]},chartOption:{color:["#0052CC"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{orient:"vertical",align:"left",x:"right",y:"top",icon:"roundRect",itemWidth:12,itemHeight:3,data:["理想剩余","实际剩余"]},grid:{top:"8px",left:"0",right:"80px",bottom:"24px",containLabel:!0},xAxis:{type:"category",boundaryGap:["20%","20%"],axisTick:{alignWithLabel:!0},axisLabel:{color:A.a.colorBlack,fontWeight:A.a.axisLabelFontWeight,minInterval:2,formatter:function(t){return O["a"].formatTime("MM-dd",new Date(t))}},axisLine:{lineStyle:{color:A.a.axisLineColor}}},yAxis:{type:"value",minInterval:5,axisTick:{show:!1},axisLine:{lineStyle:{width:0}},axisLabel:{color:A.a.colorBlack,fontWeight:A.a.axisLabelFontWeight},splitLine:{lineStyle:{color:A.a.axisLineColor}}},series:[{name:"理想剩余",data:[],type:"line",areaStyle:{color:new O["b"].LinearGradient(0,0,0,1,[{offset:0,color:"rgba(0, 82, 204, 0.2)"}])},itemStyle:{normal:{color:"#C1C7D0",lineStyle:{width:1,color:"#C1C7D0"}}}},{name:"实际剩余",type:"line",data:[],areaStyle:{color:new O["b"].LinearGradient(0,0,0,1,[{offset:0,color:"rgba(193, 199, 208, 0.2)"}])},itemStyle:{normal:{color:"#0065FF",lineStyle:{width:1,color:"#0065FF"}}}}]},barChartOption:{tooltip:{show:!0,trigger:"axis",axisPointer:{type:"shadow"}},legend:{orient:"horizontal",x:"center",y:"bottom",icon:"roundRect",itemWidth:12,itemHeight:8,data:["已完成","进行中","未开始"]},grid:{top:"8px",left:"0",right:"80px",bottom:"32px",containLabel:!0},xAxis:{type:"value"},yAxis:[{type:"category",axisLabel:{color:"#6B778C"},axisLine:{show:!0,lineStyle:{color:"#DFE1E6",type:"solid"}},data:["需求","任务","缺陷"]}],series:[{name:"已完成",type:"bar",barWidth:5,stack:"total",emphasis:{focus:"series"},data:[1,2,1,2],itemStyle:{color:"#36B37E"}},{name:"进行中",type:"bar",barWidth:5,stack:"total",emphasis:{focus:"series"},data:[2,1,2,1],itemStyle:{color:"#FFAB00"}},{name:"未开始",type:"bar",barWidth:5,stack:"total",data:[1,1,2,2],itemStyle:{color:"#0065FF"}}]}}},watch:{},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{initChart:function(){if(this.charts=[],this.taskBurnout){var t=[],e=[],a=[];this.taskBurnout.forEach((function(i){t.push(i.updateTime),e.push(i.forecastTime||0),a.push(i.surplus||0)}));var i=this.$refs.chart,s=O["c"](i),n=Object(F["r"])(this.chartOption);n.xAxis.data=t,n.series[0].data=[[0,e[0]],[t.length-1,0]],n.series[1].data=a,s.setOption(n,!0),this.charts.push(s)}if(this.taskTrend.projectTaskNumVOEnd){var r=this.$refs.trendChart,o=O["c"](r),l=Object(F["r"])(this.trendOption),c=[],d=[],u=[],h=[];this.taskTrend.projectTaskNumVOEnd.forEach((function(t){c.push(t.updateTime),d.push(t.num)})),this.taskTrend.projectTaskNumVOsRun.forEach((function(t){u.push(t.num)})),this.taskTrend.projectTaskNumVOsNoStart.forEach((function(t){h.push(t.num)})),l.xAxis.data=c,l.series[0].data=d,l.series[1].data=u,l.series[2].data=h,o.setOption(l,!0),this.charts.push(o)}var p=this.$refs.barChart,m=O["c"](p),f=Object(F["r"])(this.barChartOption),b=this.taskEvent,v=[[b.demandEndNum||0,b.taskEndNum||0,b.defectsEndNum||0],[b.demandRunNum||0,b.taskRunNum||0,b.defectsRunNum||0],[b.demandNoStartNum||0,b.taskNoStartNum||0,b.defectsNoStartNum||0]];f.series.forEach((function(t,e){t.data=v[e]})),m.setOption(f,!0),this.charts.push(m),window.addEventListener("resize",this.resizeCallback)},resizeCallback:function(){this.charts.forEach((function(t){t.resize()}))}}},N=a("c1df"),V=a.n(N),P=a("6bfe"),E={name:"IterationOverview",components:{StatusTag:r["a"],CreateIteration:S["a"]},mixins:[U],props:{iterationId:[String,Number],projectDetail:Object},data:function(){return{infoList:[],statusList:[],loading:!1,detail:{},list:[],matterList:[],taskTrend:null,taskBurnout:null,taskEvent:null,editIterationVisible:!1}},computed:{time:function(){return(this.detail.startTime?V()(this.detail.startTime).format("YYYY-MM-DD"):"--")+"至"+(this.detail.stopTime?V()(this.detail.stopTime).format("YYYY-MM-DD"):"--")},ownerUserShowList:function(){var t=this.projectDetail.projectOwnerRoleList||[];return t.length>0?t.slice(0,5):t},ownerUserHideList:function(){var t=this.projectDetail.projectOwnerRoleList||[];return t.length>0?t.slice(5):t}},created:function(){this.getAllInfo()},mounted:function(){},methods:{getAllInfo:function(){this.getInfo(),this.getMatterList(),this.getList(),this.getDetail(),this.getChartData()},getInfo:function(){this.infoList=[{title:"迭代状态",type:"status",prop:"status"},{title:"迭代周期",type:"",prop:"cycle"},{title:"迭代进度",type:"progress",prop:"progress"},{title:"负责人",type:"director",prop:"realname"},{title:"团队成员",type:"member",prop:"users"}],this.statusList=[{title:"已完成",prop:"finishedCount",icon:"wk wk-icon-success",color:"#36B37E",status:3},{title:"进行中",prop:"notStartCount",icon:"wk wk-icon-in-review",color:"#FFAB00",status:2},{title:"未开始",prop:"underwayCount",icon:"wk wk-icon-uncommitted",color:"#0052CC",status:1}]},getDetail:function(){var t=this,e={taskId:this.iterationId};Object(n["g"])(e).then((function(e){t.detail=e.data})).catch((function(){}))},computeNum:function(t){var e=this.matterList.filter((function(e){return e.status==t})).length||0,a=Math.round(150*e/this.matterList.length||0);return 0!=a&&a+"px"},editIteration:function(){this.editIterationVisible=!0},handleRefresh:function(){this.editIterationVisible=!1,this.$emit("refresh",{type:"edit"}),this.getDetail(),this.getChartData()},getChartData:function(){var t=this,e={projectId:this.$route.params.id,taskId:this.iterationId};Promise.all([Object(n["l"])(e),Object(n["j"])(e),Object(n["k"])(e)]).then((function(e){t.taskTrend=e[0].data,t.taskEvent=e[1].data,t.taskBurnout=e[2].data,t.$nextTick((function(){t.initChart()}))}))},getMatterList:function(t){var e=this;this.loading=!0;var a={belongIterationId:this.iterationId,type:"",projectId:this.$route.params.id,pageType:0};Object(n["S"])(a).then((function(t){e.matterList=t.data.list,t.data.totalRow&&Math.ceil(t.data.totalRow/e.pageSize)<e.currentPage&&e.currentPage>1?(e.currentPage=e.currentPage-1,e.getMatterList()):(e.total=t.data.totalRow,e.loading=!1),e.$nextTick((function(){document.querySelector(".el-table__body-wrapper").scrollTop=1})),e.updateTableHeight()})).catch((function(){e.loading=!1}))},getList:function(){var t=this;Object(n["u"])({taskId:this.iterationId,type:1}).then((function(e){t.list=e.data||[]})).catch((function(){}))},isObject:function(t){return Object(P["c"])(t)}}},B=E,R=(a("a1c1"),Object(x["a"])(B,j,L,!1,null,"1f780d52",null)),M=R.exports,q=a("e85f"),W={name:"IterationDetail",components:{Item:D,Overview:M,StatusTag:r["a"],CreateIteration:S["a"],IterationFlow:q["a"]},props:{iterationId:[String,Number],projectDetail:Object},data:function(){return{dropdowns:[{command:"edit",name:"编辑",icon:"wk wk-import",auth:"editIteration"},{command:"del",name:"删除",icon:"wk wk-import",auth:"deleteIteration"}],tabName:"Item",menuIndex:0,tabList:[{name:"事项",tab:"Item"},{name:"概览与统计",tab:"Overview"}],createVisible:!1,itemType:"iteration",newCurrentData:{},iterationVisible:!1,flowType:""}},computed:{btnTxt:function(){return 1==this.newCurrentData.status?"开始迭代":2==this.newCurrentData.status?"完成迭代":""},dropdownsAuth:function(){var t=this;return this.dropdowns.filter((function(e){return t.$auth(e.auth,"PM")}))}},created:function(){this.getDetail()},mounted:function(){var t=this;this.$bus.on("refresh-item-or-overview",(function(){t.refreshItemOrOverview()}))},destroyed:function(){this.$bus.off("refresh-item-or-overview")},methods:{dropdownCommand:function(t){var e=this;"edit"==t?this.createVisible=!0:"del"==t&&this.$confirm("确认删除么?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t={taskId:e.newCurrentData.taskId};Object(n["e"])(t).then((function(t){e.$message.success("当前迭代已经被删除"),e.backIterationList()})).catch((function(){e.$message.error("操作失败")}))})).catch((function(){}))},getDetail:function(){var t=this,e={taskId:this.iterationId};Object(n["g"])(e).then((function(e){t.newCurrentData=e.data})).catch((function(){}))},refreshItemList:function(){this.$refs.item.getList()},backIterationList:function(){var t=this.$route.query.taskId;t&&this.$router.push({query:{tab:"Iterations"}}),this.$emit("change",{type:"main"})},handleIteration:function(){1==this.newCurrentData.status?this.flowType="start":2==this.newCurrentData.status&&(this.flowType="finish"),this.iterationVisible=!0},handleRefresh:function(t){var e=t.type;"flow"==e?this.iterationVisible=!1:this.createVisible=!1,this.getDetail(),this.refreshItemList()},refreshItemOrOverview:function(){"Item"===this.tabName?this.$refs.Item.updateListOrBoard(!0):this.$refs.Overview.getAllInfo()},handleClick:function(t,e){this.tabName=t.tab,this.menuIndex=e}}},H=W,Y=(a("abfd"),Object(x["a"])(H,i,s,!1,null,"00ffe7fe",null));e["a"]=Y.exports},f49d:function(t,e,a){"use strict";a("08ab")},f5d2:function(t,e,a){"use strict";a("7b96")}}]);