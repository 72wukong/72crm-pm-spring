(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4ea6ef96"],{1106:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"project-table"},[i("div",{staticClass:"filter-wrapper"},[i("wk-filter-header",{attrs:{search:e.keywords,props:e.config,tabs:e.myGroupList},on:{"update:search":function(t){e.keywords=t},"event-change":e.handleFilterEvt,"tabs-change":e.sceneSelect}},[e.activeSortField?i("el-dropdown",{attrs:{slot:"right"},on:{command:e.handleSort},slot:"right"},[i("el-button",[i("i",{staticClass:"sort-icon wk wk-iphone-sorting"}),e._v("\n          "+e._s(e.activeSortField.name)+"\n        ")]),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.sortFieldList,(function(t){return i("el-dropdown-item",{key:t.fieldName,attrs:{command:t.fieldName}},[e._v("\n            "+e._s(t.name)+"\n          ")])})))],1):e._e(),e._v(" "),"participate"==e.type?i("template",{slot:"dropdownMore"},e._l(e.groupOptionsList,(function(t,a){return i("el-dropdown-item",{key:t.value,attrs:{divided:0===a,command:t.value}},[e._v("\n          "+e._s(t.label)+"\n        ")])}))):e._e()],2)],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"table",attrs:{data:e.tableData,height:"participate"==e.type?e.participateHeight:e.tableHeight},on:{"row-click":e.handleRowClick}},[i("el-table-column",{attrs:{label:"项目名称",prop:"name",width:"280",fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("flexbox",[i("flexbox",{staticClass:"icon-box",attrs:{align:"center",justify:"center"}},[i("i",{staticClass:"icon",class:t.row.icon})]),e._v(" "),i("span",{staticClass:"can-visit--underline project-name text"},[e._v("\n            "+e._s(t.row.name)+"\n            "),2==t.row.type?i("span",{staticClass:"agile-sign"},[e._v("敏捷")]):1==t.row.type?i("span",{staticClass:"ordinary-sign"},[e._v("普通")]):e._e()])],1)]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"完成度",width:"280"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("flexbox",[i("flexbox-item",[i("el-progress",{attrs:{percentage:Math.round(100*a.finishedCount/(a.finishedCount+a.notStartCount+a.underwayCount))||0,"show-text":!1}})],1),e._v(" "),i("span",{staticClass:"text"},[e._v(e._s(a.finishedCount)+"/"+e._s(a.notStartCount)+"/"+e._s(a.underwayCount))])],1)]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"170",label:"截止时间"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return a.stopTime?[i("el-tag",{staticClass:"project-tag",class:[e.getOverTimeStatus(a.stopTime)],attrs:{"disable-transitions":""}},[e._v("\n          "+e._s(e.formatTime(a.stopTime)+"截止")+"\n        ")])]:void 0}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"180"}}),e._v(" "),i("el-table-column",{attrs:{"min-width":"170",label:"管理员",formatter:e.formatter}}),e._v(" "),"all"!==e.type?i("el-table-column",{attrs:{width:"60",fixed:"right",align:"center"},scopedSlots:e._u([{key:"header",fn:function(e){return[i("i",{staticClass:"el-icon-star-off focus-icon is-disabled"})]}},{key:"default",fn:function(t){return[i("el-tooltip",{attrs:{content:1==t.row.collectStatus?"添加星标":"取消星标",effect:"dark",placement:"top"}},[i("el-button",{staticClass:"focus-btn",class:{active:2==t.row.collectStatus},attrs:{type:"text",icon:2==t.row.collectStatus?"wk wk-focus-on focus-icon active":"el-icon-star-off focus-icon"},on:{click:function(i){e.handleToggleFocus(t.row)}}})],1)]}}])}):e._e(),e._v(" "),i("el-table-column",{attrs:{width:"90",fixed:"right",align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.commandAuthList(t.row).length?i("el-dropdown",{on:{command:function(i){e.handleCommand(i,t.row)}}},[i("el-button",{attrs:{icon:"el-icon-more",type:"text"}}),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown",{on:{command:function(i){e.handleCommand(i,t.row)}}},[e._l(e.commandAuthList(t.row)||[],(function(t,a){return i("el-dropdown-item",{key:a,style:{color:t.color?t.color:""},attrs:{command:t.value}},[e._v("\n                "+e._s(t.label)+"\n              ")])})),e._v(" "),i("el-dropdown-menu",{staticClass:"groupCard",attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.myGroupList.filter((function(e){return e.value&&0!=e.value})),(function(t,a){return i("el-dropdown-item",{key:a,attrs:{command:e.handlerCommand("move",t.value)}},[e._v(e._s(t.label))])})))],2)],1)],1):e._e()]}}])})],1),e._v(" "),i("div",{staticClass:"p-contianer"},[i("el-pagination",{staticClass:"p-bar",attrs:{"current-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.pageSize,total:e.total,"pager-count":5,layout:"prev, pager, next, sizes, total, jumper"},on:{"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),e.groupDialogVisible?i("group-manage-dialog",{attrs:{"list-data":e.myGroupList,visible:e.groupDialogVisible},on:{"update:visible":function(t){e.groupDialogVisible=t},addGroup:e.addGroup,close:function(t){e.groupDialogVisible=!1}}}):e._e(),e._v(" "),e.createGroupDialogVisible?i("create-group-dialog",{attrs:{visible:e.createGroupDialogVisible},on:{"update:visible":function(t){e.createGroupDialogVisible=t},addGroup:e.addGroup,close:function(t){e.createGroupDialogVisible=!1}}}):e._e()],1)},o=[],s=i("5530"),n=(i("caad"),i("3c65"),i("4de4"),i("d3b7"),i("7db0"),i("a15b"),i("2532"),i("14d9"),i("b0c0"),i("a535")),l=i("1bfc"),r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{ref:"wkDialog",attrs:{"append-to-body":"",visible:e.dialogVisible,title:"新建分组",width:"500px","custom-class":"no-padding-dialog"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleCancel}},[i("div",{staticClass:"group-manage"},[i("el-input",{attrs:{maxlength:20,placeholder:"请输入分组名称"},model:{value:e.groupName,callback:function(t){e.groupName="string"===typeof t?t.trim():t},expression:"groupName"}})],1),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("创建")]),e._v(" "),i("el-button",{on:{click:e.handleCancel}},[e._v("取消")])],1)])},c=[],u=(i("d81d"),i("9dba")),d={name:"GroupManageDialog",components:{},mixins:[u["a"]],props:{visible:Boolean,listData:{type:Array,default:function(){return[]}}},data:function(){return{loading:!1,dialogVisible:!1,groupName:"",groupList:[],dragOptions:{sort:!0,handle:".grid",draggable:".sortable"}}},watch:{visible:{handler:function(){this.dialogVisible=this.visible},immediate:!0}},methods:{handleAdd:function(){var e=this;if(this.groupName){var t=this.groupList.map((function(e){return e.label}));if(t.includes(this.groupName))this.$message.error("分组名称不能重复");else{var i={name:this.groupName};this.loading=!0,Object(n["e"])(i).then((function(t){e.$emit("addGroup"),e.$emit("close"),e.loading=!1,e.$message.success("添加成功")})).catch((function(){e.loading=!1})),this.groupName=""}}else this.$message.error("分组名称不能为空")},handleCancel:function(){this.dialogVisible=!1,this.$emit("close")}}},p=d,m=(i("f084"),i("2877")),f=Object(m["a"])(p,r,c,!1,null,"61543afc",null),h=f.exports,g=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{ref:"wkDialog",attrs:{"append-to-body":"",visible:e.dialogVisible,title:"管理分组",width:"500px","custom-class":"no-padding-dialog"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleCancel}},[i("div",{staticClass:"group-manage"},[i("draggable",e._b({staticClass:"group-list",on:{sort:e.handleSort},model:{value:e.groupList,callback:function(t){e.groupList=t},expression:"groupList"}},"draggable",e.dragOptions,!1),[e._l(e.groupList,(function(t){return i("flexbox",{key:t.label,staticClass:"group-list-item sortable"},[i("span",{staticClass:"grid"},[e._v("⋮⋮")]),e._v(" "),i("flexbox-item",{staticClass:"name"},[e._v(e._s(t.label))]),e._v(" "),i("span",{staticClass:"desc"},[e._v(e._s(t.num||0)+"个项目")]),e._v(" "),1!==t.type&&2!==t.type?i("i",{staticClass:"el-icon-delete delete-icon",on:{click:function(i){e.deleteGroup(t)}}}):e._e()],1)})),e._v(" "),i("flexbox",{staticClass:"group-list-item"},[i("i",{staticClass:"el-icon-plus"}),e._v(" "),i("el-input",{attrs:{maxlength:20,placeholder:"添加项目分组"},model:{value:e.groupName,callback:function(t){e.groupName="string"===typeof t?t.trim():t},expression:"groupName"}}),e._v(" "),i("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.handleAdd}},[e._v("添加分组")])],1)],2)],1),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirm}},[e._v("保存")]),e._v(" "),i("el-button",{on:{click:e.handleCancel}},[e._v("取消")])],1)])},b=[],v=(i("159b"),i("b76a")),_=i.n(v),w=i("ed08"),y={name:"GroupManageDialog",components:{draggable:_.a},mixins:[u["a"]],props:{visible:Boolean,listData:{type:Array,default:function(){return[]}}},data:function(){return{loading:!1,dialogVisible:!1,groupName:"",groupList:[],dragOptions:{sort:!0,handle:".grid",draggable:".sortable"}}},watch:{visible:{handler:function(){this.dialogVisible=this.visible,this.dialogVisible&&(this.groupList=Object(w["r"])(this.listData))},immediate:!0},listData:{handler:function(){this.groupList=Object(w["r"])(this.listData)},deep:!0}},methods:{handleSort:function(){},handleAdd:function(){var e=this;if(this.groupName){var t=this.groupList.map((function(e){return e.label}));if(t.includes(this.groupName))this.$message.error("分组名称不能重复");else{var i={name:this.groupName};this.loading=!0,Object(n["e"])(i).then((function(t){e.$emit("addGroup"),e.loading=!1})).catch((function(){e.loading=!1})),this.groupName=""}}else this.$message.error("分组名称不能为空")},deleteGroup:function(e){var t=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0,Object(n["f"])({groupId:e.value}).then((function(e){t.$emit("addGroup"),t.loading=!1,t.$message({type:"success",message:"删除成功!"})})).catch((function(){t.loading=!1}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},handleConfirm:function(){var e=this,t=[];this.groupList.forEach((function(e,i){t.push({groupId:e.value,name:e.label,sort:i})})),this.loading=!0,Object(n["x"])(t).then((function(t){e.$emit("close"),e.$emit("addGroup"),e.loading=!1,e.$message.success("操作成功")})).catch((function(){e.loaing=!1}))},handleCancel:function(){this.dialogVisible=!1,this.$emit("close")}}},C=y,D=(i("b048"),Object(m["a"])(C,g,b,!1,null,"33f876fa",null)),x=D.exports,k=i("2f62"),j=i("6bfe"),S=[{label:"最高",value:1,color:"#DE350B",bg:"#FFEBE6"},{label:"较高",value:2,color:"#EC8205",bg:"#FFEACF"},{label:"普通",value:3,color:"#006644",bg:"#E3FCEF"}],T=i("e297"),$=i.n(T),O={name:"ProjectTable",components:{WkFilterHeader:l["a"],CreateGroupDialog:h,GroupManageDialog:x},props:{type:{type:String,required:!0,validator:function(e){return["all","owner","participate"].includes(e)}},myGroupList:{type:Array,default:function(){return[]}}},data:function(){return{loading:!1,keywords:"",config:{searchPlaceholder:"搜索项目"},sceneId:"",sceneData:{},groupOptionsList:[{label:"创建分组",value:"create"},{label:"管理分组",value:"manage"}],groupCommand:null,groupDialogVisible:!1,createGroupDialogVisible:!1,activeSortField:null,sortFieldList:[{name:"按访问时间",fieldName:"updateTime"},{name:"按创建时间",fieldName:"createTime"}],tableData:[],participateHeight:document.documentElement.clientHeight-460,tableHeight:document.documentElement.clientHeight-265,currentPage:1,pageSize:$.a.get("crmPageSizes")||15,pageSizes:[15,30,60,100],total:0}},computed:Object(s["a"])({},Object(k["b"])(["userInfo"])),mounted:function(){this.activeSortField=this.sortFieldList[0],this.getData()},methods:{isEmpty:function(e){return Object(j["b"])(e)},commandAuthList:function(e){if(!e.userProjectAuth)return[];var t=[{label:"项目设置",value:"setting",auth:"set"},{label:"归档项目",value:"archive",auth:"set.editProjectInfo"},{label:"删除项目",value:"delete",auth:"set.editProjectInfo",color:"#de350b"}];return"participate"==this.type&&t.unshift({label:"移动到分组",value:"group",auth:""}),t.filter((function(t){return!t.auth||Object(w["p"])(e.userProjectAuth,t.auth)}))},getPriorityTag:function(e){return Object(j["b"])(e)?null:S.find((function(t){return t.value===e}))||{}},getOverTimeStatus:function(e){var t=this.handleTime(e);return"今天"===t||"明天"===t?"is-near":this.$moment(e).isBefore(this.$moment())?"is-over":"is-common"},formatTime:function(e){if(!e)return null;var t=this.handleTime(e);if(t)return t;var i=this.$moment().isSame(e,"year");return i?this.$moment(e).format("M月D日"):this.$moment(e).format("YYYY年M月D日")},handleTime:function(e){var t=this.$moment(e).format("YYYY-MM-DD").split("-"),i=new Date,a=[i.getFullYear(),i.getMonth()+1,i.getDate()],o=new Date(i.setTime(i.getTime()+864e5)),s=[o.getFullYear(),o.getMonth()+1,o.getDate()],n=new Date(i.setTime(i.getTime()-1728e5)),l=[n.getFullYear(),n.getMonth()+1,n.getDate()];return a[0]==t[0]&&a[1]==t[1]&&a[2]==t[2]?"今天":s[0]==t[0]&&s[1]==t[1]&&s[2]==t[2]?"明天":l[0]==t[0]&&l[1]==t[1]&&l[2]==t[2]&&"昨天"},formatter:function(e,t){return(e.projectAdminList||[]).join()},handleRowClick:function(e,t,i){if(t.property&&"name"==t.property){var a=!1,o=this.userInfo.realname;(e.projectAdminList||[]).includes(o)&&(a=!0),this.$router.push({name:"projectTeam",params:{id:e.projectId,isOpen:e.isOpen,isMember:a}})}},getData:function(){var e=this;this.loading=!0;var t={participate:n["p"],owner:n["o"],all:n["q"]}[this.type],i={page:this.currentPage,limit:this.pageSize,name:this.keywords,sortType:"updateTime"==this.activeSortField.fieldName?1:2};"participate"==this.type&&(i.groupId=this.sceneId),t(i).then((function(t){e.tableData=t.data.list,e.total=t.data.totalRow,e.loading=!1})).catch((function(){e.loading=!1}))},addGroup:function(){this.$emit("getGroup")},refresh:function(){this.getData(),this.$emit("getList")},handleFilterEvt:function(e,t){"search"==e?(this.keywords=t,this.refresh()):"create"==e?(this.groupCommand=e,this.createGroupDialogVisible=!0):"manage"==e&&(this.groupCommand=e,this.groupDialogVisible=!0)},sceneSelect:function(e){this.sceneData=e,this.sceneId=e.value,this.refresh()},handleSort:function(e){this.activeSortField=this.sortFieldList.find((function(t){return t.fieldName===e})),this.getData()},handleToggleFocus:function(e){var t=this;Object(n["l"])({projectId:e.projectId}).then((function(i){e.collectStatus=2==e.collectStatus?1:2,t.refresh()})).catch((function(){}))},handleCommand:function(e,t){var i=this;if("move"==e.flag){var a={groupId:e.command,projectId:t.projectId};Object(n["g"])(a).then((function(e){i.$message.success("操作成功"),i.refresh(),i.$emit("getGroup")})).catch((function(){}))}switch(e){case"group":break;case"setting":this.$router.push({name:"projectSetting",params:{setting:t.projectId}});break;case"archive":this.archiveProject(t);break;case"delete":this.deleteProject(t);break}},handlerCommand:function(e,t){return{flag:e,command:t}},confirm:function(e){var t=this;return new Promise((function(i,a){t.$confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(){i()})).catch((function(){a()}))}))},deleteProject:function(e){var t=this;this.confirm("确定要删除“".concat(e.name,"”项目吗，删除后，项目下的所有数据也将删除，且不可恢复！")).then((function(){Object(n["i"])({projectId:e.projectId,setType:3}).then((function(){t.$message.success("操作成功"),t.refresh()})).catch((function(){}))}))},archiveProject:function(e){var t=this;this.confirm("点击归档项目操作后，将无法继续访问和操作该项目。若需解除归档，可在「归档项目」页进行操作").then((function(){Object(n["i"])({projectId:e.projectId,setType:2}).then((function(){t.$message.success("操作成功"),t.refresh()})).catch((function(){}))}))},handleSizeChange:function(e){$.a.set("crmPageSizes",e),this.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.currentPage=e,this.refresh()}}},V=O,F=(i("8948"),Object(m["a"])(V,a,o,!1,null,"54d6fb11",null));t["a"]=F.exports},"228d":function(e,t,i){e.exports=i.p+"static/img/common_project.26840b8e.png"},"4f56":function(e,t,i){},8948:function(e,t,i){"use strict";i("df70")},"8f79a":function(e,t,i){},"8f85":function(e,t,i){e.exports={colorPrimary:"#0052CC",colorBlack:"#172B4D",colorSuccess:"#36B37E",colorWarning:"#FFAB00",colorDanger:"#FF5630",colorN40:"#DFE1E6",axisLineColor:"#DFE1E6",axisLabelFontWeight:"500"}},a71b:function(e,t,i){"use strict";i("8f79a")},b048:function(e,t,i){"use strict";i("4f56")},c791:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.chooseDialogVisible?a("el-dialog",{ref:"wkDialog",attrs:{"append-to-body":"",visible:e.chooseDialogVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,title:e.title,width:"810px","custom-class":e.createDialogVisible?"pm-create-dialog":"no-padding-dialog pm-create-dialog"},on:{"update:visible":function(t){e.chooseDialogVisible=t},close:e.handleCloseAll}},[e.createDialogVisible?e._e():a("flexbox",{staticClass:"tpl-wrapper",attrs:{justify:"space-between"}},[a("flexbox",{staticClass:"tpl-item",attrs:{direction:"column",align:"flex-start"},nativeOn:{click:function(t){e.handleChoose(1)}}},[a("img",{staticClass:"tpl-item__pic",attrs:{src:i("228d"),alt:""}}),e._v(" "),a("flexbox",{staticClass:"tpl-item__title"},[a("i",{staticClass:"wk wk-icon-general-project"}),e._v(" "),a("span",[e._v("通用项目")])]),e._v(" "),a("p",{staticClass:"tpl-item__sub-title"},[e._v("简单易用的通用任务处理模板，适用于诸如个人安排等活动管理。")]),e._v(" "),a("p",{staticClass:"tpl-item__desc"},[e._v("包含组件（4个）"),a("br"),e._v("概览、任务、甘特图、成员")]),e._v(" "),a("el-button",{staticStyle:{"font-size":"14px"},attrs:{type:"primary"}},[e._v("选择")])],1),e._v(" "),a("flexbox",{staticClass:"tpl-item",attrs:{direction:"column",align:"flex-start"},nativeOn:{click:function(t){e.handleChoose(2)}}},[a("img",{staticClass:"tpl-item__pic",attrs:{src:i("daf3"),alt:""}}),e._v(" "),a("flexbox",{staticClass:"tpl-item__title"},[a("i",{staticClass:"wk wk-icon-agility"}),e._v(" "),a("span",[e._v("敏捷开发项目")])]),e._v(" "),a("p",{staticClass:"tpl-item__sub-title"},[e._v("通过内置的敏捷研发管理组件，可以轻松实现迭代管控、需求分配、缺陷管理等核心研发工作，通过各类报表实时掌控项目进度状况。")]),e._v(" "),a("p",{staticClass:"tpl-item__desc"},[e._v("包含组件（8个）"),a("br"),e._v("需求、迭代、缺陷、任务、概览、甘特图、成员、工时组件")]),e._v(" "),a("el-button",{staticStyle:{"font-size":"14px"},attrs:{type:"primary"}},[e._v("选择")])],1)],1),e._v(" "),e.createDialogVisible?[a("el-form",{ref:"elForm",staticClass:"create-wrapper",attrs:{model:e.form,rules:e.rules}},[a("el-row",[a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[a("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:2}},[e._v(" ")]),e._v(" "),a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"项目图标",prop:"icon"}},[a("wk-ico-select",{attrs:{"icon-color":"#0052CC",title:"项目图标","hidden-color":"",placement:"bottom"},model:{value:e.form.icon,callback:function(t){e.$set(e.form,"icon",t)},expression:"form.icon"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"开始时间",prop:"startTime"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"开始时间"},model:{value:e.form.startTime,callback:function(t){e.$set(e.form,"startTime",t)},expression:"form.startTime"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:2}},[e._v(" ")]),e._v(" "),a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"截止时间",prop:"stopTime"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"截止时间"},model:{value:e.form.stopTime,callback:function(t){e.$set(e.form,"stopTime",t)},expression:"form.stopTime"}})],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"项目描述",prop:"desc"}},[a("el-input",{attrs:{rows:3,maxlength:500,type:"textarea",resize:"none","show-word-limit":""},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description","string"===typeof t?t.trim():t)},expression:"form.description"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"可见范围",prop:"desc"}},[a("el-select",{model:{value:e.form.isOpen,callback:function(t){e.$set(e.form,"isOpen",t)},expression:"form.isOpen"}},e._l(e.openOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1),e._v(" "),0===e.form.isOpen?a("el-form-item",{attrs:{label:"项目成员"}},[a("flexbox",{attrs:{align:"flex-start",justify:"flex-start"}},[e._l(e.selectUserList,(function(e){return a("xr-avatar",{key:e.userId,attrs:{id:e.userId,size:26,name:e.realname,src:e.img}})})),e._v(" "),a("flexbox",{staticClass:"add-user-btn",attrs:{align:"center",justify:"center"},nativeOn:{click:function(t){return e.handleToChooseUser(t)}}},[a("i",{staticClass:"el-icon-plus"})])],2)],1):e._e()],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirmForm}},[e._v("确定")]),e._v(" "),a("el-button",{on:{click:e.handleCloseAll}},[e._v("取消")])],1),e._v(" "),e.depUserViewDialogShow?a("wk-dep-user-dialog",{attrs:{"user-value":e.selectedUserIds,props:{showDept:!1},visible:e.depUserViewDialogShow},on:{"update:userValue":function(t){e.selectedUserIds=t},"update:visible":function(t){e.depUserViewDialogShow=t},change:e.selectUserChange}}):e._e()]:e._e()],2):e._e()},o=[],s=(i("a15b"),i("a535")),n=i("2581"),l=i("8946"),r=i("ed08"),c=i("9dba"),u={name:"CreateProjectDialog",components:{WkDepUserDialog:n["a"],WkIcoSelect:l["a"]},mixins:[c["a"]],props:{visible:{type:Boolean,required:!0,default:!1},itemData:{type:Object,default:null}},data:function(){return{loading:!1,chooseDialogVisible:!1,createDialogVisible:!1,depUserViewDialogShow:!1,openOptions:[{value:0,label:"私有：只有加入的成员才能看见此项目"},{value:1,label:"公开：企业所有成员都可以看见此项目（公开项目系统所有人都能查看，但是只有项目成员可以编辑）"}],form:{type:null,name:"",description:"",isOpen:0,status:1,level:3,ownerDeptIds:"",ownerUserIds:"",icon:{icon:"",color:"#EBECF0"},startTime:"",stopTime:""},rules:{name:[{required:!0,message:"请输入项目名称",trigger:"blur"},{min:1,max:31,message:"请输入1-31位的项目名称",trigger:"blur"}],icon:[{required:!0,message:"请选择应用图标",trigger:"blur"}]},selectedUserIds:[],selectUserList:[]}},computed:{title:function(){return this.createDialogVisible?this.itemData?"编辑项目基本信息":"填写项目基本信息":"新建项目"}},watch:{visible:{handler:function(){this.visible?this.chooseDialogVisible=!0:(this.chooseDialogVisible=!1,this.createDialogVisible=!1)},immediate:!0}},mounted:function(){this.itemData||(this.selectUserList=[],this.selectedUserIds=[])},methods:{handleChoose:function(e){this.form.type=e,this.createDialogVisible=!0},handleCloseAll:function(){this.createDialogVisible=!1,this.chooseDialogVisible=!1,this.$emit("update:visible",!1),this.$emit("close"),this.form={type:null,name:"",description:"",isOpen:0,status:1,level:3,ownerDeptIds:"",ownerUserIds:"",icon:{icon:"",color:"#EBECF0"},startTime:"",stopTime:""},this.selectUserList=[]},handleToChooseUser:function(){this.form.ownerUserIds?this.selectedUserIds=this.form.ownerUserIds.split(","):this.selectUserIds=[],this.depUserViewDialogShow=!0},selectUserChange:function(e,t,i,a){this.form.ownerUserIds=e.join(","),this.selectUserList=i},handleConfirmForm:function(){var e=this;this.$refs.elForm.validate((function(t){return!!t&&(e.form.icon.icon?!e.form.startTime&&!e.form.stopTime||e.form.startTime&&e.form.stopTime&&!(Object(r["h"])(e.form.startTime)>=Object(r["h"])(e.form.stopTime))?void e.submitData():(e.$message.error("开始时间必须小于结束时间"),!1):(e.$message.error("请选择项目图标"),!1))}))},submitData:function(){var e=this;if(!this.loading){var t=this.itemData?s["t"]:s["h"],i=Object(r["r"])(this.form);i.icon=this.form.icon.icon,i.workOwnerRoleList=this.selectUserList,this.loading=!0,t(i).then((function(){e.loading=!1,e.$emit("save-success"),e.handleCloseAll(),e.form={type:null,name:"",description:"",isOpen:0,status:1,level:3,ownerDeptIds:"",ownerUserIds:"",icon:{icon:"",color:"#EBECF0"},startTime:"",stopTime:""},e.selectUserList=[]})).catch((function(){e.loading=!1}))}}}},d=u,p=(i("ecd8"),i("a71b"),i("2877")),m=Object(p["a"])(d,a,o,!1,null,"5fce266c",null);t["a"]=m.exports},d6a6:function(e,t,i){},daf3:function(e,t,i){e.exports=i.p+"static/img/developer_project.a275918a.png"},df70:function(e,t,i){},ecd8:function(e,t,i){"use strict";i("8f85")},f084:function(e,t,i){"use strict";i("d6a6")}}]);