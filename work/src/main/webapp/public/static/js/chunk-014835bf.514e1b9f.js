(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-014835bf"],{"5b60":function(t,e,n){"use strict";n("d54f")},9346:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{attrs:{loading:t.loading,title:t.title,visible:t.visible,"append-to-body":"",width:"700px","before-close":t.close},on:{"update:visible":function(e){t.visible=e}}},[n("div",{staticClass:"el-dialog-div"},[n("el-form",{ref:"formData",staticClass:"demo-ruleForm",attrs:{model:t.formData,rules:t.rules}},[n("el-form-item",{attrs:{label:"公告内容",prop:"content"}},[n("el-input",{attrs:{type:"textarea",rows:8},model:{value:t.formData.content,callback:function(e){t.$set(t.formData,"content",e)},expression:"formData.content"}})],1)],1)],1),t._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:t.close}},[t._v("取消")]),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确定")])],1)])},o=[],i=(n("a9e3"),n("dc1b")),c={name:"CreateNotice",components:{},props:{action:{type:Object,default:function(){return{type:"create"}}},projectId:{type:[String,Number],required:!0},visible:Boolean},data:function(){return{formData:{content:""},rules:{content:[{required:!0,message:"公告正文不能为空",trigger:"blur"},{max:1e3,message:"最长不超过1000个字符",trigger:"change"}]},loading:!1}},computed:{title:function(){return"create"==this.action.type?"新建公告":"编辑公告"}},created:function(){if("edit"==this.action.type){var t=this.action.data;this.formData={content:t.content}}},methods:{onSubmit:function(){var t=this;this.$refs.formData.validate((function(e){if(!e)return!1;t.loading=!0;var n={projectId:t.projectId,content:t.formData.content};"edit"==t.action.type&&(n.projectAnnouncementId=t.action.data.projectAnnouncementId);var a={create:i["a"],edit:i["d"]}[t.action.type];a(n).then((function(e){t.$message.success("".concat(t.title,"成功")),t.$emit("onSubmit"),t.close(),t.loading=!1})).catch((function(){t.$message.error("".concat(t.title,"失败")),t.loading=!1}))}))},close:function(){this.$emit("close")}}},r=c,s=(n("c1a0"),n("2877")),l=Object(s["a"])(r,a,o,!1,null,"4efd6ab8",null);e["a"]=l.exports},9759:function(t,e,n){},"97b2":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"pm-project"},[n("wk-page-header",{attrs:{title:"项目公告"+(t.listData.length>0?"（"+t.listData.length+"）":"")}},[n("template",{slot:"right"},[t.$auth("projectAnnouncement.editAnnouncement","PM")?n("el-button",{attrs:{type:"primary"},on:{click:t.createNotice}},[t._v("新建公告")]):t._e()],1)],2),t._v(" "),n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"container"},[t.listData.length?t._e():n("div",{directives:[{name:"empty",rawName:"v-empty",value:0===t.listData.length,expression:"listData.length === 0"}]}),t._v(" "),n("div",{staticClass:"notice-list"},t._l(t.listData,(function(e,a){return n("div",{key:e.projectAnnouncementId,staticClass:"notice-list-item"},[n("flexbox",{staticClass:"user-info"},[n("xr-avatar",{attrs:{id:e.createUserId,src:e.createUserImg,name:e.createUser,size:32}}),t._v(" "),n("flexbox-item",[n("div",{staticClass:"username"},[t._v(t._s(e.createUser))]),t._v(" "),n("div",{staticClass:"time"},[t._v(t._s(e.createTime))])])],1),t._v(" "),n("flexbox",{staticClass:"content",attrs:{align:"flex-start",justify:"flex-start"}},[n("flexbox-item",[t._v("\n            "+t._s(e.content)+"\n          ")]),t._v(" "),n("div",{staticClass:"control"},[t.$auth("projectAnnouncement.editAnnouncement","PM")?n("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(n){t.handleUpdate(e)}}},[t._v("编辑")]):t._e(),t._v(" "),t.$auth("projectAnnouncement.deleteAnnouncement","PM")?n("el-button",{staticClass:"del-btn",attrs:{type:"danger",size:"medium"},on:{click:function(n){t.handleDelete(e,a)}}},[t._v("删除")]):t._e()],1)],1)],1)})))]),t._v(" "),t.createVisible?n("create-notice-dialog",{attrs:{visible:t.createVisible,action:t.action,"project-id":t.projectId},on:{onSubmit:t.getList,close:function(e){t.createVisible=!1}}}):t._e()],1)},o=[],i=n("5530"),c=(n("ac1f"),n("5319"),n("14d9"),n("dc1b")),r=n("fdca"),s=n("9346"),l=n("2f62"),u={name:"ProjectNoticeIndex",components:{WkPageHeader:r["a"],createNoticeDialog:s["a"]},data:function(){return{loading:!1,listData:[],action:{type:"",data:null},createVisible:!1}},computed:Object(i["a"])({projectId:function(){return this.$route.params.id}},Object(l["b"])(["projectAuth"])),watch:{projectAuth:{handler:function(t){t.loaded&&(this.$auth("projectAnnouncement.viewAnnouncement","PM")||this.$router.replace({name:"participate"}))},immediate:!0,deep:!0}},created:function(){this.getList()},methods:{getList:function(){var t=this,e={projectId:this.projectId};this.loading=!0,Object(c["c"])(e).then((function(e){t.listData=e.data,t.loading=!1})).catch((function(){t.loading=!1}))},createNotice:function(){this.action.type="create",this.createVisible=!0},handleUpdate:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.action.data=t,this.action.type="edit",this.createVisible=!0},handleDelete:function(t,e){var n=this;this.$confirm("您确定要删除这条数据吗？","提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(){n.loading=!0;var e={projectAnnouncementId:[]};e.projectAnnouncementId.push(t.projectAnnouncementId),Object(c["b"])(e).then((function(t){n.$message.success("删除成功"),n.getList(),n.loading=!1})).catch((function(){n.$message.error("删除失败"),n.loading=!1}))})).catch((function(){}))}}},d=u,p=(n("5b60"),n("2877")),m=Object(p["a"])(d,a,o,!1,null,"02555036",null);e["default"]=m.exports},c1a0:function(t,e,n){"use strict";n("9759")},d54f:function(t,e,n){},dc1b:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return i})),n.d(e,"d",(function(){return c})),n.d(e,"b",(function(){return r}));var a=n("b775");function o(t){return Object(a["a"])({url:"projectAnnouncement/getProjectAnnouncement",method:"post",data:t,headers:{"Content-Type":"application/json;charset=utf-8;"}})}function i(t){return Object(a["a"])({url:"projectAnnouncement/addProjectAnnouncement",method:"post",headers:{"Content-Type":"application/json;charset=utf-8;"},data:t})}function c(t){return Object(a["a"])({url:"projectAnnouncement/setProjectAnnouncement",method:"post",headers:{"Content-Type":"application/json;charset=utf-8;"},data:t})}function r(t){return Object(a["a"])({url:"projectAnnouncement/delProjectAnnouncement",method:"post",headers:{"Content-Type":"application/json;charset=utf-8;"},data:t})}}}]);